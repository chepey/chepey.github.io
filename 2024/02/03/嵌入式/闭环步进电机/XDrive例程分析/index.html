<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="Chepey"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="canonical" href="http://chepey.github.io/2024/02/03/嵌入式/闭环步进电机/xdrive例程分析/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="[TOC] 整体结构实物图 硬件选型主控制器：STM32F103CBT6——48Pin，72MHz电机驱动：TB67H450*2（两相四线步进电机）  传感器：MT6816 系统延时：2us  绝对角度数据：14位  ABZ分辨率：1~1024线任意分辨率  协议：SPI——16MHz   数据接口控制电平：差分信号控制光耦 CAN：TJA1051T RS485：SN75176BDR 显示：OLE"><meta property="og:type" content="article"><meta property="og:title" content="XDrive例程分析"><meta property="og:url" content="http://chepey.github.io/2024/02/03/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/XDrive%E4%BE%8B%E7%A8%8B%E5%88%86%E6%9E%90/index.html"><meta property="og:site_name" content="Welcome to Chepey&#39;s Blog"><meta property="og:description" content="[TOC] 整体结构实物图 硬件选型主控制器：STM32F103CBT6——48Pin，72MHz电机驱动：TB67H450*2（两相四线步进电机）  传感器：MT6816 系统延时：2us  绝对角度数据：14位  ABZ分辨率：1~1024线任意分辨率  协议：SPI——16MHz   数据接口控制电平：差分信号控制光耦 CAN：TJA1051T RS485：SN75176BDR 显示：OLE"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\XDrive%E4%BE%8B%E7%A8%8B%E5%88%86%E6%9E%90\image-20240203134901106.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\XDrive%E4%BE%8B%E7%A8%8B%E5%88%86%E6%9E%90\image-20240203135928615.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\XDrive%E4%BE%8B%E7%A8%8B%E5%88%86%E6%9E%90\image-20240203135947081.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\XDrive%E4%BE%8B%E7%A8%8B%E5%88%86%E6%9E%90\image-20240203140303977.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\XDrive%E4%BE%8B%E7%A8%8B%E5%88%86%E6%9E%90\image-20240203140722299.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\XDrive%E4%BE%8B%E7%A8%8B%E5%88%86%E6%9E%90\image-20240203140327504.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\XDrive%E4%BE%8B%E7%A8%8B%E5%88%86%E6%9E%90\image-20240203135259549.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\XDrive%E4%BE%8B%E7%A8%8B%E5%88%86%E6%9E%90\image-20240203135151595.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\XDrive%E4%BE%8B%E7%A8%8B%E5%88%86%E6%9E%90\%E6%96%87%E4%BB%B6%E8%B0%83%E7%94%A8%E7%BB%93%E6%9E%84.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\XDrive%E4%BE%8B%E7%A8%8B%E5%88%86%E6%9E%90\image-20240217164753510.png"><meta property="article:published_time" content="2024-02-03T05:00:00.000Z"><meta property="article:modified_time" content="2024-02-26T14:17:09.131Z"><meta property="article:author" content="chepey"><meta property="article:tag" content="STM32F1"><meta property="article:tag" content="3D打印机"><meta property="article:tag" content="步进电机"><meta property="article:tag" content="嵌入式开发"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\XDrive%E4%BE%8B%E7%A8%8B%E5%88%86%E6%9E%90\image-20240203134901106.png"><link rel="icon" type="image/png" href="/images/favicon.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><meta name="theme-color" content="#A31F34"><link rel="shortcut icon" href="/images/favicon.png"><title>XDrive例程分析 - Chepey&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/assets/build/styles.css"><link rel="stylesheet" href="/fonts/fonts.css"><link rel="stylesheet" href="/fonts/Satoshi/satoshi.css"><link rel="stylesheet" href="/fonts/Chillax/chillax.css"><script id="hexo-configurations">window.config={hostname:"chepey.github.io",root:"/",language:"zh-CN",path:"search.xml"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!1,list:[]},code_block:{copy:!0,style:"mac",font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:3,number:!0,expand:!0,init_open:!0},copyright:!0,lazyload:!1,recommendation:{enable:!1,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#A31F34",secondary:"#1b143e"},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!0},scroll_progress:{bar:!0,percentage:!0},website_counter:{url:"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,open_graph:!0,google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"fixed",image:{light:"/images/bk2.jpg",dark:"/images/bk2.jpg"},title:"Welcome to Chepey's Blog",subtitle:{text:["3D打印","嵌入式开发","DIY","二次元","etc"],hitokoto:{enable:!1,api:"https://v1.hitokoto.cn"},typing_speed:100,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!0,smart_backspace:!0},text_color:{light:"#1b143e",dark:"#1b143e"},text_style:{title_size:"3.7rem",subtitle_size:"2.5rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:!1,links:{github:null,instagram:null,zhihu:null,twitter:null,email:null},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null}]},mermaid:{enable:!1,version:"9.3.0"}},version:"2.5.0",navbar:{auto_hide:!1,color:{left:"#332847",right:"#af6e79",transparency:35},links:{Home:{path:"/",icon:"fa-regular fa-house"},"档案":{path:"/archives",icon:"fa-regular fa-archive"},"目录":{path:"/categories",icon:"fa-regular fa-folder"},"标签":{path:"/tags",icon:"fa-regular fa-tags"}},search:{enable:!0,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"menu",announcement:null,links:{"档案":{path:"/archives",icon:"fa-regular fa-archive"},"目录":{path:"/categories",icon:"fa-regular fa-folder"},"标签":{path:"/tags",icon:"fa-regular fa-tags"}}},article_date_format:"auto",categories:{enable:!0,limit:5},tags:{enable:!0,limit:5}},footerStart:"2023/10/25 13:02:00"},window.lang_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},window.data={masonry:!1}</script><link rel="stylesheet" href="/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/fontawesome/brands.min.css"><link rel="stylesheet" href="/fontawesome/solid.min.css"><link rel="stylesheet" href="/fontawesome/regular.min.css"><meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span> <span class="swup-progress-icon"><i class="fa-solid fa-circle-notch fa-spin"></i></span></div><main class="page-container" id="swup"><div class="main-content-container"><div class="main-content-header"><header class="navbar-container"><div class="navbar-content"><div class="left"><a class="logo-image" href="/"><img src="/images/favicon.png"> </a><a class="logo-title" href="/">Chepey&#39;s Blog</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house"></i> 首页</a></li><li class="navbar-item"><a href="/archives"><i class="fa-regular fa-archive"></i> 档案</a></li><li class="navbar-item"><a href="/categories"><i class="fa-regular fa-folder"></i> 目录</a></li><li class="navbar-item"><a href="/tags"><i class="fa-regular fa-tags"></i> 标签</a></li><li class="navbar-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color"><ul class="drawer-navbar-list flex flex-col justify-start items-center"><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/"><i class="fa-regular fa-house"></i> 首页</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/archives"><i class="fa-regular fa-archive"></i> 档案</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/categories"><i class="fa-regular fa-folder"></i> 目录</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/tags"><i class="fa-regular fa-tags"></i> 标签</a></li></ul></div><div class="window-mask"></div></header></div><div class="main-content-body"><div class="main-content"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><h1 class="article-title-regular">XDrive例程分析</h1></div><div class="article-header flex flex-row gap-2 items-center"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="/images/avatar.jpg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">Chepey</span> <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv5</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2024-02-03 13:00</span> <span class="mobile">2024-02-03 13:00</span> <span class="hover-info">创建</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2024-02-26 22:17:09</span> <span class="mobile">2024-02-26 22:17:09</span> <span class="hover-info">更新</span> </span><span class="article-categories article-meta-item"><i class="fa-regular fa-folders"></i>&nbsp;<ul><li><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/">嵌入式</a>&nbsp;</li><li>></li><li><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%A4%9A%E8%B7%AF%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/">多路闭环步进电机</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/STM32F1/">STM32F1</a>&nbsp;</li><li>| <a href="/tags/3D%E6%89%93%E5%8D%B0%E6%9C%BA/">3D打印机</a>&nbsp;</li><li>| <a href="/tags/%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/">步进电机</a>&nbsp;</li><li>| <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/">嵌入式开发</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fa-regular fa-typewriter"></i>&nbsp;<span>7.8k 字</span> </span><span class="article-min2read article-meta-item"><i class="fa-regular fa-clock"></i>&nbsp;<span>31 分钟</span> </span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body"><p>[TOC]</p><h1 id="整体结构"><a href="#整体结构" class="headerlink" title="整体结构"></a>整体结构</h1><h2 id="实物图"><a href="#实物图" class="headerlink" title="实物图"></a>实物图</h2><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\XDrive例程分析\image-20240203134901106.png" alt="image-20240203134901106"></p><h2 id="硬件选型"><a href="#硬件选型" class="headerlink" title="硬件选型"></a>硬件选型</h2><h3 id="主控制器：STM32F103CBT6——48Pin，72MHz"><a href="#主控制器：STM32F103CBT6——48Pin，72MHz" class="headerlink" title="主控制器：STM32F103CBT6——48Pin，72MHz"></a>主控制器：STM32F103CBT6——48Pin，72MHz</h3><h3 id="电机驱动：TB67H450-2（两相四线步进电机）"><a href="#电机驱动：TB67H450-2（两相四线步进电机）" class="headerlink" title="电机驱动：TB67H450*2（两相四线步进电机）"></a>电机驱动：TB67H450*2（两相四线步进电机）</h3><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\XDrive例程分析\image-20240203135928615.png" alt="image-20240203135928615"></p><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\XDrive例程分析\image-20240203135947081.png" alt="image-20240203135947081"></p><h3 id="传感器：MT6816"><a href="#传感器：MT6816" class="headerlink" title="传感器：MT6816"></a>传感器：MT6816</h3><ul><li><p>系统延时：2us</p></li><li><p>绝对角度数据：14位</p></li><li><p>ABZ分辨率：1~1024线任意分辨率</p></li><li><p>协议：SPI——16MHz</p></li></ul><h3 id="数据接口"><a href="#数据接口" class="headerlink" title="数据接口"></a>数据接口</h3><h4 id="控制电平：差分信号控制光耦"><a href="#控制电平：差分信号控制光耦" class="headerlink" title="控制电平：差分信号控制光耦"></a>控制电平：差分信号控制光耦</h4><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\XDrive例程分析\image-20240203140303977.png" alt="image-20240203140303977"></p><h4 id="CAN：TJA1051T"><a href="#CAN：TJA1051T" class="headerlink" title="CAN：TJA1051T"></a>CAN：TJA1051T</h4><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\XDrive例程分析\image-20240203140722299.png" alt="image-20240203140722299"></p><h4 id="RS485：SN75176BDR"><a href="#RS485：SN75176BDR" class="headerlink" title="RS485：SN75176BDR"></a>RS485：SN75176BDR</h4><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\XDrive例程分析\image-20240203140327504.png" alt="image-20240203140327504"></p><h3 id="显示：OLED"><a href="#显示：OLED" class="headerlink" title="显示：OLED"></a>显示：OLED</h3><ul><li>型号：OLED12832</li><li>协议：SPI</li></ul><h2 id="操作方法"><a href="#操作方法" class="headerlink" title="操作方法"></a>操作方法</h2><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\XDrive例程分析\image-20240203135259549.png" alt="image-20240203135259549"></p><h2 id="菜单结构"><a href="#菜单结构" class="headerlink" title="菜单结构"></a>菜单结构</h2><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\XDrive例程分析\image-20240203135151595.png" alt="image-20240203135151595"></p><h1 id="例程代码分析"><a href="#例程代码分析" class="headerlink" title="例程代码分析"></a>例程代码分析</h1><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\XDrive例程分析\文件调用结构.png" alt="文件调用结构"></p><h2 id="项目结构"><a href="#项目结构" class="headerlink" title="项目结构"></a>项目结构</h2><ul><li><p>Application/User/Core：外设驱动</p><ul><li><ul><li><input disabled type="checkbox"> adc</li></ul></li><li><ul><li><input disabled type="checkbox"> dma</li></ul></li><li><ul><li><input checked disabled type="checkbox"> gpio</li></ul></li><li><ul><li><input disabled type="checkbox"> spi</li></ul></li><li><ul><li><input disabled type="checkbox"> tim</li></ul></li><li><ul><li><input disabled type="checkbox"> usart</li></ul></li></ul></li><li><p>Drivers/STM32F1xx_HAL_Driver：Hal驱动库</p></li><li><p>Base_Drivers：基础驱动</p><ul><li><ul><li><input disabled type="checkbox"> kernel_port.c</li></ul></li><li><ul><li><input checked disabled type="checkbox"> mt6816.c</li></ul></li><li><ul><li><input disabled type="checkbox"> hw_elec.c</li></ul></li><li><ul><li><input checked disabled type="checkbox"> signal_port.c</li></ul></li><li><ul><li><input disabled type="checkbox"> uart_mixed.c</li></ul></li></ul></li><li><p>Base_Math：</p><ul><li><ul><li><input disabled type="checkbox"> rein_math.c</li></ul></li><li><ul><li><input disabled type="checkbox"> sin_form.c</li></ul></li></ul></li><li><p>Config</p><ul><li><ul><li><input disabled type="checkbox"> stockpile_f103cb.c</li></ul></li></ul></li><li><p>Control</p><ul><li><ul><li><input disabled type="checkbox"> control_config.c</li></ul></li><li><ul><li><input checked disabled type="checkbox"> motor_control.c</li></ul></li><li><ul><li><input checked disabled type="checkbox"> encode_cali.c</li></ul></li><li><ul><li><input disabled type="checkbox"> Location_Tracker.c</li></ul></li><li><ul><li><input disabled type="checkbox"> Speed_Tracker.c</li></ul></li><li><ul><li><input disabled type="checkbox"> Current_Tracker.c</li></ul></li><li><ul><li><input disabled type="checkbox"> Move_Reconstruct.c</li></ul></li><li><ul><li><input disabled type="checkbox"> Location_Interp.c</li></ul></li><li><ul><li><input disabled type="checkbox"> power_detect.c</li></ul></li></ul></li><li><p>Debug</p><ul><li><ul><li><input checked disabled type="checkbox"> button.c</li></ul></li><li><ul><li><input checked disabled type="checkbox"> ssd1306.c</li></ul></li><li><ul><li><input checked disabled type="checkbox"> xdrive_ui.c</li></ul></li></ul></li><li><p>Kernel</p><ul><li><ul><li><input checked disabled type="checkbox"> loop.c</li></ul></li><li><ul><li><input checked disabled type="checkbox"> loop_it.c</li></ul></li></ul></li></ul><h2 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h2><h3 id="按键初始化"><a href="#按键初始化" class="headerlink" title="按键初始化"></a>按键初始化</h3><p>GPIO初始化，枚举类型初始化</p><h3 id="OLED初始化"><a href="#OLED初始化" class="headerlink" title="OLED初始化"></a>OLED初始化</h3><p>GPIO初始化、OLED-SPI初始化</p><p>发送命令配置</p><ul><li>0xAE：关闭显示</li><li>0x00：设置低位列地址</li><li>0x10：设置高位列地址</li><li>0x00：设置显示起始行</li><li>0xB0：设置页面地址</li><li>0x81：合同控制</li><li>0xff：128</li><li>0xA1：设置段重映射</li><li>0xA6：正常/反向</li><li>0xA8：多路复用比率</li><li>0x1F：占空比=1/32</li><li>0xC8：Com扫描方向</li><li>0xD3、0x00：设置显示偏移</li><li>0xD5、0x80：设置osc分区</li><li>0xD9、0x1f：设置预充电周期</li><li>0xDA、0x00：设置COM引脚</li><li>0xdb、0x40：设置vcomh</li><li>0x8d、0x14：设置电荷泵启用</li><li>0xAF：开启显示</li></ul><h3 id="UI初始化"><a href="#UI初始化" class="headerlink" title="UI初始化"></a>UI初始化</h3><ul><li>过度动画控件初始化</li><li>菜单控件初始化</li><li>显示块控件初始化</li><li>通过控件生成界面拓扑关系</li><li>选择当前指针为主界面</li><li>清除显示</li><li>显示界面</li><li>更改gram</li><li>oled刷新显示</li></ul><h3 id="基本外设初始化"><a href="#基本外设初始化" class="headerlink" title="基本外设初始化"></a>基本外设初始化</h3><h4 id="DMA"><a href="#DMA" class="headerlink" title="DMA"></a>DMA</h4><ul><li>启动时钟</li><li>启用DMA1_CH4中断(USART1_TX)</li><li>启用DMA1_CH5中断(USART1_RX)</li></ul><h4 id="ADC"><a href="#ADC" class="headerlink" title="ADC"></a>ADC</h4><ul><li>DMA初始化</li><li>ADC1初始化</li><li>配置队列1</li><li>配置队列2</li></ul><h4 id="MT6816"><a href="#MT6816" class="headerlink" title="MT6816"></a>MT6816</h4><p>根据宏定义不同，初始化函数各不相同，但名字都为 <code>REIN_MT6816_Init()</code> 用于初始化</p><ul><li>初始化接口</li><li>获取一次角度（过滤错误数据：复位后第一次读数据会丢失）</li><li>检查校准区数据是否有效（根据 <em>stockpile_config.h</em> 中flash的偏移地址）</li></ul><h4 id="HW-Elec硬件电流控制"><a href="#HW-Elec硬件电流控制" class="headerlink" title="HW_Elec硬件电流控制"></a>HW_Elec硬件电流控制</h4><p>这一部分为通过PWM转模拟量，控制硬件电流</p><ul><li><p>GPIO初始化</p></li><li><p>定时器初始化</p></li></ul><h4 id="Signal-MoreIO（主板信号采集）"><a href="#Signal-MoreIO（主板信号采集）" class="headerlink" title="Signal_MoreIO（主板信号采集）"></a>Signal_MoreIO（主板信号采集）</h4><ul><li>预设模式（Disable</li><li>MoreIO不同模式的参数初始化<ul><li>Signal_Count采集初始化</li><li>Signal_PWM采集初始化</li></ul></li></ul><h3 id="控制初始化"><a href="#控制初始化" class="headerlink" title="控制初始化"></a>控制初始化</h3><h4 id="校准器初始化"><a href="#校准器初始化" class="headerlink" title="校准器初始化"></a>校准器初始化</h4><ul><li>触发校准标志量=》关闭</li><li>错误代表=》无错误</li><li>错误数据=》归0</li><li>输出位置=》归0</li><li>全段域校准过程数据=》归0</li></ul><h4 id="电机控制器初始化"><a href="#电机控制器初始化" class="headerlink" title="电机控制器初始化"></a>电机控制器初始化</h4><ul><li>检验历史数据</li><li>模式初始化=》停止模式</li><li>读取初始化</li><li>估计初始化</li><li>硬目标初始化</li><li>软目标初始化</li><li>输出初始化</li><li>堵转识别初始化</li><li>过载识别初始化</li><li>状态初始化</li><li>控制算法初始化<ul><li>PID初始化</li><li>DCE初始化</li></ul></li><li>轨迹初始化<ul><li>位置跟踪器初始化</li><li>速度跟踪器初始化</li><li>电流跟踪器初始化</li><li>运动重构器初始化</li><li>位置插补器初始化</li></ul></li></ul><h3 id="通讯接口初始化"><a href="#通讯接口初始化" class="headerlink" title="通讯接口初始化"></a>通讯接口初始化</h3><h4 id="GPIO-Modbus初始化（RS485DIR）"><a href="#GPIO-Modbus初始化（RS485DIR）" class="headerlink" title="GPIO Modbus初始化（RS485DIR）"></a>GPIO Modbus初始化（RS485DIR）</h4><ul><li>使能GPIO时钟</li><li>配置DIR引脚启动输出低电平</li><li>配置推挽输出</li><li>禁用上/下拉</li><li>GPIO速度为低速</li></ul><h4 id="UART-Modbus初始化"><a href="#UART-Modbus初始化" class="headerlink" title="UART Modbus初始化"></a>UART Modbus初始化</h4><ul><li><p>设置Uart模式</p></li><li><p>设置波特率</p></li><li><p>加载配置</p></li><li><p>AFIO初始化</p><ul><li>使能GPIO时钟</li><li>配置GPIO引脚<ul><li>TX：推挽输出、高速</li><li>RX：上拉输入</li></ul></li></ul></li><li><p>USART1 DMA TX初始化</p><ul><li>内存到外设</li><li>外设地址（保持）</li><li>内存地址（递增）</li><li>外设宽度（半个字）</li><li>内存宽度（半个字）</li><li>模式（循环）</li><li>传输优先级（最高）</li></ul></li><li><p>USART1 DMA RX初始化</p><ul><li>内存到外设</li><li>外设地址（保持）</li><li>内存地址（递增）</li><li>外设宽度（半个字）</li><li>内存宽度（半个字）</li><li>模式（循环）</li><li>传输优先级（最高）</li></ul></li><li><p>使能USART1时钟</p></li><li><p>Modbus串口配置</p><p>根据结构体</p><ul><li>配置参考：UART_HAL库实例</li><li>配置波特率</li><li>配置数据字长、停止位个数、校验方法（共6种）</li><li>配置收发模式</li><li>配置硬件流（无）</li><li>配置过采样（16）</li><li>重新初始化HAL串口</li></ul></li><li><p>启用串口1中断</p></li></ul><h4 id="signal-Modbus初始化"><a href="#signal-Modbus初始化" class="headerlink" title="signal Modbus初始化"></a>signal Modbus初始化</h4><ul><li>设置Modbus接口ID</li><li>加载配置</li></ul><h3 id="中断初始化"><a href="#中断初始化" class="headerlink" title="中断初始化"></a>中断初始化</h3><h4 id="重写中断优先级覆盖"><a href="#重写中断优先级覆盖" class="headerlink" title="重写中断优先级覆盖"></a>重写中断优先级覆盖</h4><p>中断优先级：</p><ol start="0"><li>输入信号关键中断</li><li>传感器关键中断</li><li>任务终端</li><li>通讯中断</li></ol><table><thead><tr><th align="center">步骤</th><th align="center">中断源</th><th align="center">抢占优先级</th><th align="center">子优先级</th><th align="center">用途</th></tr></thead><tbody><tr><td align="center">1</td><td align="center"><code>SIGNAL_COUNT_DIR_Get_IRQn</code></td><td align="center">0</td><td align="center">0</td><td align="center">外部中断(SIGNAL_COUNT_DIR) ，获取SIGNAL_COUNT计数器方向</td></tr><tr><td align="center">2</td><td align="center"><code>SIGNAL_PWM_Get_IRQn</code></td><td align="center">0</td><td align="center">0</td><td align="center">定时器捕获(SIGNAL_PWM_PWM)，获取SIGNAL_PWM两个边沿计数值</td></tr><tr><td align="center">3</td><td align="center"><code>SysTick_IRQn</code></td><td align="center">2</td><td align="center">0</td><td align="center">系统定时器，核心时钟</td></tr><tr><td align="center">4</td><td align="center"><code>Modbus_UART_TX_DMA_IRQn</code></td><td align="center">3</td><td align="center">0</td><td align="center">Modbus_TX_DMA中断，响应发送完成</td></tr><tr><td align="center">5</td><td align="center"><code>Modbus_UART_RX_DMA_IRQn</code></td><td align="center">3</td><td align="center">0</td><td align="center">Modbus_RX_DMA中断，响应接收完成</td></tr><tr><td align="center">6</td><td align="center"><code>Modbus_UART_IRQn</code></td><td align="center">3</td><td align="center">0</td><td align="center">Modbus_UART中断，响应串口收发中断</td></tr></tbody></table><h4 id="修改系统计时器为20KHz"><a href="#修改系统计时器为20KHz" class="headerlink" title="修改系统计时器为20KHz"></a>修改系统计时器为20KHz</h4><ul><li>20khz标志位置为True</li><li>利用<code>HAL_SYSTICK_Config()</code>函数更新为20k中断</li></ul><h4 id="启动时使用按键出发校准"><a href="#启动时使用按键出发校准" class="headerlink" title="启动时使用按键出发校准"></a>启动时使用按键出发校准</h4><p>启动的时候按下案件复位后就开始校准电机</p><ul><li>校准标志变量=True</li><li>进入UI校准界面</li></ul><h2 id="主循环"><a href="#主循环" class="headerlink" title="主循环"></a>主循环</h2><h3 id="UI更新计时系统"><a href="#UI更新计时系统" class="headerlink" title="UI更新计时系统"></a>UI更新计时系统</h3><p>每10ms、20ms、50ms、100ms分别执行不同的韩素</p><ul><li>10ms时：<code>time_second_10ms_serve()</code></li><li>20ms时：<code>time_second_20ms_serve()</code></li><li>50ms时：<code>time_second_50ms_serve()</code></li><li>100ms时：<code>time_second_100ms_serve()</code></li></ul><h3 id="校准器循环内回调"><a href="#校准器循环内回调" class="headerlink" title="校准器循环内回调"></a>校准器循环内回调</h3><p>校准器主程序回调，用于校准环节最后的数据解算</p><ul><li><p>非解算态则自动退出</p></li><li><p>PWM输出衰减</p></li><li><p>校准器原始数据检查</p></li><li><p>进行快速表表格建立</p><p>数据解析，全段域校准 完全拟合传感器数据与电机实际相位角非线性关系</p><ul><li>擦除数据区</li><li>开始写数据区</li><li>结束写数据区</li></ul></li><li><p>确认校准结果</p></li><li><p>运动配置覆盖</p></li><li><p>清理校准型号</p></li></ul><h2 id="中断"><a href="#中断" class="headerlink" title="中断"></a>中断</h2><h3 id="外部中断-SIGNAL-COUNT-DIR"><a href="#外部中断-SIGNAL-COUNT-DIR" class="headerlink" title="外部中断(SIGNAL_COUNT_DIR)"></a>外部中断(SIGNAL_COUNT_DIR)</h3><p>获取SIGNAL_COUNT计数器方向</p><p>服务函数：<code>EXTI9_5_IRQHandler(void)</code></p><p>功能：</p><ul><li>判断触发中断的引脚（PA1）</li><li>清除PA1重点</li><li>计数器计数方向根据计数方向引脚电平改变（驱动器的DIR引脚）</li></ul><h3 id="定时器捕获-SIGNAL-PWM-PWM"><a href="#定时器捕获-SIGNAL-PWM-PWM" class="headerlink" title="定时器捕获(SIGNAL_PWM_PWM)"></a>定时器捕获(SIGNAL_PWM_PWM)</h3><p>获取SIGNAL_PWM两个边沿计数值</p><p>服务函数：<code>TIM3_IRQHandler(void)</code></p><p>功能：</p><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\XDrive例程分析\image-20240217164753510.png" alt="image-20240217164753510"></p><ul><li><p>捕获中断通道1触发（上升沿中断）：</p><ul><li>获取PWM周期</li><li>更新计数器镜像</li></ul></li><li><p>捕获中断通道2触发（下降沿中断）：</p><ul><li>获取PWM高宽度</li><li>更新计数器镜像</li></ul></li><li><p>更新事件中断</p><ul><li><p>判断PWM波电平是否为全高/低模式</p></li><li><p>提取本周期PWM中高电平宽度</p></li><li><p>单次PWM有效性确认</p><ul><li>判断是否全1/全0/超长/超短，如果是则无效（sg_pwm.ready_first = false）</li></ul></li><li><p>可靠的PWM有效性确认，成功采样三次之后才开始获取数据。</p></li><li><p>获取数据</p><ul><li><p>提取有效PWM，给高电平宽度加一个阈值</p></li><li><p>提取有效目标</p><ul><li><p>提取目标位置<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align:-2.059ex" xmlns="http://www.w3.org/2000/svg" width="58.438ex" height="5.285ex" role="img" focusable="false" viewBox="0 -1426 25829.8 2336"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">有</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">效</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">宽</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g><g data-mml-node="mo" transform="translate(4222.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(5222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(6222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(7222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">宽</text></g><g data-mml-node="mi" transform="translate(8222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g></g><g data-mml-node="mrow" transform="translate(220,-710)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">大</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">宽</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g><g data-mml-node="mo" transform="translate(4222.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(5222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(6222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(7222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">宽</text></g><g data-mml-node="mi" transform="translate(8222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g></g><rect width="9422.4" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(9884.7,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(10606.9,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(10995.9,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(11995.9,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">大</text></g><g data-mml-node="mi" transform="translate(12995.9,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">位</text></g><g data-mml-node="mi" transform="translate(13995.9,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">置</text></g><g data-mml-node="mo" transform="translate(15218.1,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(16218.3,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(17218.3,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(18218.3,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">位</text></g><g data-mml-node="mi" transform="translate(19218.3,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">置</text></g><g data-mml-node="mo" transform="translate(20218.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(20829.6,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(21829.8,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(22829.8,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(23829.8,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">位</text></g><g data-mml-node="mi" transform="translate(24829.8,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">置</text></g></g></g></svg></mjx-container></p></li><li><p>提取目标速度<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align:-2.059ex" xmlns="http://www.w3.org/2000/svg" width="58.438ex" height="5.285ex" role="img" focusable="false" viewBox="0 -1426 25829.8 2336"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">有</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">效</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">宽</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g><g data-mml-node="mo" transform="translate(4222.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(5222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(6222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(7222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">宽</text></g><g data-mml-node="mi" transform="translate(8222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g></g><g data-mml-node="mrow" transform="translate(220,-710)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">大</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">宽</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g><g data-mml-node="mo" transform="translate(4222.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(5222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(6222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(7222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">宽</text></g><g data-mml-node="mi" transform="translate(8222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g></g><rect width="9422.4" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(9884.7,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(10606.9,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(10995.9,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(11995.9,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">大</text></g><g data-mml-node="mi" transform="translate(12995.9,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">速</text></g><g data-mml-node="mi" transform="translate(13995.9,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g><g data-mml-node="mo" transform="translate(15218.1,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(16218.3,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(17218.3,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(18218.3,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">速</text></g><g data-mml-node="mi" transform="translate(19218.3,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g><g data-mml-node="mo" transform="translate(20218.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(20829.6,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(21829.8,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(22829.8,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(23829.8,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">速</text></g><g data-mml-node="mi" transform="translate(24829.8,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g></g></g></svg></mjx-container></p></li></ul></li></ul></li></ul></li><li><p>提取目标电流<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align:-2.059ex" xmlns="http://www.w3.org/2000/svg" width="58.438ex" height="5.285ex" role="img" focusable="false" viewBox="0 -1426 25829.8 2336"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">有</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">效</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">宽</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g><g data-mml-node="mo" transform="translate(4222.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(5222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(6222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(7222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">宽</text></g><g data-mml-node="mi" transform="translate(8222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g></g><g data-mml-node="mrow" transform="translate(220,-710)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">大</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">宽</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g><g data-mml-node="mo" transform="translate(4222.2,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(5222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(6222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(7222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">宽</text></g><g data-mml-node="mi" transform="translate(8222.4,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">度</text></g></g><rect width="9422.4" height="60" x="120" y="220"></rect></g><g data-mml-node="mo" transform="translate(9884.7,0)"><path data-c="2217" d="M229 286Q216 420 216 436Q216 454 240 464Q241 464 245 464T251 465Q263 464 273 456T283 436Q283 419 277 356T270 286L328 328Q384 369 389 372T399 375Q412 375 423 365T435 338Q435 325 425 315Q420 312 357 282T289 250L355 219L425 184Q434 175 434 161Q434 146 425 136T401 125Q393 125 383 131T328 171L270 213Q283 79 283 63Q283 53 276 44T250 35Q231 35 224 44T216 63Q216 80 222 143T229 213L171 171Q115 130 110 127Q106 124 100 124Q87 124 76 134T64 161Q64 166 64 169T67 175T72 181T81 188T94 195T113 204T138 215T170 230T210 250L74 315Q65 324 65 338Q65 353 74 363T98 374Q106 374 116 368T171 328L229 286Z"></path></g><g data-mml-node="mo" transform="translate(10606.9,0)"><path data-c="28" d="M94 250Q94 319 104 381T127 488T164 576T202 643T244 695T277 729T302 750H315H319Q333 750 333 741Q333 738 316 720T275 667T226 581T184 443T167 250T184 58T225 -81T274 -167T316 -220T333 -241Q333 -250 318 -250H315H302L274 -226Q180 -141 137 -14T94 250Z"></path></g><g data-mml-node="mi" transform="translate(10995.9,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(11995.9,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">大</text></g><g data-mml-node="mi" transform="translate(12995.9,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">电</text></g><g data-mml-node="mi" transform="translate(13995.9,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">流</text></g><g data-mml-node="mo" transform="translate(15218.1,0)"><path data-c="2212" d="M84 237T84 250T98 270H679Q694 262 694 250T679 230H98Q84 237 84 250Z"></path></g><g data-mml-node="mi" transform="translate(16218.3,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(17218.3,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(18218.3,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">电</text></g><g data-mml-node="mi" transform="translate(19218.3,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">流</text></g><g data-mml-node="mo" transform="translate(20218.3,0)"><path data-c="29" d="M60 749L64 750Q69 750 74 750H86L114 726Q208 641 251 514T294 250Q294 182 284 119T261 12T224 -76T186 -143T145 -194T113 -227T90 -246Q87 -249 86 -250H74Q66 -250 63 -250T58 -247T55 -238Q56 -237 66 -225Q221 -64 221 250T66 725Q56 737 55 738Q55 746 60 749Z"></path></g><g data-mml-node="mo" transform="translate(20829.6,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mi" transform="translate(21829.8,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">最</text></g><g data-mml-node="mi" transform="translate(22829.8,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">小</text></g><g data-mml-node="mi" transform="translate(23829.8,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">电</text></g><g data-mml-node="mi" transform="translate(24829.8,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">流</text></g></g></g></svg></mjx-container></p><ul><li>如果DIR引脚为低电平，则目标电流为负值</li></ul></li></ul><h3 id="系统定时器"><a href="#系统定时器" class="headerlink" title="系统定时器"></a>系统定时器</h3><p>核心时钟</p><p>服务函数：<code>SysTick_Handler(void)</code></p><p>功能：</p><ul><li><p>提供1ms定时操作</p></li><li><p>20khz运行：</p><ul><li><p>采集编码器数据</p></li><li><p>采集电源数据</p></li><li><p>运动控制（在校准时跳过）</p><ul><li><p>校准时：调用校准器中断回调函数</p><ul><li>标定失能状态操作：<ul><li>输出到1圈位置</li><li>采集清零</li><li>下一个循环跳到 <code>编码器正转自动校准</code> 状态</li><li>初始化标志</li></ul></li><li>编码器正转自动校准：<ul><li>正转个1圈</li><li>跳入 <code>正向测量</code> 状态</li></ul></li><li>正向测量：<ul><li>每到达采集细分量点采集一次数据</li><li>采集入数组</li><li>采集计数清零</li><li>移动位置</li><li>跳入 <code>反向回退</code> 状态</li></ul></li><li>反向回退：<ul><li>转圈到（2*Move_Pulse_NUM+Move_DIVIDE_NUM*20）</li><li>跳入<code>反向消差</code></li></ul></li><li>反向消差：<ul><li>转动回2圈的位置</li></ul></li><li>反向测量：<ul><li>记录数据</li><li>采集计数清零</li><li>移动位置</li><li>跳入<code>解算</code></li></ul></li><li>解算：</li></ul></li><li><p>校准后：调用电机控制回调函数</p><ul><li><p>判断首次进入控制回调</p><ul><li>位置读取初始化（读取单圈位置、上次单圈位置、位置、上次位置），均为mt6816校准数据</li><li>跳出第一次循环</li></ul></li><li><p>采集数据</p><ul><li><p>读取单圈位置（本次与上一次）</p></li><li><p>回环检测</p><p>对位置取增量，并将增量限制在(-单圈脉冲数/2，单圈脉冲数/2)范围内，并环状循环。</p></li><li><p>累加实际位置</p></li></ul></li><li><p>数据估计</p><ul><li>估计速度</li><li>估计位置</li><li>估计误差</li></ul></li><li><p>运动控制</p><ul><li>输出休眠（堵转标志置位、软目标_失能指令、编码器校准表无效 时触发）<ul><li>清除积分</li><li>清FOC位置</li><li>清FOC电流</li><li>驱动休眠</li></ul></li><li>输出刹车（软目标_刹车指令 时触发）<ul><li>清除积分</li><li>清FOC位置</li><li>清FOC电流</li><li>驱动刹车</li></ul></li><li>运动模式分支<ul><li>停止<code>Control_Mode_Stop</code></li><li>DIG(CAN/RS485)位置、速度、电流、运动重构器</li><li>MoreIO(PWM/PUL)位置、速度、电流、位置插补器</li></ul></li></ul></li><li><p>模式变更</p><p>当控制模式改变时，根据改变后的序号重新配置工作模式，各个工作模式同上一步中的运动模式分支。</p></li><li><p>硬目标提取</p><p>根据当前运行在的配置，提取硬目标。</p><p>其中，</p><ul><li><p>当运行在DIG(CAN/RS485)中的四个模式时，应目标由通讯任务推入</p></li><li><p>当运行在PWM模式时，硬目标通过MoreIO接口获得，并在这里赋值</p></li><li><p>当运行在PULSE模式时，硬目标通过MoreIO接口获得，但只提取目标位置、目标失能、目标刹车</p></li></ul><p>同时，这一部分中对应目标的最大最小速度、最大最小电流进行了限制。</p></li><li><p>触发信号发生器新动作</p><p>当失能指令关闭、刹车指令关闭时，额外的触发新发生器（新软目标曲线：<code>motor_control.soft_new_curve = true</code>）</p><ul><li>控制重载和功率模块唤醒<ul><li>清除控制积分项目</li><li>清除堵转识别</li><li>根据不同模式开始各自的新任务</li></ul></li></ul></li><li><p>软目标提取</p><ul><li><p>提取(软位置,软速度,软电流)</p><p>获取所需的立即速度、位置、电流</p></li><li><p>提取(软失能,软刹车)</p></li><li><p>获取所需的立即速度、位置、电流</p></li></ul></li><li><p>状态识别</p><ul><li>检测堵转</li><li>检测过载</li></ul></li><li><p>状态记录</p><p>系统运行的状态下，当各自要求的软硬目标相等时，及那个电机控制器的状态变量（<code>motor_control.state</code>）赋值为软应目标匹配（<code>Control_State_Finish</code>）</p></li></ul></li></ul></li><li><p>循环计时令循环每20ms运行一次</p></li></ul></li></ul><h3 id="Modbus-TX-DMA中断"><a href="#Modbus-TX-DMA中断" class="headerlink" title="Modbus_TX_DMA中断"></a>Modbus_TX_DMA中断</h3><p>响应发送完成</p><p>服务函数：<code>DMA1_Channel4_IRQHandler(void)</code></p><p>主要使用HAL库里的DMA接收服务函数，将数据传到 <code>hdma_usart1_tx</code> 中</p><h3 id="Modbus-RX-DMA中断"><a href="#Modbus-RX-DMA中断" class="headerlink" title="Modbus_RX_DMA中断"></a>Modbus_RX_DMA中断</h3><p>响应接收完成</p><p>服务函数：<code>DMA1_Channel5_IRQHandler(void);</code></p><p>主要使用HAL库里的DMA接收服务函数，将数据传到 <code>hdma_usart1_rx</code> 中</p><h3 id="Modbus-UART中断"><a href="#Modbus-UART中断" class="headerlink" title="Modbus_UART中断"></a>Modbus_UART中断</h3><p>响应串口收发中断</p><p>服务函数：<code>USART1_IRQHandler(void)</code></p><p>功能：</p><ul><li>调用HAL的UART中断处理函数,以清理未知的中断事件</li><li>检测串口是否产生了空闲中断</li><li>进入用户服务函数：<ul><li>停止串口接收</li><li>拷贝数据到接收中转区<ul><li>获得接收到的数据量</li><li>拷贝(<code>memcpy(void *, const void *, size_t)</code>)</li></ul></li><li>开始DMA接收</li><li>调用外部接收完成回调函数（指向函数的指针）<ul><li>该指针在 <code>Uart_Mixed_Init()</code> 函数调用时初始化，但是目前暂未找到这个函数的初始化位置。</li></ul></li></ul></li></ul><h1 id="代码配套函数定义"><a href="#代码配套函数定义" class="headerlink" title="代码配套函数定义"></a>代码配套函数定义</h1><h2 id="按键"><a href="#按键" class="headerlink" title="按键"></a>按键</h2><h3 id="头文件"><a href="#头文件" class="headerlink" title="头文件"></a>头文件</h3><ul><li>Debug/button.h</li></ul><h3 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Button_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>								<span class="token comment">//按键初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>按键初始化函数</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Button_Scan_ms</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> _time<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//定时扫描</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>定时扫描按键</p><ul><li>参数：_time：两次扫描的间隔时长</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c">Button_State_Typedef <span class="token function">Button_Inquice_State</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> button_num<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//获取按键状态</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>定时扫描按键</p><ul><li>参数：button_num：按键号</li><li>返回：<code>Button_State_Typedef</code>对象</li></ul><h3 id="宏定义"><a href="#宏定义" class="headerlink" title="宏定义"></a>宏定义</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Button_Quan</span>		<span class="token expression"><span class="token number">3</span>		</span><span class="token comment">//按键支持数量</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Button_OK</span>			<span class="token expression"><span class="token number">0</span>		</span><span class="token comment">//按键OK编号</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Button_UP</span>			<span class="token expression"><span class="token number">1</span>		</span><span class="token comment">//按键UP编号</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Button_DOWN</span>		<span class="token expression"><span class="token number">2</span>		</span><span class="token comment">//按键DOWN编号</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Button_Shake_Time</span>	<span class="token expression"><span class="token number">20</span>		</span><span class="token comment">//ms去抖时间</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Button_Long_Time</span>	<span class="token expression"><span class="token number">1000</span>	</span><span class="token comment">//ms长按触发时间</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="类型定义"><a href="#类型定义" class="headerlink" title="类型定义"></a>类型定义</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{</span>
	<span class="token comment">//保持状态</span>
	Button_Bit_Up <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>			<span class="token comment">//状态_弹起</span>
	Button_Bit_Shake<span class="token punctuation">,</span>				<span class="token comment">//状态_抖动</span>
	Button_Bit_Press<span class="token punctuation">,</span>				<span class="token comment">//状态_按下</span>
	Button_Bit_Long<span class="token punctuation">,</span>				<span class="token comment">//状态_长按</span>
	<span class="token comment">//边沿状态</span>
	Button_Bit_Drop<span class="token punctuation">,</span>				<span class="token comment">//边沿_按下</span>
	Button_Bit_Rise<span class="token punctuation">,</span>				<span class="token comment">//边沿_弹起</span>
	Button_Bit_LongDrop<span class="token punctuation">,</span>		<span class="token comment">//边沿_长按按下</span>
	Button_Bit_LongRise<span class="token punctuation">,</span>		<span class="token comment">//边沿_长按弹起</span>
<span class="token punctuation">}</span>Button_State_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//数据</span>
	bool					level<span class="token punctuation">;</span>		<span class="token comment">//按键水平</span>
	Button_State_Typedef	state<span class="token punctuation">;</span>		<span class="token comment">//按键状态</span>
	<span class="token class-name">uint32_t</span>			    time_ms<span class="token punctuation">;</span>	<span class="token comment">//按下时间</span>
<span class="token punctuation">}</span>Button_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="OLED"><a href="#OLED" class="headerlink" title="OLED"></a>OLED</h2><h3 id="头文件-1"><a href="#头文件-1" class="headerlink" title="头文件"></a>头文件</h3><ul><li>Debug/ssd1306.h</li></ul><h3 id="函数-1"><a href="#函数-1" class="headerlink" title="函数"></a>函数</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">SSD1306_Write_Data</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> _data<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//写数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>读写操作：写数据</p><ul><li>参数：_data：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">SSD1306_Write_Comm</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> _comm<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//写指令</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>读写操作：写指令</p><ul><li>参数：_comm：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">SSD1306_Display_On</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//屏幕显示开</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>基本指令操作：屏幕显示开</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">SSD1306_Display_Off</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//屏幕显示关</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>基本指令操作：屏幕显示开</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">SSD1306_Color_Reversal</span><span class="token punctuation">(</span>bool	_switch<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//颜色反转</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>基本指令操作：屏幕显示开</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">SSD1306_Orien_Reversal</span><span class="token punctuation">(</span>bool _switch<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//方向反转</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>基本指令操作：屏幕显示开</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">SSD1306_Refresh</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>_gram<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//更新显示</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>基本数据操作：更新显示</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">GRAM_Clear</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>_gram<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//GRAM清空</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>读写GRAM空间操作：GRAM清空</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">GRAM_DrawPoint</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>_gram<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _x<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _y<span class="token punctuation">,</span>bool _switch<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//GRAM打点</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>读写GRAM空间操作：GRAM打点</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">GRAM_DrawLine</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>_gram<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _x<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _y<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _xe<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _ye<span class="token punctuation">,</span>bool _switch<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//GRAM打线</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>读写GRAM空间操作：GRAM打线</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">GRAM_DrawCircle</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>_gram<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _x<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _y<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _radius<span class="token punctuation">,</span>bool _switch<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//GRAM打圆</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>读写GRAM空间操作：GRAM打圆</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">GRAM_ShowPicture</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>_gram<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _x<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _y<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _xs<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _ys<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span><span class="token operator">*</span> pic<span class="token punctuation">,</span>bool _switch<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//GRAM显示图片</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>读写GRAM空间操作：GRAM显示图片</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">GRAM_ShowChar</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>_gram<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _x<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _y<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _char<span class="token punctuation">,</span>CharFont _format<span class="token punctuation">,</span> bool _switch<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//GRAM显示字符</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>读写GRAM空间操作：GRAM显示字符</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">GRAM_ShowString</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>_gram<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _x<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _y<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> <span class="token operator">*</span>_char<span class="token punctuation">,</span>CharFont _format<span class="token punctuation">,</span> bool _switch<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//GRAM显示字符串</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>读写GRAM空间操作：GRAM显示字符串</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">GRAM_ShowNum_LU_Max10</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>_gram<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _x<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _y<span class="token punctuation">,</span> <span class="token class-name">uint32_t</span> _num<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _width<span class="token punctuation">,</span> CharFont _format<span class="token punctuation">,</span> bool _switch<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//GRAM显示LU型数字</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>读写GRAM空间操作：GRAM显示LU型数字</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">GRAM_ShowNum_LI_Max11</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>_gram<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _x<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _y<span class="token punctuation">,</span> <span class="token class-name">int32_t</span> _num<span class="token punctuation">,</span>  <span class="token class-name">uint8_t</span> _width<span class="token punctuation">,</span> CharFont _format<span class="token punctuation">,</span> bool _switch<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//GRAM显示LI型数字</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>读写GRAM空间操作：GRAM显示LI型数字</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">GRAM_ShowNum_Float_Max15</span><span class="token punctuation">(</span><span class="token class-name">uint8_t</span> <span class="token operator">*</span>_gram<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _x<span class="token punctuation">,</span> <span class="token class-name">uint8_t</span> _y<span class="token punctuation">,</span> <span class="token keyword">float</span> _num<span class="token punctuation">,</span>    <span class="token class-name">uint8_t</span> _width<span class="token punctuation">,</span> CharFont _format<span class="token punctuation">,</span> bool _switch<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//GRAM显示Float型数字</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>读写GRAM空间操作：GRAM显示Float型数字</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">SSD1306_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//SSD1306初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>SSD1306初始化</p><ul><li>参数：</li><li>返回：</li></ul><h3 id="宏定义-1"><a href="#宏定义-1" class="headerlink" title="宏定义"></a>宏定义</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Quantity_Row</span>			<span class="token expression"><span class="token number">128</span>		</span><span class="token comment">//行</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Quantity_Column</span>		<span class="token expression"><span class="token number">32</span>		</span><span class="token comment">//列</span></span>
<span class="token keyword">extern</span> <span class="token class-name">uint8_t</span>	ssd1306_gram<span class="token punctuation">[</span><span class="token punctuation">(</span>Quantity_Row<span class="token punctuation">)</span> <span class="token operator">*</span> <span class="token punctuation">(</span>Quantity_Column<span class="token operator">/</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//GRAM空间</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre><blockquote><p>外部变量<code>ssd1306_gram</code>定义在ssd1306.c中，供其他调用ssd1306.h的文件调用</p></blockquote><h3 id="类型定义-1"><a href="#类型定义-1" class="headerlink" title="类型定义"></a>类型定义</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{</span>
	CharFont_0806 <span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">,</span>		<span class="token comment">//0806字符</span>
	CharFont_1206<span class="token punctuation">,</span>					<span class="token comment">//1206字符</span>
	CharFont_1608<span class="token punctuation">,</span>					<span class="token comment">//1608字符</span>
	CharFont_2412<span class="token punctuation">,</span>					<span class="token comment">//1608字符</span>
<span class="token punctuation">}</span>CharFont<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="UI"><a href="#UI" class="headerlink" title="UI"></a>UI</h2><h3 id="头文件-2"><a href="#头文件-2" class="headerlink" title="头文件"></a>头文件</h3><ul><li>Debug/xdrive_ui.h</li></ul><h3 id="函数-2"><a href="#函数-2" class="headerlink" title="函数"></a>函数</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">XDrive_REINui_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>									<span class="token comment">//XDrive_REINui初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>XDrive_REINui初始化</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">XDrive_REINui_Callback_ms</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> _time<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//XDrive_REINui任务回调</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>XDrive_REINui任务回调</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">XDrive_REINui_ToCalibration</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">//XDrive_REINui进入校准界面</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>XDrive_REINui进入校准界面</p><ul><li>参数：</li><li>返回：</li></ul><h3 id="宏定义-2"><a href="#宏定义-2" class="headerlink" title="宏定义"></a>宏定义</h3><h3 id="类型定义-2"><a href="#类型定义-2" class="headerlink" title="类型定义"></a>类型定义</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/******************** 通用数据 ********************/</span>
<span class="token comment">/******************** 通用数据 ********************/</span>
<span class="token comment">/******************** 通用数据 ********************/</span>
<span class="token comment">/**
  * UI数据包
**/</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token class-name">uint32_t</span>	period_ms<span class="token punctuation">;</span>	<span class="token comment">//周期</span>
	<span class="token class-name">uint32_t</span>	flicker_timer_100ms<span class="token punctuation">;</span>		<span class="token comment">//闪烁计时器</span>
	<span class="token class-name">uint32_t</span>	flicker_timer_500ms<span class="token punctuation">;</span>		<span class="token comment">//闪烁计时器</span>
	bool			flicker_flag_100ms<span class="token punctuation">;</span>			<span class="token comment">//闪烁标志</span>
	bool			flicker_flag_500ms<span class="token punctuation">;</span>			<span class="token comment">//闪烁标志</span>
<span class="token punctuation">}</span>REINui_Data_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/******************** 控件 ********************/</span>
<span class="token comment">/******************** 控件 ********************/</span>
<span class="token comment">/******************** 控件 ********************/</span>
<span class="token comment">/**
  * 基本控件
**/</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//用户辨识</span>
	<span class="token class-name">uint8_t</span>		<span class="token operator">*</span>name<span class="token punctuation">;</span>				<span class="token comment">//控件名称</span>
	<span class="token class-name">uint8_t</span>		<span class="token operator">*</span>icon_3232<span class="token punctuation">;</span>		<span class="token comment">//图标(32*32)</span>
	<span class="token comment">//拓扑</span>
	<span class="token keyword">void</span>			<span class="token operator">*</span>source_widget<span class="token punctuation">;</span>		<span class="token comment">//源控件指针(指向来源控件) </span>
	<span class="token keyword">void</span>			<span class="token operator">*</span>linked_widget<span class="token punctuation">;</span>		<span class="token comment">//链表指针(指向同级别下一个控件)</span>
	<span class="token comment">//绘制</span>
	<span class="token comment">//动态刷新</span>
	bool			update_drawing<span class="token punctuation">;</span>											<span class="token comment">//绘制刷新</span>
	<span class="token keyword">void</span>			<span class="token punctuation">(</span><span class="token operator">*</span>drawing_function<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token operator">*</span> widget<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//绘制函数</span>
	<span class="token comment">//高级功能包(由于C无法实现继承,故使用该方法实现在统一引用下定义不同数据)</span>
	<span class="token keyword">void</span>			<span class="token operator">*</span>feature_pack<span class="token punctuation">;</span>		<span class="token comment">//高级功能包</span>
<span class="token punctuation">}</span>REINui_Widget_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/**
  * 高级包(过度动画)
**/</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	REINui_Widget_Typedef		<span class="token operator">*</span>begin_widget<span class="token punctuation">;</span>		<span class="token comment">//起始控件</span>
	REINui_Widget_Typedef		<span class="token operator">*</span>end_widget<span class="token punctuation">;</span>			<span class="token comment">//结束控件</span>
	<span class="token class-name">uint32_t</span>	duration_ms<span class="token punctuation">;</span>			<span class="token comment">//过度时间</span>
<span class="token punctuation">}</span>REINui_Switches_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/**
  * 高级包(目录)
**/</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//项目指示</span>
	<span class="token keyword">void</span>			<span class="token operator">*</span>target_widget<span class="token punctuation">;</span>		<span class="token comment">//目标控件指针(指向列表的第一个单元)</span>
	<span class="token class-name">uint32_t</span>	list_size<span class="token punctuation">;</span>				<span class="token comment">//目录列表大小</span>
	<span class="token class-name">uint32_t</span>	pitch_number<span class="token punctuation">;</span>			<span class="token comment">//选中的项目编号(0开始)</span>
	<span class="token comment">//过程变量(无需全局)</span>
	REINui_Widget_Typedef		<span class="token operator">*</span>up_widget<span class="token punctuation">;</span>				<span class="token comment">//上项目</span>
	REINui_Widget_Typedef		<span class="token operator">*</span>middle_widget<span class="token punctuation">;</span>		<span class="token comment">//中项目</span>
	REINui_Widget_Typedef		<span class="token operator">*</span>down_widget<span class="token punctuation">;</span>			<span class="token comment">//下项目</span>
<span class="token punctuation">}</span>REINui_Directory_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="MT6816-1"><a href="#MT6816-1" class="headerlink" title="MT6816"></a>MT6816</h2><h3 id="头文件-3"><a href="#头文件-3" class="headerlink" title="头文件"></a>头文件</h3><ul><li>Base_Drivers/mt6816.h</li></ul><h3 id="宏定义-3"><a href="#宏定义-3" class="headerlink" title="宏定义"></a>宏定义</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//MT6816工作模式定义</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MT6816_Mode_PWM</span>		<span class="token expression"><span class="token punctuation">(</span><span class="token number">0x01</span><span class="token punctuation">)</span>	</span><span class="token comment">//MT6816工作在PWM模式		(支持该模式的硬件版本：XDrive_REIN_Basic_H1_0)</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MT6816_Mode_ABZ</span>		<span class="token expression"><span class="token punctuation">(</span><span class="token number">0x02</span><span class="token punctuation">)</span>	</span><span class="token comment">//MT6816工作在ABZ模式		(支持该模式的硬件版本：XDrive_REIN_Basic_H1_0)</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MT6816_Mode_SPI</span>		<span class="token expression"><span class="token punctuation">(</span><span class="token number">0x03</span><span class="token punctuation">)</span>	</span><span class="token comment">//MT6816工作在SPI模式		(支持该模式的硬件版本：XDrive_REIN_Basic_H1_0 / XDrive_REIN_Basic_H1_1)</span></span>

<span class="token comment">//MT6816工作模式配置</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">MT6816_Mode</span>		<span class="token expression">MT6816_Mode_SPI</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="公共函数"><a href="#公共函数" class="headerlink" title="公共函数"></a>公共函数</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_MT6816_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>							<span class="token comment">//MT6816初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>按键初始化函数</p><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_MT6816_Get_AngleData</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//MT6816获取角度数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><p>定时扫描按键</p><ul><li>参数：_time：两次扫描的间隔时长</li><li>返回：</li></ul><h3 id="公共类型定义"><a href="#公共类型定义" class="headerlink" title="公共类型定义"></a>公共类型定义</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token class-name">uint16_t</span>	angle_data<span class="token punctuation">;</span>				<span class="token comment">//角度数据</span>
	<span class="token class-name">uint16_t</span>	rectify_angle<span class="token punctuation">;</span>		<span class="token comment">//校准的角度数据</span>
	bool			rectify_valid<span class="token punctuation">;</span>		<span class="token comment">//校准数据有效标志</span>
<span class="token punctuation">}</span>MT6816_Typedef<span class="token punctuation">;</span>
<span class="token keyword">extern</span> MT6816_Typedef	mt6816<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="PWM模式"><a href="#PWM模式" class="headerlink" title="PWM模式"></a>PWM模式</h3><h4 id="函数-3"><a href="#函数-3" class="headerlink" title="函数"></a>函数</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_MT6816_PWM_Signal_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//MT6816_PWM采集初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_MT6816_PWM_TIM_Callback</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//MT6816_PWM采集中断回调</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_MT6816_PWM_Get_AngleData</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//MT6816_PWM获取角度数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h4 id="类型定义-3"><a href="#类型定义-3" class="headerlink" title="类型定义"></a>类型定义</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//采集数据(PWM)</span>
	<span class="token class-name">uint16_t</span>	h_width<span class="token punctuation">;</span>				<span class="token comment">//PWM高宽度</span>
	<span class="token class-name">uint16_t</span>	period<span class="token punctuation">;</span>					<span class="token comment">//PWM周期</span>
	<span class="token class-name">uint8_t</span>		count_rising<span class="token punctuation">;</span>		<span class="token comment">//PWM上升沿计数器镜像</span>
	<span class="token class-name">uint8_t</span>		count_falling<span class="token punctuation">;</span>	<span class="token comment">//PWM下降沿计数器镜像</span>
	<span class="token class-name">uint8_t</span>		count_update<span class="token punctuation">;</span>		<span class="token comment">//PWM更新计数器</span>
	bool		whole_h_flag<span class="token punctuation">;</span>			<span class="token comment">//PWM全高标志</span>
	bool		whole_l_flag<span class="token punctuation">;</span>			<span class="token comment">//PWM全低标志</span>
	bool		ready_once<span class="token punctuation">;</span>				<span class="token comment">//PWM就绪标志(完成一次PWM采集后置位)</span>
	bool		ready_again<span class="token punctuation">;</span>			<span class="token comment">//PWM就绪标志(完成二次PWM采集后置位)</span>
	<span class="token class-name">uint16_t</span>	valid_width<span class="token punctuation">;</span>		<span class="token comment">//PWM有效宽度</span>
	<span class="token comment">//输出数据(PWM)</span>
	<span class="token class-name">uint16_t</span>	angle<span class="token punctuation">;</span>						
<span class="token punctuation">}</span>MT6816_PWM_Signal_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="ABZ模式"><a href="#ABZ模式" class="headerlink" title="ABZ模式"></a>ABZ模式</h3><h4 id="函数-4"><a href="#函数-4" class="headerlink" title="函数"></a>函数</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_MT6816_ABZ_Signal_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//MT6816_ABZ采集初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_MT6816_ABZ_ZPulse_Callback</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//MT6816_ABZ采集Z脉冲中断回调</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_MT6816_ABZ_Get_AngleData</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//MT6816_ABZ获取角度数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h4 id="类型定义-4"><a href="#类型定义-4" class="headerlink" title="类型定义"></a>类型定义</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//采集数据(ABZ)</span>
	<span class="token class-name">uint16_t</span>	sample_data<span class="token punctuation">;</span>	<span class="token comment">//ABZ读取到的数据</span>
	<span class="token comment">//输出数据(ABZ)</span>
	<span class="token class-name">uint16_t</span>	angle<span class="token punctuation">;</span>				<span class="token comment">//ABZ输出的角度</span>
<span class="token punctuation">}</span>MT6816_ABZ_Signal_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="SPI模式"><a href="#SPI模式" class="headerlink" title="SPI模式"></a>SPI模式</h3><h4 id="函数-5"><a href="#函数-5" class="headerlink" title="函数"></a>函数</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_MT6816_SPI_Signal_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//MT6816_SPI采集初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">RINE_MT6816_SPI_Get_AngleData</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//MT6816_SPI采集获取角度数据</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h4 id="类型定义-5"><a href="#类型定义-5" class="headerlink" title="类型定义"></a>类型定义</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//采集数据</span>
	<span class="token class-name">uint16_t</span>	sample_data<span class="token punctuation">;</span>	<span class="token comment">//SPI读取到的数据</span>
	<span class="token comment">//输出数据</span>
	<span class="token class-name">uint16_t</span>	angle<span class="token punctuation">;</span>				<span class="token comment">//SPI输出的角度</span>
	bool			no_mag_flag<span class="token punctuation">;</span>	<span class="token comment">//磁铁数据有效标志</span>
	bool			pc_flag<span class="token punctuation">;</span>			<span class="token comment">//奇偶校验位</span>
<span class="token punctuation">}</span>MT6816_SPI_Signal_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="Signal-port（信号接口）"><a href="#Signal-port（信号接口）" class="headerlink" title="Signal_port（信号接口）"></a>Signal_port（信号接口）</h2><h3 id="头文件-4"><a href="#头文件-4" class="headerlink" title="头文件"></a>头文件</h3><ul><li>Base_Drivers/signal_port.h</li></ul><h3 id="Modbus接口"><a href="#Modbus接口" class="headerlink" title="Modbus接口"></a>Modbus接口</h3><h4 id="函数-6"><a href="#函数-6" class="headerlink" title="函数"></a>函数</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Modbus_Set_ID</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//设置Modbus接口ID</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Modbus_Set_Default</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>							<span class="token comment">//Modbus配置恢复</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Modbus_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>										<span class="token comment">//Modbus接口初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Modbus_Low_Priority_Callback</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//Modbus低优先级回调</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h4 id="宏定义-4"><a href="#宏定义-4" class="headerlink" title="宏定义"></a>宏定义</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//Demo_Dir</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Modbus_Dir_Master</span>			<span class="token expression"><span class="token number">0x00</span>			</span><span class="token comment">//主机</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Modbus_Dir_Slaves</span>			<span class="token expression"><span class="token number">0x01</span>			</span><span class="token comment">//从机</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Demo4_Dir</span>			<span class="token expression">Modbus_Dir_Master</span></span>
<span class="token keyword">extern</span> Signal_Modbus_Typedef signal_modbus<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="类型定义-6"><a href="#类型定义-6" class="headerlink" title="类型定义"></a>类型定义</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/**
  * Modbus接口结构体
**/</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//配置(ID)</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_Modbus_ID</span>	<span class="token expression"><span class="token number">1</span>			</span><span class="token comment">//默认</span></span>
	bool			valid_modbus_id<span class="token punctuation">;</span>			<span class="token comment">//Modbus_ID配置有效</span>
	<span class="token comment">//配置</span>
	<span class="token class-name">uint16_t</span>	id_run<span class="token punctuation">;</span>					<span class="token comment">//ID</span>
	<span class="token class-name">uint16_t</span>	id_order<span class="token punctuation">;</span>				<span class="token comment">//Modbus_ID(存储数据,下次一定)</span>
<span class="token punctuation">}</span>Signal_Modbus_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Signal-Count接口"><a href="#Signal-Count接口" class="headerlink" title="Signal_Count接口"></a>Signal_Count接口</h3><h4 id="函数-7"><a href="#函数-7" class="headerlink" title="函数"></a>函数</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//参数配置</span>
<span class="token keyword">void</span> <span class="token function">Signal_Count_SetFraction</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> freq<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//Signal_Count设置细分值</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Count_SetEnInve</span><span class="token punctuation">(</span>bool control<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//Signal_Count设置使能翻转</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Count_SetDirInve</span><span class="token punctuation">(</span>bool control<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//Signal_Count设置方向翻转</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//初始化</span>
<span class="token keyword">void</span> <span class="token function">Signal_Count_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">//Signal_Count采集初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//功能接口</span>
<span class="token keyword">void</span> <span class="token function">Signal_Count_Config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//Signal_Count采集配置</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Count_DeConfig</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//Signal_Count清理配置</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Count_Capture_Goal</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//Signal_Count获取目标</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Count_Dir_Res</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//Signal_Count计数器方向变更处理,由(初始化/方向设置/外部中断)触发</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h4 id="宏定义-5"><a href="#宏定义-5" class="headerlink" title="宏定义"></a>宏定义</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> Signal_Count_Typedef sg_cut<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="类型定义-7"><a href="#类型定义-7" class="headerlink" title="类型定义"></a>类型定义</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/**
  * Signal_Count接口结构体
**/</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//配置</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> 	<span class="token macro-name">De_SubDivide</span>	<span class="token expression"><span class="token number">16</span>			</span><span class="token comment">//默认</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_EN_inve</span>		<span class="token expression">false		</span><span class="token comment">//默认</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_DIR_inve</span>		<span class="token expression">false		</span><span class="token comment">//默认</span></span>
	bool			valid_subdivide<span class="token punctuation">;</span>	<span class="token comment">//细分配置有效</span>
	bool			valid_en_inve<span class="token punctuation">;</span>		<span class="token comment">//使能信号配置有效</span>
	bool			valid_dir_inve<span class="token punctuation">;</span>		<span class="token comment">//方向信号配置有效</span>
	<span class="token comment">//配置</span>
	<span class="token class-name">uint16_t</span>	subdivide<span class="token punctuation">;</span>			<span class="token comment">//脉冲信号细分</span>
	<span class="token class-name">uint16_t</span>	subdivide_form<span class="token punctuation">;</span>	<span class="token comment">//细分映射</span>
	bool			en_inve<span class="token punctuation">;</span>				<span class="token comment">//使能信号翻转(false:)</span>
	bool			dir_inve<span class="token punctuation">;</span>				<span class="token comment">//方向信号翻转(false:高电平增-低电平减   true:高电平减-低电平增)	//采集数据(公共EN)</span>
	<span class="token comment">//采集数据(公共EN)</span>
	bool			en_valid<span class="token punctuation">;</span>				<span class="token comment">//En有效标志</span>
	<span class="token comment">//采集数据(STEP)(基本脉冲处理)</span>
	<span class="token class-name">int16_t</span>		sampling_count_last<span class="token punctuation">;</span>	<span class="token comment">//采样脉冲计数器(必须i16)</span>
	<span class="token class-name">int16_t</span>		sampling_count<span class="token punctuation">;</span>				<span class="token comment">//采样脉冲计数器(必须i16)</span>
	<span class="token class-name">int16_t</span>		sampling_count_sub<span class="token punctuation">;</span>		<span class="token comment">//采样脉冲差值(必须i16)</span>
	<span class="token comment">//采集数据(STEP)(缓冲输出)</span>
	<span class="token class-name">int32_t</span>		interp_out<span class="token punctuation">;</span>					<span class="token comment">//插补输出(用于输出到控制)</span>
<span class="token punctuation">}</span>Signal_Count_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="Signal-PWM接口"><a href="#Signal-PWM接口" class="headerlink" title="Signal_PWM接口"></a>Signal_PWM接口</h3><h4 id="函数-8"><a href="#函数-8" class="headerlink" title="函数"></a>函数</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//参数配置</span>
<span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_TopWidth</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> width<span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//Signal_PWM设置最大脉宽</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_BottomWidth</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> width<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//Signal_PWM设置最小脉宽</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_TopLocation</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> location<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//Signal_PWM设置最大脉宽表示位置</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_BottomLocation</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> location<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//Signal_PWM设置最小脉宽表示位置</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_TopSpeed</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> speed<span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//Signal_PWM设置最大脉宽表示速度</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_BottomSpeed</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> speed<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//Signal_PWM设置最小脉宽表示速度</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_TopCurrent</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//Signal_PWM设置最大脉宽表示电流</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_BottomCurrent</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//Signal_PWM设置最小脉宽表示电流</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_Default</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>							<span class="token comment">//Signal_PWM参数恢复</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//初始化</span>
<span class="token keyword">void</span> <span class="token function">Signal_PWM_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>							<span class="token comment">//Signal_PWM采集初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//功能接口</span>
<span class="token keyword">void</span> <span class="token function">Signal_PWM_Config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">//Signal_PWM采集配置</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_DeConfig</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">//Signal_PWM清理配置</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Capture_Goal</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//Signal_PWM获取目标</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_TIM_Callback</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//Signal_PWM采集中断回调</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h4 id="宏定义-6"><a href="#宏定义-6" class="headerlink" title="宏定义"></a>宏定义</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> Signal_PWM_Typedef sg_pwm<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="类型定义-8"><a href="#类型定义-8" class="headerlink" title="类型定义"></a>类型定义</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//配置</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_TOP_Width</span>				<span class="token expression"><span class="token punctuation">(</span><span class="token number">20</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>							</span><span class="token comment">//默认(20ms)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_BOTTOM_Width</span>			<span class="token expression"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>											</span><span class="token comment">//默认(0ms)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_TOP_Location</span>			<span class="token expression"><span class="token punctuation">(</span>Move_Pulse_NUM <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>		</span><span class="token comment">//默认(半圈)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_BOTTOM_Location</span>	<span class="token expression"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>											</span><span class="token comment">//默认(0p)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_TOP_Speed</span>				<span class="token expression"><span class="token punctuation">(</span>Move_Rated_Speed<span class="token punctuation">)</span>			</span><span class="token comment">//默认(额定速度)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_BOTTOM_Speed</span>			<span class="token expression"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>											</span><span class="token comment">//默认(0p/s)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_TOP_Current</span>			<span class="token expression"><span class="token punctuation">(</span>Current_Rated_Current<span class="token punctuation">)</span>	</span><span class="token comment">//默认(额定电流)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_BOTTOM_Current</span>		<span class="token expression"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>											</span><span class="token comment">//默认(0A)</span></span>
	bool			valid_top_width<span class="token punctuation">;</span>				<span class="token comment">//各种有效标志</span>
	bool			valid_bottom_width<span class="token punctuation">;</span>			<span class="token comment">//各种有效标志</span>
	bool			valid_top_location<span class="token punctuation">;</span>			<span class="token comment">//各种有效标志</span>
	bool			valid_bottom_location<span class="token punctuation">;</span>	<span class="token comment">//各种有效标志</span>
	bool			valid_top_speed<span class="token punctuation">;</span>				<span class="token comment">//各种有效标志</span>
	bool			valid_bottom_speed<span class="token punctuation">;</span>			<span class="token comment">//各种有效标志</span>
	bool			valid_top_current<span class="token punctuation">;</span>			<span class="token comment">//各种有效标志</span>
	bool			valid_bottom_current<span class="token punctuation">;</span>		<span class="token comment">//各种有效标志</span>
	<span class="token comment">//配置</span>
	<span class="token class-name">uint16_t</span>	top_width<span class="token punctuation">;</span>				<span class="token comment">//Top_PWM</span>
	<span class="token class-name">uint16_t</span>	bottom_width<span class="token punctuation">;</span>			<span class="token comment">//Bottom_PWM</span>
	<span class="token class-name">int32_t</span>		top_location<span class="token punctuation">;</span>			<span class="token comment">//Top_Location</span>
	<span class="token class-name">int32_t</span>		bottom_location<span class="token punctuation">;</span>	<span class="token comment">//Bottom_Location</span>
	<span class="token class-name">int32_t</span>		top_speed<span class="token punctuation">;</span>				<span class="token comment">//Top_Speed</span>
	<span class="token class-name">int32_t</span>		bottom_speed<span class="token punctuation">;</span>			<span class="token comment">//Bottom_Speed</span>
	<span class="token class-name">int16_t</span>		top_current<span class="token punctuation">;</span>			<span class="token comment">//Top_Current</span>
	<span class="token class-name">int16_t</span>		bottom_current<span class="token punctuation">;</span>		<span class="token comment">//Bottom_Current</span>
	<span class="token comment">//采集数据(PWM)</span>
	<span class="token class-name">uint16_t</span>	h_width<span class="token punctuation">;</span>				<span class="token comment">//PWM高宽度</span>
	<span class="token class-name">uint16_t</span>	period<span class="token punctuation">;</span>					<span class="token comment">//PWM周期</span>
	<span class="token class-name">uint8_t</span>		count_rising<span class="token punctuation">;</span>		<span class="token comment">//PWM上升沿计数器镜像</span>
	<span class="token class-name">uint8_t</span>		count_falling<span class="token punctuation">;</span>	<span class="token comment">//PWM下降沿计数器镜像</span>
	<span class="token class-name">uint8_t</span>		count_update<span class="token punctuation">;</span>		<span class="token comment">//PWM更新计数器</span>
	bool		whole_h_flag<span class="token punctuation">;</span>			<span class="token comment">//PWM全高标志</span>
	bool		whole_l_flag<span class="token punctuation">;</span>			<span class="token comment">//PWM全低标志</span>
	bool		ready_first<span class="token punctuation">;</span>			<span class="token comment">//PWM就绪标志(完成一次PWM采集后置位)</span>
	bool		ready_second<span class="token punctuation">;</span>			<span class="token comment">//PWM就绪标志(完成二次PWM采集后置位)</span>
	bool		ready_third<span class="token punctuation">;</span>			<span class="token comment">//PWM就绪标志(完成三次PWM采集后置位)</span>
	<span class="token class-name">uint16_t</span>	valid_width<span class="token punctuation">;</span>		<span class="token comment">//PWM有效宽度</span>
<span class="token punctuation">}</span>Signal_PWM_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="MoreIO接口-即公共接口"><a href="#MoreIO接口-即公共接口" class="headerlink" title="MoreIO接口(即公共接口)"></a>MoreIO接口(即公共接口)</h3><h4 id="函数-9"><a href="#函数-9" class="headerlink" title="函数"></a>函数</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_MoreIO_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>									<span class="token comment">//MoreIO初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_MoreIO_Config</span><span class="token punctuation">(</span>MoreIO_Mode data<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//MoreIO配置工作模式</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_MoreIO_Capture_Goal</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>					<span class="token comment">//MoreIO获取目标</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h4 id="宏定义-7"><a href="#宏定义-7" class="headerlink" title="宏定义"></a>宏定义</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> Signal_MoreIO_Typedef signal_moreio<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h4 id="类型定义-9"><a href="#类型定义-9" class="headerlink" title="类型定义"></a>类型定义</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/**
  * MoreIO接口模式
***/</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{</span>
	MoreIO_Mode_Disable <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">,</span>		<span class="token comment">//Disable</span>
	MoreIO_Mode_PWM_Location<span class="token punctuation">,</span>			<span class="token comment">//PWM位置		(	EN(IO)			PWM(TIM)			NC(IO)		)</span>
	MoreIO_Mode_PWM_Speed<span class="token punctuation">,</span>				<span class="token comment">//PWM速度		(	EN(IO)			PWM(TIM)			DIR(IO)		)</span>
	MoreIO_Mode_PWM_Current<span class="token punctuation">,</span>			<span class="token comment">//PWM电流		(	EN(IO)			PWM(TIM)			DIR(IO)		)</span>
	MoreIO_Mode_PULSE_Locatioon<span class="token punctuation">,</span>	<span class="token comment">//PULSE位置	(	EN(IO)			PULSE(TIM)		DIR(EXTI)	)</span>
<span class="token punctuation">}</span>MoreIO_Mode<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/**
  * MoreIO接口结构体
**/</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//模式</span>
	MoreIO_Mode		mode<span class="token punctuation">;</span>			<span class="token comment">//信号模式</span>
	<span class="token comment">//解析运动数据</span>
	<span class="token class-name">int32_t</span>		goal_location<span class="token punctuation">;</span>	<span class="token comment">//目标位置</span>
	<span class="token class-name">int32_t</span>		goal_speed<span class="token punctuation">;</span>			<span class="token comment">//目标速度</span>
	<span class="token class-name">int16_t</span>		goal_current<span class="token punctuation">;</span>		<span class="token comment">//目标电流</span>
	bool			goal_disable<span class="token punctuation">;</span>		<span class="token comment">//失能指令</span>
	bool			goal_brake<span class="token punctuation">;</span>			<span class="token comment">//刹车指令</span>
<span class="token punctuation">}</span>Signal_MoreIO_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="标定器"><a href="#标定器" class="headerlink" title="标定器"></a>标定器</h2><h3 id="头文件-5"><a href="#头文件-5" class="headerlink" title="头文件"></a>头文件</h3><ul><li>Control/encode_cali.h</li></ul><h3 id="函数-10"><a href="#函数-10" class="headerlink" title="函数"></a>函数</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Calibration_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>								<span class="token comment">//校准器初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Calibration_Interrupt_Callback</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//校准器中断回调(稳定中断调用)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Calibration_Loop_Callback</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>				<span class="token comment">//校准器主程序回调(非中断调用)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h3 id="宏定义-8"><a href="#宏定义-8" class="headerlink" title="宏定义"></a>宏定义</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> Encode_Cali_Typedef encode_cali<span class="token punctuation">;</span><span class="token comment">//py：在头文件里加入了外部变量的声明，使得每次引用这个头文件都可以直接这个变量</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="类型定义-10"><a href="#类型定义-10" class="headerlink" title="类型定义"></a>类型定义</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//校准数据检查报告</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{</span>
	<span class="token comment">//无错误</span>
	CALI_No_Error <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">,</span>						<span class="token comment">//数据无错误</span>
	<span class="token comment">//原始数据出错</span>
	CALI_Error_Average_Dir<span class="token punctuation">,</span>					<span class="token comment">//平均值方向错误</span>
	CALI_Error_Average_Continuity<span class="token punctuation">,</span>	<span class="token comment">//平均值连续性错误</span>
	CALI_Error_PhaseStep<span class="token punctuation">,</span>						<span class="token comment">//阶跃次数错误</span>
	<span class="token comment">//解析数据出错</span>
	CALI_Error_Analysis_Quantity<span class="token punctuation">,</span>		<span class="token comment">//解析数据量错误</span>
<span class="token punctuation">}</span>CALI_Error<span class="token punctuation">;</span>
<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//校准状态</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{</span>
	CALI_Disable <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">,</span>						<span class="token comment">//失能</span>
	CALI_Forward_Encoder_AutoCali<span class="token punctuation">,</span>	<span class="token comment">//编码器正转自动校准</span>
	CALI_Forward_Measure<span class="token punctuation">,</span>						<span class="token comment">//正向测量</span>
	CALI_Reverse_Ret<span class="token punctuation">,</span>								<span class="token comment">//反向回退</span>
	CALI_Reverse_Gap<span class="token punctuation">,</span>								<span class="token comment">//反向消差</span>
	CALI_Reverse_Measure<span class="token punctuation">,</span>						<span class="token comment">//反向测量</span>
	CALI_Operation<span class="token punctuation">,</span>									<span class="token comment">//解算</span>
<span class="token punctuation">}</span>CALI_State<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/**
  * Control校准结构体定义
**/</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//信号</span>
	bool				trigger<span class="token punctuation">;</span>			<span class="token comment">//触发校准</span>
	CALI_Error	error_code<span class="token punctuation">;</span>		<span class="token comment">//校准错误代码</span>
	<span class="token class-name">uint32_t</span>		error_data<span class="token punctuation">;</span>		<span class="token comment">//校准错误数据</span>
	<span class="token comment">//读取过程</span>
	CALI_State	state<span class="token punctuation">;</span>					<span class="token comment">//校准状态</span>
	<span class="token class-name">uint32_t</span>		out_location<span class="token punctuation">;</span>		<span class="token comment">//输出位置</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>			<span class="token macro-name">Gather_Quantity</span>	<span class="token expression"><span class="token number">16</span>	</span><span class="token comment">//每个采集点采集数量</span></span>
	<span class="token class-name">uint16_t</span>		gather_count<span class="token punctuation">;</span>												<span class="token comment">//采集计数</span>
	<span class="token class-name">uint16_t</span>		coder_data_gather<span class="token punctuation">[</span>Gather_Quantity<span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//采集点每次数据</span>
	<span class="token class-name">uint16_t</span> 		coder_data_f<span class="token punctuation">[</span>Move_Step_NUM<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//校准读取的数据</span>
	<span class="token class-name">uint16_t</span> 		coder_data_r<span class="token punctuation">[</span>Move_Step_NUM<span class="token operator">+</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">;</span>	<span class="token comment">//校准读取的数据</span>
	bool				dir<span class="token punctuation">;</span>		<span class="token comment">//校准数据方向</span>
	<span class="token comment">//全段域校准过程数据</span>
	<span class="token class-name">int32_t</span>		rcd_x<span class="token punctuation">,</span> rcd_y<span class="token punctuation">;</span>			<span class="token comment">//寻找区间下标及阶跃差值</span>
	<span class="token class-name">uint32_t</span>	result_num<span class="token punctuation">;</span>				<span class="token comment">//统计数量</span>
<span class="token punctuation">}</span>Encode_Cali_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="电机控制器"><a href="#电机控制器" class="headerlink" title="电机控制器"></a>电机控制器</h2><h3 id="头文件-6"><a href="#头文件-6" class="headerlink" title="头文件"></a>头文件</h3><ul><li>Control/motor_control.h</li></ul><h4 id="电流控制（直接控制）"><a href="#电流控制（直接控制）" class="headerlink" title="电流控制（直接控制）"></a>电流控制（直接控制）</h4><h5 id="函数-11"><a href="#函数-11" class="headerlink" title="函数"></a>函数</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Control_Cur_To_Electric</span><span class="token punctuation">(</span><span class="token class-name">int16_t</span> current<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//电流输出</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h4 id="速度控制（PID控制）"><a href="#速度控制（PID控制）" class="headerlink" title="速度控制（PID控制）"></a>速度控制（PID控制）</h4><h5 id="函数-12"><a href="#函数-12" class="headerlink" title="函数"></a>函数</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Control_PID_SetKP</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> _k<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//KP参数配置</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Control_PID_SetKI</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> _k<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//KI参数配置</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Control_PID_SetKD</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> _k<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//KD参数配置</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Control_PID_Set_Default</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//PID参数恢复</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//初始化</span>
<span class="token keyword">void</span> <span class="token function">Control_PID_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Control_PID_To_Electric</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> _speed<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h5 id="宏定义-9"><a href="#宏定义-9" class="headerlink" title="宏定义"></a>宏定义</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> Control_PID_Typedef pid<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="类型定义-11"><a href="#类型定义-11" class="headerlink" title="类型定义"></a>类型定义</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//配置</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">De_PID_KP</span>	<span class="token expression"><span class="token number">5</span>		</span><span class="token comment">//默认KP</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">De_PID_KI</span>	<span class="token expression"><span class="token number">30</span>	</span><span class="token comment">//默认KI</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">De_PID_KD</span>	<span class="token expression"><span class="token number">0</span>		</span><span class="token comment">//默认KD</span></span>
	bool		valid_kp<span class="token punctuation">,</span> valid_ki<span class="token punctuation">,</span> valid_kd<span class="token punctuation">;</span>	<span class="token comment">//参数有效标志</span>
	<span class="token class-name">int32_t</span>	kp<span class="token punctuation">,</span> ki<span class="token punctuation">,</span> kd<span class="token punctuation">;</span>		<span class="token comment">//参数</span>
	<span class="token comment">//控制参数</span>
	<span class="token class-name">int32_t</span>		v_error<span class="token punctuation">,</span> v_error_last<span class="token punctuation">;</span>	<span class="token comment">//误差记录</span>
	<span class="token class-name">int32_t</span>		op<span class="token punctuation">,</span> oi<span class="token punctuation">,</span> od<span class="token punctuation">;</span>							<span class="token comment">//输出</span>
	<span class="token class-name">int32_t</span>		i_mut<span class="token punctuation">,</span> i_dec<span class="token punctuation">;</span>						<span class="token comment">//小积分处理</span>
	<span class="token class-name">int32_t</span>		out<span class="token punctuation">;</span>										<span class="token comment">//输出</span>
<span class="token punctuation">}</span>Control_PID_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="位置控制（DCE控制）"><a href="#位置控制（DCE控制）" class="headerlink" title="位置控制（DCE控制）"></a>位置控制（DCE控制）</h4><h5 id="函数-13"><a href="#函数-13" class="headerlink" title="函数"></a>函数</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Control_DCE_SetKP</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> _k<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//KP参数配置</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Control_DCE_SetKI</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> _k<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//KI参数配置</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Control_DCE_SetKV</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> _k<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//KV参数配置</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Control_DCE_SetKD</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> _k<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//KD参数配置</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Control_DCE_Set_Default</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//DCE参数恢复</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//初始化</span>
<span class="token keyword">void</span> <span class="token function">Control_DCE_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Control_DCE_To_Electric</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> _location<span class="token punctuation">,</span> <span class="token class-name">int32_t</span> _speed<span class="token punctuation">)</span><span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h5 id="宏定义-10"><a href="#宏定义-10" class="headerlink" title="宏定义"></a>宏定义</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> Control_DCE_Typedef dce<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="类型定义-12"><a href="#类型定义-12" class="headerlink" title="类型定义"></a>类型定义</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//配置</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">De_DCE_KP</span>	<span class="token expression"><span class="token number">200</span>		</span><span class="token comment">//默认KP</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">De_DCE_KI</span>	<span class="token expression"><span class="token number">80</span>		</span><span class="token comment">//默认KI</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">De_DCE_KV</span>	<span class="token expression"><span class="token number">300</span>		</span><span class="token comment">//默认KIV</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">De_DCE_KD</span>	<span class="token expression"><span class="token number">250</span>		</span><span class="token comment">//默认KD</span></span>
	bool		valid_kp<span class="token punctuation">,</span> valid_ki<span class="token punctuation">,</span> valid_kv<span class="token punctuation">,</span> valid_kd<span class="token punctuation">;</span>	<span class="token comment">//参数有效标志</span>
	<span class="token class-name">int32_t</span>	kp<span class="token punctuation">,</span> ki<span class="token punctuation">,</span> kv<span class="token punctuation">,</span> kd<span class="token punctuation">;</span>		<span class="token comment">//参数</span>
	<span class="token comment">//控制参数(基本部分)</span>
	<span class="token class-name">int32_t</span>		p_error<span class="token punctuation">,</span> v_error<span class="token punctuation">;</span>		<span class="token comment">//误差记录</span>
	<span class="token class-name">int32_t</span>		op<span class="token punctuation">,</span> oi<span class="token punctuation">,</span> od<span class="token punctuation">;</span>					<span class="token comment">//输出</span>
	<span class="token class-name">int32_t</span>		i_mut<span class="token punctuation">,</span> i_dec<span class="token punctuation">;</span>				<span class="token comment">//小积分处理</span>
	<span class="token class-name">int32_t</span>		out<span class="token punctuation">;</span>								<span class="token comment">//输出</span>
<span class="token punctuation">}</span>Control_DCE_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h4><h5 id="函数-14"><a href="#函数-14" class="headerlink" title="函数"></a>函数</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_MultiDebug_Location</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//多功能调试位置</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_MultiDebug_Speed</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//多功能调试速度</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h5 id="宏定义-11"><a href="#宏定义-11" class="headerlink" title="宏定义"></a>宏定义</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> Motor_Control_Debug_Typedef mc_debug<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="类型定义-13"><a href="#类型定义-13" class="headerlink" title="类型定义"></a>类型定义</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/**
  * Motor_Control类结构体定义
**/</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//公共调试</span>
	<span class="token class-name">int32_t</span>		mut<span class="token punctuation">;</span>		<span class="token comment">//调试位置</span>
	<span class="token class-name">int32_t</span>		dec<span class="token punctuation">;</span>		<span class="token comment">//调试位置</span>
	<span class="token class-name">int32_t</span>		speed<span class="token punctuation">;</span>	<span class="token comment">//调试速度</span>
<span class="token punctuation">}</span>Motor_Control_Debug_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="电机控制API"><a href="#电机控制API" class="headerlink" title="电机控制API"></a>电机控制API</h4><h5 id="函数-15"><a href="#函数-15" class="headerlink" title="函数"></a>函数</h5><p><em><strong>参数配置</strong></em></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_Control_SetMotorMode</span><span class="token punctuation">(</span>Motor_Mode _mode<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//控制模式</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_Control_SetStallSwitch</span><span class="token punctuation">(</span>bool _switch<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//堵转保护开关</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_Control_SetDefault</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>								<span class="token comment">//控制模式参数恢复</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><p><em><strong>数据写入</strong></em></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_Control_Write_Goal_Location</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//写入目标位置</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_Control_Write_Goal_Speed</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//写入目标速度</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_Control_Write_Goal_Current</span><span class="token punctuation">(</span><span class="token class-name">int16_t</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//写入目标电流</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_Control_Write_Goal_Disable</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//写入目标失能</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_Control_Write_Goal_Brake</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//写入目标刹车</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><p><em><strong>任务执行</strong></em></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_Control_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>								<span class="token comment">//电机控制初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_Control_Callback</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>							<span class="token comment">//控制器任务回调</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_Control_Clear_Integral</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">//清除积分</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Motor_Control_Clear_Stall</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>								<span class="token comment">//清除堵转保护</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token class-name">int32_t</span> <span class="token function">Motor_Control_AdvanceCompen</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> _speed<span class="token punctuation">)</span><span class="token punctuation">;</span><span class="token comment">//超前角补偿</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h5 id="宏定义-12"><a href="#宏定义-12" class="headerlink" title="宏定义"></a>宏定义</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> Motor_Control_Typedef motor_control<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h5 id="类型定义-14"><a href="#类型定义-14" class="headerlink" title="类型定义"></a>类型定义</h5><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/**
  * 控制器状态
**/</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{</span>
	Control_State_Stop				<span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">,</span>	<span class="token comment">//停止</span>
	Control_State_Finish			<span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">,</span>	<span class="token comment">//任务完成</span>
	Control_State_Running			<span class="token operator">=</span> <span class="token number">0x02</span><span class="token punctuation">,</span>	<span class="token comment">//任务执行中</span>
	Control_State_Overload		<span class="token operator">=</span> <span class="token number">0x03</span><span class="token punctuation">,</span>	<span class="token comment">//过载</span>
	Control_State_Stall				<span class="token operator">=</span> <span class="token number">0x04</span><span class="token punctuation">,</span>	<span class="token comment">//堵转</span>
<span class="token punctuation">}</span>Motor_State<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/**
  * 模式
**/</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{</span>
	<span class="token comment">/*****************************************************外部输入量***********信号发生器(可控的运动参数)**开放状态(开放版本)*****/</span>
	<span class="token comment">//测试</span>
	Motor_Mode_Debug_Location		<span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">,</span>	<span class="token comment">//调试位置				NULL									多功能调试信号源						测试版本完整代码</span>
	Motor_Mode_Debug_Speed			<span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">,</span>	<span class="token comment">//调试速度				NULL									多功能调试信号源						测试版本完整代码</span>
	<span class="token comment">//停止</span>
	Control_Mode_Stop						<span class="token operator">=</span> <span class="token number">0x10</span><span class="token punctuation">,</span>	<span class="token comment">//停止						NULL									NULL												NULL</span>
	<span class="token comment">//DIG(CAN/RS485)</span>
	Motor_Mode_Digital_Location	<span class="token operator">=</span> <span class="token number">0x20</span><span class="token punctuation">,</span>	<span class="token comment">//DIG位置					目标位置							位置跟踪器(速度,双加速度)		源码开放(20191101)</span>
	Motor_Mode_Digital_Speed		<span class="token operator">=</span> <span class="token number">0x21</span><span class="token punctuation">,</span>	<span class="token comment">//DIG速度					目标速度							速度跟踪器(双加速度)				源码开放(20191101)</span>
	Motor_Mode_Digital_Current	<span class="token operator">=</span> <span class="token number">0x22</span><span class="token punctuation">,</span>	<span class="token comment">//DIG电流					目标电流							电流跟踪器(双电梯度)				源码开放(20191101)</span>
	Motor_Mode_Digital_Track		<span class="token operator">=</span> <span class="token number">0x23</span><span class="token punctuation">,</span>	<span class="token comment">//DIG轨迹					多指令								运动重构器(运动自寻)				源码开放(20191101)</span>
	<span class="token comment">//MoreIO(PWM/PUL)</span>
	Motor_Mode_PWM_Location			<span class="token operator">=</span> <span class="token number">0x30</span><span class="token punctuation">,</span>	<span class="token comment">//PWM位置_舵机		目标位置							位置跟踪器(速度,双加速度)		源码开放(20191101)</span>
	Motor_Mode_PWM_Speed				<span class="token operator">=</span> <span class="token number">0x31</span><span class="token punctuation">,</span>	<span class="token comment">//PWM速度_调速机	目标速度							速度跟踪器(双加速度)				源码开放(20191101)</span>
	Motor_Mode_PWM_Current			<span class="token operator">=</span> <span class="token number">0x32</span><span class="token punctuation">,</span>	<span class="token comment">//PWM电流_直流机	目标电流							电流跟踪器(双电梯度)				源码开放(20191101)</span>
	Motor_Mode_PULSE_Location		<span class="token operator">=</span> <span class="token number">0x33</span><span class="token punctuation">,</span>	<span class="token comment">//PULSE位置				目标位置							位置插补器(无)							源码开放(20200803)</span>
	<span class="token comment">//Action</span>
	Motor_Mode_QCode						<span class="token operator">=</span> <span class="token number">0x40</span><span class="token punctuation">,</span>	<span class="token comment">//Q指令						NULL									任意												内部测试()</span>
	<span class="token comment">//Demos</span>
	Motor_Mode_Music						<span class="token operator">=</span> <span class="token number">0x50</span><span class="token punctuation">,</span>	<span class="token comment">//音乐						NULL									NULL												内部测试()</span>
<span class="token punctuation">}</span>Motor_Mode<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/**
  * Motor_Control类结构体定义
**/</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//配置(模式)</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>			<span class="token macro-name">De_Motor_Mode</span>		<span class="token expression">Motor_Mode_PULSE_Location	</span><span class="token comment">//默认配置</span></span>
	bool				valid_mode<span class="token punctuation">;</span>		<span class="token comment">//有效标志</span>
	Motor_Mode	mode_order<span class="token punctuation">;</span>		<span class="token comment">//电机模式_新指令的</span>
	<span class="token comment">//配置(堵转)</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>			<span class="token macro-name">De_Motor_Stall</span>	<span class="token expression">true		</span><span class="token comment">//默认堵转保护开关</span></span>
	bool				valid_stall_switch<span class="token punctuation">;</span>			<span class="token comment">//堵转保护开关有效标志</span>
	bool				stall_switch<span class="token punctuation">;</span>						<span class="token comment">//堵转保护开关</span>
	<span class="token comment">//模式</span>
	Motor_Mode	mode_run<span class="token punctuation">;</span>			<span class="token comment">//电机模式_运行中的</span>
	<span class="token comment">//读取</span>
	<span class="token class-name">int32_t</span>		real_lap_location<span class="token punctuation">;</span>				<span class="token comment">//读取单圈位置</span>
	<span class="token class-name">int32_t</span>		real_lap_location_last<span class="token punctuation">;</span>		<span class="token comment">//读取单圈位置</span>
	<span class="token class-name">int32_t</span>		real_location<span class="token punctuation">;</span>						<span class="token comment">//读取位置</span>
	<span class="token class-name">int32_t</span>		real_location_last<span class="token punctuation">;</span>				<span class="token comment">//读取位置</span>
	<span class="token comment">//估计</span>
	<span class="token class-name">int32_t</span>		est_speed_mut<span class="token punctuation">;</span>						<span class="token comment">//估计速度倍值(放大n倍)(mut有积分作用,不会有精度损失)</span>
	<span class="token class-name">int32_t</span>		est_speed<span class="token punctuation">;</span>								<span class="token comment">//估计速度</span>
	<span class="token class-name">int32_t</span>		est_lead_location<span class="token punctuation">;</span>				<span class="token comment">//估计位置超前位置</span>
	<span class="token class-name">int32_t</span>		est_lead_location_debug<span class="token punctuation">;</span>	<span class="token comment">//估计位置超前位置</span>
	<span class="token class-name">int32_t</span>		est_location<span class="token punctuation">;</span>							<span class="token comment">//估计位置</span>
	<span class="token class-name">int32_t</span>		est_error<span class="token punctuation">;</span>								<span class="token comment">//估计位置误差</span>
	<span class="token comment">//硬目标</span>
	<span class="token class-name">int32_t</span>		goal_location<span class="token punctuation">;</span>	<span class="token comment">//目标位置(由信号输入)</span>
	<span class="token class-name">int32_t</span>		goal_speed<span class="token punctuation">;</span>			<span class="token comment">//目标速度(由信号输入)</span>
	<span class="token class-name">int16_t</span>		goal_current<span class="token punctuation">;</span>		<span class="token comment">//目标电流(由信号输入)</span>
	bool			goal_disable<span class="token punctuation">;</span>		<span class="token comment">//目标失能(由信号输入)</span>
	bool			goal_brake<span class="token punctuation">;</span>			<span class="token comment">//目标刹车(由信号输入)</span>
	<span class="token comment">//软目标</span>
	<span class="token class-name">int32_t</span>		soft_location<span class="token punctuation">;</span>	<span class="token comment">//软位置(由 跟踪器/重构器/插补器/硬运算 得到)</span>
	<span class="token class-name">int32_t</span>		soft_speed<span class="token punctuation">;</span>			<span class="token comment">//软速度(由 跟踪器/重构器/插补器/硬运算 得到)</span>
	<span class="token class-name">int16_t</span>		soft_current<span class="token punctuation">;</span>		<span class="token comment">//软电流(由 跟踪器/重构器/插补器/硬运算 得到)</span>
	bool			soft_disable<span class="token punctuation">;</span>		<span class="token comment">//软失能</span>
	bool			soft_brake<span class="token punctuation">;</span>			<span class="token comment">//软刹车</span>
	bool			soft_new_curve<span class="token punctuation">;</span>	<span class="token comment">//新软目标曲线</span>
	<span class="token comment">//输出</span>
	<span class="token class-name">int32_t</span>		foc_location<span class="token punctuation">;</span>		<span class="token comment">//FOC矢量位置</span>
	<span class="token class-name">int32_t</span>		foc_current<span class="token punctuation">;</span>		<span class="token comment">//FOC矢量大小</span>
	<span class="token comment">//堵转识别</span>
	<span class="token class-name">uint32_t</span>	stall_time_us<span class="token punctuation">;</span>	<span class="token comment">//堵转计时器</span>
	bool			stall_flag<span class="token punctuation">;</span>			<span class="token comment">//堵转标志</span>
	<span class="token comment">//过载识别</span>
	<span class="token class-name">uint32_t</span>	overload_time_us<span class="token punctuation">;</span>	<span class="token comment">//过载计时器</span>
	bool			overload_flag<span class="token punctuation">;</span>		<span class="token comment">//过载标志</span>
	<span class="token comment">//状态</span>
	Motor_State		state<span class="token punctuation">;</span>			<span class="token comment">//统一的电机状态</span>
<span class="token punctuation">}</span>Motor_Control_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="GPIO相关API"><a href="#GPIO相关API" class="headerlink" title="GPIO相关API"></a>GPIO相关API</h2><h3 id="函数-16"><a href="#函数-16" class="headerlink" title="函数"></a>函数</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/********** Button **********/</span>
<span class="token keyword">void</span> <span class="token function">REIN_GPIO_Button_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  	 <span class="token comment">//GPIO初始化(Button)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/********** HwElec **********/</span>
<span class="token keyword">void</span> <span class="token function">REIN_GPIO_HwElec_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>   	<span class="token comment">//GPIO初始化(HwElec)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><p><em><strong>任务执行</strong></em></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/********** MT6816 **********/</span>
<span class="token keyword">void</span> <span class="token function">REIN_GPIO_MT6816_ABZ_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//GPIO初始化(MT6816_ABZ)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/********** MT6816 **********/</span>
<span class="token keyword">void</span> <span class="token function">REIN_GPIO_MT6816_SPI_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>  <span class="token comment">//GPIO初始化(MT6916_SPI)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/********** Modbus **********/</span>
<span class="token keyword">void</span> <span class="token function">REIN_GPIO_Modbus_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//GPIO初始化(Modbus)			</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/********** OLED **********/</span>
<span class="token keyword">void</span> <span class="token function">REIN_GPIO_OLED_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			 <span class="token comment">//GPIO初始化(OLED)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/********** SIGNAL **********/</span>
<span class="token keyword">void</span> <span class="token function">REIN_GPIO_SIGNAL_COUNT_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//GPIO初始化(SIGNAL_COUNT)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/********** SIGNAL **********/</span>
<span class="token keyword">void</span> <span class="token function">REIN_GPIO_SIGNAL_COUNT_DeInit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//GPIO清理(SIGNAL_COUNT)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/********** SIGNAL **********/</span>
<span class="token keyword">void</span> <span class="token function">REIN_GPIO_SIGNAL_PWM_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>			<span class="token comment">//GPIO初始化(SIGNAL_PWM)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/********** SIGNAL **********/</span>
<span class="token keyword">void</span> <span class="token function">REIN_GPIO_SIGNAL_PWM_DeInit</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//GPIO清理(SIGNAL_PWM)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h2 id="USART相关API"><a href="#USART相关API" class="headerlink" title="USART相关API"></a>USART相关API</h2><h3 id="函数-17"><a href="#函数-17" class="headerlink" title="函数"></a>函数</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_UART_Modbus_Set_Mode</span><span class="token punctuation">(</span>Uart_Mode value<span class="token punctuation">)</span><span class="token punctuation">;</span>		<span class="token comment">//设置Uart模式</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_UART_Modbus_Set_BaudRate</span><span class="token punctuation">(</span><span class="token class-name">uint32_t</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//设置Uart波特率</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><p><em><strong>任务执行</strong></em></p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_UART_Modbus_Set_Default</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">//串口参数恢复</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_UART_Modbus_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>						<span class="token comment">//UART_Modbus初始化</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">REIN_UART_Modbus_Low_Priority_Callback</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span class="token punctuation">;</span>	<span class="token comment">//Modbus低优先级回调		</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>参数：</li><li>返回：</li></ul><h3 id="宏定义-13"><a href="#宏定义-13" class="headerlink" title="宏定义"></a>宏定义</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//引用端口定义</span>
<span class="token keyword">extern</span> UART_HandleTypeDef huart1<span class="token punctuation">;</span>
<span class="token keyword">extern</span> DMA_HandleTypeDef hdma_usart1_tx<span class="token punctuation">;</span>
<span class="token keyword">extern</span> DMA_HandleTypeDef hdma_usart1_rx<span class="token punctuation">;</span>
<span class="token comment">/********** Modbus **********/</span>
<span class="token keyword">extern</span> Dynamic_Uart_Typedef dyn_uart1<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h3 id="类型定义-15"><a href="#类型定义-15" class="headerlink" title="类型定义"></a>类型定义</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//串口接口默模式</span>
<span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{</span>
	Uart_Mode_1SNP <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">,</span>	<span class="token comment">//(1个停止位) (无校验)</span>
	Uart_Mode_1SEP <span class="token operator">=</span> <span class="token number">0x01</span><span class="token punctuation">,</span>	<span class="token comment">//(1个停止位) (偶数校验)</span>
	Uart_Mode_1SOP <span class="token operator">=</span> <span class="token number">0x02</span><span class="token punctuation">,</span>	<span class="token comment">//(1个停止位) (奇数校验)</span>
	Uart_Mode_2SNP <span class="token operator">=</span> <span class="token number">0x03</span><span class="token punctuation">,</span>	<span class="token comment">//(2个停止位) (无校验)</span>
	Uart_Mode_2SEP <span class="token operator">=</span> <span class="token number">0x04</span><span class="token punctuation">,</span>	<span class="token comment">//(2个停止位) (偶数校验)</span>
	Uart_Mode_2SOP <span class="token operator">=</span> <span class="token number">0x05</span><span class="token punctuation">,</span>	<span class="token comment">//(2个停止位) (奇数校验)</span>
<span class="token punctuation">}</span>Uart_Mode<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">/**
  * 动态串口结构体
**/</span>
<span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//配置(串口模式)</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>			<span class="token macro-name">De_Uart_Mode</span>			<span class="token expression">Uart_Mode_1SNP	</span><span class="token comment">//默认</span></span>
	bool				valid_uart_mode<span class="token punctuation">;</span>									<span class="token comment">//串口模式配置有效</span>
	Uart_Mode		uart_run<span class="token punctuation">;</span>					<span class="token comment">//运行模式</span>
	Uart_Mode		uart_order<span class="token punctuation">;</span>				<span class="token comment">//模式(存储数据,下次一定)</span>
	<span class="token comment">//配置(波特率)</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_Uart_BaudRate</span>	<span class="token expression"><span class="token punctuation">(</span><span class="token number">115200</span><span class="token punctuation">)</span>		</span><span class="token comment">//默认</span></span>
	bool			valid_uart_baudrate<span class="token punctuation">;</span>				<span class="token comment">//串口波特率配置有效</span>
	<span class="token class-name">uint32_t</span>	baud_rate_run<span class="token punctuation">;</span>		<span class="token comment">//波特率</span>
	<span class="token class-name">uint32_t</span>	baud_rate_order<span class="token punctuation">;</span>	<span class="token comment">//波特率(存储数据,下次一定)</span>
<span class="token punctuation">}</span>Dynamic_Uart_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul><li><strong>标题:</strong> XDrive例程分析</li><li><strong>作者:</strong> Chepey</li><li><strong>创建于 :</strong> 2024-02-03 13:00:00</li><li><strong>更新于 :</strong> 2024-02-26 22:17:09</li><li><strong>链接:</strong> https://chepey.github.io/2024/02/03/嵌入式/闭环步进电机/XDrive例程分析/</li><li><strong>版权声明: </strong>版权所有 &#169 Chepey，禁止转载。</li></ul></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/STM32F1/">#STM32F1</a>&nbsp;</li><li class="tag-item"><a href="/tags/3D%E6%89%93%E5%8D%B0%E6%9C%BA/">#3D打印机</a>&nbsp;</li><li class="tag-item"><a href="/tags/%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/">#步进电机</a>&nbsp;</li><li class="tag-item"><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/">#嵌入式开发</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2024/02/17/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/XDrive%E9%80%90%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90/XDrive%E4%BE%8B%E7%A8%8B-1%E6%8C%89%E9%94%AE/"><span class="left arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-left"></i> </span><span class="title flex justify-center items-center"><span class="post-nav-title-item">XDrive例程-按键</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2024/02/01/%E5%B5%8C%E5%85%A5%E5%BC%8F/ESP32S3/%E5%A4%96%E8%AE%BEAPI/5%20SPI%E5%A4%96%E9%83%A8Flash%E8%AF%BB%E5%86%99/"><span class="title flex justify-center items-center"><span class="post-nav-title-item">5 SPI及Flash读写</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">此页目录</div><div class="page-title">XDrive例程分析</div><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%95%B4%E4%BD%93%E7%BB%93%E6%9E%84"><span class="nav-number">1.</span> <span class="nav-text">整体结构</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%9E%E7%89%A9%E5%9B%BE"><span class="nav-number">1.1.</span> <span class="nav-text">实物图</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%A1%AC%E4%BB%B6%E9%80%89%E5%9E%8B"><span class="nav-number">1.2.</span> <span class="nav-text">硬件选型</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%BB%E6%8E%A7%E5%88%B6%E5%99%A8%EF%BC%9ASTM32F103CBT6%E2%80%94%E2%80%9448Pin%EF%BC%8C72MHz"><span class="nav-number">1.2.1.</span> <span class="nav-text">主控制器：STM32F103CBT6——48Pin，72MHz</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%B5%E6%9C%BA%E9%A9%B1%E5%8A%A8%EF%BC%9ATB67H450-2%EF%BC%88%E4%B8%A4%E7%9B%B8%E5%9B%9B%E7%BA%BF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA%EF%BC%89"><span class="nav-number">1.2.2.</span> <span class="nav-text">电机驱动：TB67H450*2（两相四线步进电机）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BC%A0%E6%84%9F%E5%99%A8%EF%BC%9AMT6816"><span class="nav-number">1.2.3.</span> <span class="nav-text">传感器：MT6816</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%8E%A5%E5%8F%A3"><span class="nav-number">1.2.4.</span> <span class="nav-text">数据接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%98%BE%E7%A4%BA%EF%BC%9AOLED"><span class="nav-number">1.2.5.</span> <span class="nav-text">显示：OLED</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%93%8D%E4%BD%9C%E6%96%B9%E6%B3%95"><span class="nav-number">1.3.</span> <span class="nav-text">操作方法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%8F%9C%E5%8D%95%E7%BB%93%E6%9E%84"><span class="nav-number">1.4.</span> <span class="nav-text">菜单结构</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BE%8B%E7%A8%8B%E4%BB%A3%E7%A0%81%E5%88%86%E6%9E%90"><span class="nav-number">2.</span> <span class="nav-text">例程代码分析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E9%A1%B9%E7%9B%AE%E7%BB%93%E6%9E%84"><span class="nav-number">2.1.</span> <span class="nav-text">项目结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">2.2.</span> <span class="nav-text">初始化</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8C%89%E9%94%AE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">2.2.1.</span> <span class="nav-text">按键初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#OLED%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">2.2.2.</span> <span class="nav-text">OLED初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#UI%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">2.2.3.</span> <span class="nav-text">UI初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9F%BA%E6%9C%AC%E5%A4%96%E8%AE%BE%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">2.2.4.</span> <span class="nav-text">基本外设初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">2.2.5.</span> <span class="nav-text">控制初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%9A%E8%AE%AF%E6%8E%A5%E5%8F%A3%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">2.2.6.</span> <span class="nav-text">通讯接口初始化</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E6%96%AD%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="nav-number">2.2.7.</span> <span class="nav-text">中断初始化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%BB%E5%BE%AA%E7%8E%AF"><span class="nav-number">2.3.</span> <span class="nav-text">主循环</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#UI%E6%9B%B4%E6%96%B0%E8%AE%A1%E6%97%B6%E7%B3%BB%E7%BB%9F"><span class="nav-number">2.3.1.</span> <span class="nav-text">UI更新计时系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A0%A1%E5%87%86%E5%99%A8%E5%BE%AA%E7%8E%AF%E5%86%85%E5%9B%9E%E8%B0%83"><span class="nav-number">2.3.2.</span> <span class="nav-text">校准器循环内回调</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%AD%E6%96%AD"><span class="nav-number">2.4.</span> <span class="nav-text">中断</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E4%B8%AD%E6%96%AD-SIGNAL-COUNT-DIR"><span class="nav-number">2.4.1.</span> <span class="nav-text">外部中断(SIGNAL_COUNT_DIR)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%9A%E6%97%B6%E5%99%A8%E6%8D%95%E8%8E%B7-SIGNAL-PWM-PWM"><span class="nav-number">2.4.2.</span> <span class="nav-text">定时器捕获(SIGNAL_PWM_PWM)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B3%BB%E7%BB%9F%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="nav-number">2.4.3.</span> <span class="nav-text">系统定时器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Modbus-TX-DMA%E4%B8%AD%E6%96%AD"><span class="nav-number">2.4.4.</span> <span class="nav-text">Modbus_TX_DMA中断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Modbus-RX-DMA%E4%B8%AD%E6%96%AD"><span class="nav-number">2.4.5.</span> <span class="nav-text">Modbus_RX_DMA中断</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Modbus-UART%E4%B8%AD%E6%96%AD"><span class="nav-number">2.4.6.</span> <span class="nav-text">Modbus_UART中断</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E4%BB%A3%E7%A0%81%E9%85%8D%E5%A5%97%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89"><span class="nav-number">3.</span> <span class="nav-text">代码配套函数定义</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8C%89%E9%94%AE"><span class="nav-number">3.1.</span> <span class="nav-text">按键</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="nav-number">3.1.1.</span> <span class="nav-text">头文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">3.1.2.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8F%E5%AE%9A%E4%B9%89"><span class="nav-number">3.1.3.</span> <span class="nav-text">宏定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="nav-number">3.1.4.</span> <span class="nav-text">类型定义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#OLED"><span class="nav-number">3.2.</span> <span class="nav-text">OLED</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6-1"><span class="nav-number">3.2.1.</span> <span class="nav-text">头文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-1"><span class="nav-number">3.2.2.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8F%E5%AE%9A%E4%B9%89-1"><span class="nav-number">3.2.3.</span> <span class="nav-text">宏定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89-1"><span class="nav-number">3.2.4.</span> <span class="nav-text">类型定义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UI"><span class="nav-number">3.3.</span> <span class="nav-text">UI</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6-2"><span class="nav-number">3.3.1.</span> <span class="nav-text">头文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-2"><span class="nav-number">3.3.2.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8F%E5%AE%9A%E4%B9%89-2"><span class="nav-number">3.3.3.</span> <span class="nav-text">宏定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89-2"><span class="nav-number">3.3.4.</span> <span class="nav-text">类型定义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MT6816-1"><span class="nav-number">3.4.</span> <span class="nav-text">MT6816</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6-3"><span class="nav-number">3.4.1.</span> <span class="nav-text">头文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8F%E5%AE%9A%E4%B9%89-3"><span class="nav-number">3.4.2.</span> <span class="nav-text">宏定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AC%E5%85%B1%E5%87%BD%E6%95%B0"><span class="nav-number">3.4.3.</span> <span class="nav-text">公共函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%AC%E5%85%B1%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="nav-number">3.4.4.</span> <span class="nav-text">公共类型定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#PWM%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.4.5.</span> <span class="nav-text">PWM模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ABZ%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.4.6.</span> <span class="nav-text">ABZ模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#SPI%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.4.7.</span> <span class="nav-text">SPI模式</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Signal-port%EF%BC%88%E4%BF%A1%E5%8F%B7%E6%8E%A5%E5%8F%A3%EF%BC%89"><span class="nav-number">3.5.</span> <span class="nav-text">Signal_port（信号接口）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6-4"><span class="nav-number">3.5.1.</span> <span class="nav-text">头文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Modbus%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.5.2.</span> <span class="nav-text">Modbus接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Signal-Count%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.5.3.</span> <span class="nav-text">Signal_Count接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Signal-PWM%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.5.4.</span> <span class="nav-text">Signal_PWM接口</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#MoreIO%E6%8E%A5%E5%8F%A3-%E5%8D%B3%E5%85%AC%E5%85%B1%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.5.5.</span> <span class="nav-text">MoreIO接口(即公共接口)</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%A0%87%E5%AE%9A%E5%99%A8"><span class="nav-number">3.6.</span> <span class="nav-text">标定器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6-5"><span class="nav-number">3.6.1.</span> <span class="nav-text">头文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-10"><span class="nav-number">3.6.2.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8F%E5%AE%9A%E4%B9%89-8"><span class="nav-number">3.6.3.</span> <span class="nav-text">宏定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89-10"><span class="nav-number">3.6.4.</span> <span class="nav-text">类型定义</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%94%B5%E6%9C%BA%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">3.7.</span> <span class="nav-text">电机控制器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%B4%E6%96%87%E4%BB%B6-6"><span class="nav-number">3.7.1.</span> <span class="nav-text">头文件</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#GPIO%E7%9B%B8%E5%85%B3API"><span class="nav-number">3.8.</span> <span class="nav-text">GPIO相关API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-16"><span class="nav-number">3.8.1.</span> <span class="nav-text">函数</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#USART%E7%9B%B8%E5%85%B3API"><span class="nav-number">3.9.</span> <span class="nav-text">USART相关API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-17"><span class="nav-number">3.9.1.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%AE%8F%E5%AE%9A%E4%B9%89-13"><span class="nav-number">3.9.2.</span> <span class="nav-text">宏定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89-15"><span class="nav-number">3.9.3.</span> <span class="nav-text">类型定义</span></a></li></ol></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="text-center">&copy; <span>2023</span> - 2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">Chepey</a></div><script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">访问人数</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">总访问量</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span> <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.0</a></span></div><div>博客已运行 <span class="odometer" id="runtime_days"></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fa-solid fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa-solid fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="/js/libs/Swup.min.js"></script><script src="/js/libs/SwupSlideTheme.min.js"></script><script src="/js/libs/SwupScriptsPlugin.min.js"></script><script src="/js/libs/SwupProgressPlugin.min.js"></script><script src="/js/libs/SwupScrollPlugin.min.js"></script><script src="/js/libs/SwupPreloadPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"}),new SwupPreloadPlugin],containers:["#swup"]})</script><script src="/js/tools/imageViewer.js" type="module"></script><script src="/js/utils.js" type="module"></script><script src="/js/main.js" type="module"></script><script src="/js/layouts/navbarShrink.js" type="module"></script><script src="/js/tools/scrollTopBottom.js" type="module"></script><script src="/js/tools/lightDarkSwitch.js" type="module"></script><script src="/js/layouts/categoryList.js" type="module"></script><script src="/js/tools/localSearch.js" type="module"></script><script src="/js/tools/codeBlock.js" type="module"></script><script src="/js/tools/runtime.js"></script><script src="/js/libs/odometer.min.js"></script><link rel="stylesheet" href="/assets/odometer-theme-minimal.css"><script src="/js/libs/Typed.min.js"></script><script src="/js/plugins/typed.js" type="module"></script><div class="post-scripts" data-swup-reload-script><script src="/js/libs/anime.min.js"></script><script src="/js/tools/tocToggle.js" type="module"></script><script src="/js/layouts/toc.js" type="module"></script><script src="/js/plugins/tabs.js" type="module"></script></div></body></html>