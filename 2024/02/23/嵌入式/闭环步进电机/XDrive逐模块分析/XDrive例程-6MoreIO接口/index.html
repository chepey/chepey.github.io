<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="Chepey"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="canonical" href="http://chepey.github.io/2024/02/23/嵌入式/闭环步进电机/xdrive逐模块分析/xdrive例程-6moreio接口/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="调用逻辑这一部分的功能是为了从上位机采集PID控制的目标值。 MoreIO接口是Signal的通用接口，其中包含Modebus接口、Signal_count接口、Signal_pwm接口。 他们都具有各自的结构体类型定义和函数，所有实现内容定义在signal_port.c&#x2F;h中。 在公共接口内，各个模块的调用逻辑如下： 每个模式之间相互独立，其中可以使用SIgnal_xxx_Config()函数初"><meta property="og:type" content="article"><meta property="og:title" content="XDrive例程-MoreIO接口"><meta property="og:url" content="http://chepey.github.io/2024/02/23/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/XDrive%E9%80%90%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90/XDrive%E4%BE%8B%E7%A8%8B-6MoreIO%E6%8E%A5%E5%8F%A3/index.html"><meta property="og:site_name" content="Welcome to Chepey&#39;s Blog"><meta property="og:description" content="调用逻辑这一部分的功能是为了从上位机采集PID控制的目标值。 MoreIO接口是Signal的通用接口，其中包含Modebus接口、Signal_count接口、Signal_pwm接口。 他们都具有各自的结构体类型定义和函数，所有实现内容定义在signal_port.c&#x2F;h中。 在公共接口内，各个模块的调用逻辑如下： 每个模式之间相互独立，其中可以使用SIgnal_xxx_Config()函数初"><meta property="og:locale" content="zh_CN"><meta property="article:published_time" content="2024-02-23T10:59:00.000Z"><meta property="article:modified_time" content="2024-02-26T13:38:36.356Z"><meta property="article:author" content="chepey"><meta property="article:tag" content="STM32F1"><meta property="article:tag" content="3D打印机"><meta property="article:tag" content="步进电机"><meta property="article:tag" content="嵌入式开发"><meta name="twitter:card" content="summary"><link rel="icon" type="image/png" href="/images/favicon.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><meta name="theme-color" content="#A31F34"><link rel="shortcut icon" href="/images/favicon.png"><title>XDrive例程-MoreIO接口 - Chepey&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/assets/build/styles.css"><link rel="stylesheet" href="/fonts/fonts.css"><link rel="stylesheet" href="/fonts/Satoshi/satoshi.css"><link rel="stylesheet" href="/fonts/Chillax/chillax.css"><script id="hexo-configurations">window.config={hostname:"chepey.github.io",root:"/",language:"zh-CN",path:"search.xml"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!1,list:[]},code_block:{copy:!0,style:"mac",font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:3,number:!0,expand:!0,init_open:!0},copyright:!0,lazyload:!1,recommendation:{enable:!1,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#A31F34",secondary:"#1b143e"},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!0},scroll_progress:{bar:!0,percentage:!0},website_counter:{url:"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,open_graph:!0,google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"fixed",image:{light:"/images/bk2.jpg",dark:"/images/bk2.jpg"},title:"Welcome to Chepey's Blog",subtitle:{text:["3D打印","嵌入式开发","DIY","二次元","etc"],hitokoto:{enable:!1,api:"https://v1.hitokoto.cn"},typing_speed:100,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!0,smart_backspace:!0},text_color:{light:"#1b143e",dark:"#1b143e"},text_style:{title_size:"3.7rem",subtitle_size:"2.5rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:!1,links:{github:null,instagram:null,zhihu:null,twitter:null,email:null},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null}]},mermaid:{enable:!1,version:"9.3.0"}},version:"2.5.0",navbar:{auto_hide:!1,color:{left:"#332847",right:"#af6e79",transparency:35},links:{Home:{path:"/",icon:"fa-regular fa-house"},"档案":{path:"/archives",icon:"fa-regular fa-archive"},"目录":{path:"/categories",icon:"fa-regular fa-folder"},"标签":{path:"/tags",icon:"fa-regular fa-tags"}},search:{enable:!0,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"menu",announcement:null,links:{"档案":{path:"/archives",icon:"fa-regular fa-archive"},"目录":{path:"/categories",icon:"fa-regular fa-folder"},"标签":{path:"/tags",icon:"fa-regular fa-tags"}}},article_date_format:"auto",categories:{enable:!0,limit:5},tags:{enable:!0,limit:5}},footerStart:"2023/10/25 13:02:00"},window.lang_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},window.data={masonry:!1}</script><link rel="stylesheet" href="/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/fontawesome/brands.min.css"><link rel="stylesheet" href="/fontawesome/solid.min.css"><link rel="stylesheet" href="/fontawesome/regular.min.css"><meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span> <span class="swup-progress-icon"><i class="fa-solid fa-circle-notch fa-spin"></i></span></div><main class="page-container" id="swup"><div class="main-content-container"><div class="main-content-header"><header class="navbar-container"><div class="navbar-content"><div class="left"><a class="logo-image" href="/"><img src="/images/favicon.png"> </a><a class="logo-title" href="/">Chepey&#39;s Blog</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house"></i> 首页</a></li><li class="navbar-item"><a href="/archives"><i class="fa-regular fa-archive"></i> 档案</a></li><li class="navbar-item"><a href="/categories"><i class="fa-regular fa-folder"></i> 目录</a></li><li class="navbar-item"><a href="/tags"><i class="fa-regular fa-tags"></i> 标签</a></li><li class="navbar-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color"><ul class="drawer-navbar-list flex flex-col justify-start items-center"><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/"><i class="fa-regular fa-house"></i> 首页</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/archives"><i class="fa-regular fa-archive"></i> 档案</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/categories"><i class="fa-regular fa-folder"></i> 目录</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/tags"><i class="fa-regular fa-tags"></i> 标签</a></li></ul></div><div class="window-mask"></div></header></div><div class="main-content-body"><div class="main-content"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><h1 class="article-title-regular">XDrive例程-MoreIO接口</h1></div><div class="article-header flex flex-row gap-2 items-center"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="/images/avatar.jpg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">Chepey</span> <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv5</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2024-02-23 18:59</span> <span class="mobile">2024-02-23 18:59</span> <span class="hover-info">创建</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2024-02-26 21:38:36</span> <span class="mobile">2024-02-26 21:38:36</span> <span class="hover-info">更新</span> </span><span class="article-categories article-meta-item"><i class="fa-regular fa-folders"></i>&nbsp;<ul><li><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/">嵌入式</a>&nbsp;</li><li>></li><li><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%A4%9A%E8%B7%AF%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/">多路闭环步进电机</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/STM32F1/">STM32F1</a>&nbsp;</li><li>| <a href="/tags/3D%E6%89%93%E5%8D%B0%E6%9C%BA/">3D打印机</a>&nbsp;</li><li>| <a href="/tags/%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/">步进电机</a>&nbsp;</li><li>| <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/">嵌入式开发</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fa-regular fa-typewriter"></i>&nbsp;<span>3k 字</span> </span><span class="article-min2read article-meta-item"><i class="fa-regular fa-clock"></i>&nbsp;<span>11 分钟</span> </span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body"><h1 id="调用逻辑"><a href="#调用逻辑" class="headerlink" title="调用逻辑"></a>调用逻辑</h1><p>这一部分的功能是为了从上位机采集PID控制的目标值。</p><p>MoreIO接口是Signal的通用接口，其中包含Modebus接口、Signal_count接口、Signal_pwm接口。</p><p>他们都具有各自的结构体类型定义和函数，所有实现内容定义在<code>signal_port.c/h</code>中。</p><p>在公共接口内，各个模块的调用逻辑如下：</p><p>每个模式之间相互独立，其中可以使用<code>SIgnal_xxx_Config()</code>函数初始化新模式。相对地，可以使用<code>Signal_xxx_DeConfig()</code>清除当前模式。</p><p>初始化模式后，可以使用对应的<code>Signal_xxxCapture_Goal()</code>来获取目标值。</p><h2 id="基于的头文件"><a href="#基于的头文件" class="headerlink" title="基于的头文件"></a>基于的头文件</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token comment">//Oneself</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"signal_port.h"</span></span>

<span class="token comment">//Application_User_Core</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"gpio.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"tim.h"</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"usart.h"</span></span>

<span class="token comment">//Base_Drivers</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"uart_mixed.h"</span></span>

<span class="token comment">//Control</span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">include</span> <span class="token string">"Control_Config.h"</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="公共接口宏定义"><a href="#公共接口宏定义" class="headerlink" title="公共接口宏定义"></a>公共接口宏定义</h1><h2 id="MoreIO接口模式"><a href="#MoreIO接口模式" class="headerlink" title="MoreIO接口模式"></a>MoreIO接口模式</h2><p>公共接口支持的接口模式，分为PWM位置、PWM速度、PWM电流、失能、PULSE位置。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">enum</span><span class="token punctuation">{</span>
	MoreIO_Mode_Disable <span class="token operator">=</span> <span class="token number">0x00</span><span class="token punctuation">,</span>		<span class="token comment">//Disable</span>
	MoreIO_Mode_PWM_Location<span class="token punctuation">,</span>			<span class="token comment">//PWM位置		(	EN(IO)			PWM(TIM)			NC(IO)		)</span>
	MoreIO_Mode_PWM_Speed<span class="token punctuation">,</span>				<span class="token comment">//PWM速度		(	EN(IO)			PWM(TIM)			DIR(IO)		)</span>
	MoreIO_Mode_PWM_Current<span class="token punctuation">,</span>			<span class="token comment">//PWM电流		(	EN(IO)			PWM(TIM)			DIR(IO)		)</span>
	MoreIO_Mode_PULSE_Locatioon<span class="token punctuation">,</span>	<span class="token comment">//PULSE位置	(	EN(IO)			PULSE(TIM)		DIR(EXTI)	)</span>
<span class="token punctuation">}</span>MoreIO_Mode<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="外部调用实例"><a href="#外部调用实例" class="headerlink" title="外部调用实例"></a>外部调用实例</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> Signal_MoreIO_Typedef signal_moreio<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h1 id="类型定义"><a href="#类型定义" class="headerlink" title="类型定义"></a>类型定义</h1><p>MoreIO接口结构体</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//模式</span>
	MoreIO_Mode		mode<span class="token punctuation">;</span>			<span class="token comment">//信号模式</span>
	<span class="token comment">//解析运动数据</span>
	<span class="token class-name">int32_t</span>		goal_location<span class="token punctuation">;</span>	<span class="token comment">//目标位置</span>
	<span class="token class-name">int32_t</span>		goal_speed<span class="token punctuation">;</span>			<span class="token comment">//目标速度</span>
	<span class="token class-name">int16_t</span>		goal_current<span class="token punctuation">;</span>		<span class="token comment">//目标电流</span>
	bool			goal_disable<span class="token punctuation">;</span>		<span class="token comment">//失能指令</span>
	bool			goal_brake<span class="token punctuation">;</span>			<span class="token comment">//刹车指令</span>
<span class="token punctuation">}</span>Signal_MoreIO_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h1 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h1><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_MoreIO_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>功能：MoreIO初始化</li><li>参数：</li><li>返回：</li><li>实现：<ul><li>初始模式定义为失能模式</li><li>初始化Signal_Count采集模块</li><li>初始化Signal_PWM采集模块</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_MoreIO_Config</span><span class="token punctuation">(</span>MoreIO_Mode data<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：MoreIO配置工作模式</p></li><li><p>参数：</p><ul><li>data：切换的目标模式</li></ul></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>判断模式是否改变</li><li>清除当前模式</li><li>令当前模式标志位为新模式</li><li>初始化新模式</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_MoreIO_Capture_Goal</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>功能：MoreIO获取目标</li><li>参数：</li><li>返回：</li><li>实现：<ul><li>调用当前目标对应的目标获取函数</li></ul></li></ul><h1 id="Modbus接口"><a href="#Modbus接口" class="headerlink" title="Modbus接口"></a>Modbus接口</h1><h2 id="宏定义"><a href="#宏定义" class="headerlink" title="宏定义"></a>宏定义</h2><h3 id="确定运行模式"><a href="#确定运行模式" class="headerlink" title="确定运行模式"></a>确定运行模式</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Modbus_Dir_Master</span>			<span class="token expression"><span class="token number">0x00</span>			</span><span class="token comment">//主机</span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Modbus_Dir_Slaves</span>			<span class="token expression"><span class="token number">0x01</span>			</span><span class="token comment">//从机</span></span>

<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name">Demo4_Dir</span>			<span class="token expression">Modbus_Dir_Master</span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h3 id="外部调用实例-1"><a href="#外部调用实例-1" class="headerlink" title="外部调用实例"></a>外部调用实例</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> Signal_Modbus_Typedef signal_modbus<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h2 id="类型定义-1"><a href="#类型定义-1" class="headerlink" title="类型定义"></a>类型定义</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//配置(ID)</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_Modbus_ID</span>	<span class="token expression"><span class="token number">1</span>			</span><span class="token comment">//默认</span></span>
	bool			valid_modbus_id<span class="token punctuation">;</span>		<span class="token comment">//Modbus_ID配置有效</span>
	<span class="token comment">//配置</span>
	<span class="token class-name">uint16_t</span>	id_run<span class="token punctuation">;</span>				<span class="token comment">//ID</span>
	<span class="token class-name">uint16_t</span>	id_order<span class="token punctuation">;</span>			<span class="token comment">//Modbus_ID(存储数据,下次一定)</span>
<span class="token punctuation">}</span>Signal_Modbus_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="函数-1"><a href="#函数-1" class="headerlink" title="函数"></a>函数</h2><h3 id="内部服务函数"><a href="#内部服务函数" class="headerlink" title="内部服务函数"></a>内部服务函数</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Modbus_Slave_Config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>功能：Modbus接口从机配置</li><li>参数：</li><li>返回：</li><li>实现：<ul><li>空（项目中并未写入这一部分的实现的代码）</li></ul></li></ul><h3 id="接口函数"><a href="#接口函数" class="headerlink" title="接口函数"></a>接口函数</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Modbus_Set_ID</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> value<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：设置Modbus接口ID</p></li><li><p>参数：</p><ul><li>value: 接口ID</li></ul></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>给输入ID限幅（0，248），以此判断ID生效标志位</li><li>更新结构体ID</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Modbus_Set_Default</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>功能：Modbus配置恢复</li><li>参数：</li><li>返回：</li><li>实现：<ul><li>恢复头文件中的默认ID</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Modbus_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Modbus接口初始化</p></li><li><p>参数：</p></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>​	如果未设置ID，则设置为头文件中预设的默认ID</li><li>加载运行ID的值</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Modbus_Low_Priority_Callback</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Modbus低优先级回调</p></li><li><p>参数：</p></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>这里没有实现ModeID功能</li></ul></li></ul><h1 id="Signal-Count接口"><a href="#Signal-Count接口" class="headerlink" title="Signal_Count接口"></a>Signal_Count接口</h1><h2 id="宏定义-1"><a href="#宏定义-1" class="headerlink" title="宏定义"></a>宏定义</h2><h3 id="外部调用实例-2"><a href="#外部调用实例-2" class="headerlink" title="外部调用实例"></a>外部调用实例</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c">Signal_Count_Typedef sg_cut<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="GPIO输入"><a href="#GPIO输入" class="headerlink" title="GPIO输入"></a>GPIO输入</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SIGNAL_COUNT_READ_DIR_IO</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token punctuation">(</span>SIGNAL_COUNT_DIR_GPIO_Port <span class="token operator">-&gt;</span> IDR <span class="token operator">&amp;</span> SIGNAL_COUNT_DIR_Pin<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SIGNAL_COUNT_READ_ENA_IO</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token punctuation">(</span>SIGNAL_COUNT_ENA_GPIO_Port <span class="token operator">-&gt;</span> IDR <span class="token operator">&amp;</span> SIGNAL_COUNT_ENA_Pin<span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h3 id="TIM输入"><a href="#TIM输入" class="headerlink" title="TIM输入"></a>TIM输入</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SIGNAL_COUNT_READ_COUNT</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span>		<span class="token punctuation">(</span>SIGNAL_COUNT_Get_TIM <span class="token operator">-&gt;</span> CNT<span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="TIM输出"><a href="#TIM输出" class="headerlink" title="TIM输出"></a>TIM输出</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SIGNAL_COUNT_UP</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span>						<span class="token punctuation">(</span>SIGNAL_COUNT_Get_TIM <span class="token operator">-&gt;</span> CR1 <span class="token operator">&amp;=</span> <span class="token operator">~</span><span class="token punctuation">(</span>TIM_CR1_DIR<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SIGNAL_COUNT_DOWN</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span>					<span class="token punctuation">(</span>SIGNAL_COUNT_Get_TIM <span class="token operator">-&gt;</span> CR1 <span class="token operator">|=</span>  <span class="token punctuation">(</span>TIM_CR1_DIR<span class="token punctuation">)</span><span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="类型定义-2"><a href="#类型定义-2" class="headerlink" title="类型定义"></a>类型定义</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//配置</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> 	<span class="token macro-name">De_SubDivide</span>	<span class="token expression"><span class="token number">16</span>			</span><span class="token comment">//默认</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_EN_inve</span>		<span class="token expression">false		</span><span class="token comment">//默认</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_DIR_inve</span>		<span class="token expression">false		</span><span class="token comment">//默认</span></span>
	bool			valid_subdivide<span class="token punctuation">;</span>		<span class="token comment">//细分配置有效</span>
	bool			valid_en_inve<span class="token punctuation">;</span>			<span class="token comment">//使能信号配置有效</span>
	bool			valid_dir_inve<span class="token punctuation">;</span>			<span class="token comment">//方向信号配置有效</span>
	<span class="token comment">//配置</span>
	<span class="token class-name">uint16_t</span>	subdivide<span class="token punctuation">;</span>					<span class="token comment">//脉冲信号细分</span>
	<span class="token class-name">uint16_t</span>	subdivide_form<span class="token punctuation">;</span>				<span class="token comment">//细分映射</span>
	bool			en_inve<span class="token punctuation">;</span>				<span class="token comment">//使能信号翻转(false:)</span>
	bool			dir_inve<span class="token punctuation">;</span>				<span class="token comment">//方向信号翻转(false:高电平增-低电平减   true:高电平减-低电平增)		</span>
	<span class="token comment">//采集数据(公共EN)</span>
	bool			en_valid<span class="token punctuation">;</span>				<span class="token comment">//En有效标志</span>
	<span class="token comment">//采集数据(STEP)(基本脉冲处理)</span>
	<span class="token class-name">int16_t</span>		sampling_count_last<span class="token punctuation">;</span>		<span class="token comment">//采样脉冲计数器(必须i16)</span>
	<span class="token class-name">int16_t</span>		sampling_count<span class="token punctuation">;</span>				<span class="token comment">//采样脉冲计数器(必须i16)</span>
	<span class="token class-name">int16_t</span>		sampling_count_sub<span class="token punctuation">;</span>			<span class="token comment">//采样脉冲差值(必须i16)</span>
	<span class="token comment">//采集数据(STEP)(缓冲输出)</span>
	<span class="token class-name">int32_t</span>		interp_out<span class="token punctuation">;</span>					<span class="token comment">//插补输出(用于输出到控制)</span>
<span class="token punctuation">}</span>Signal_Count_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="函数-2"><a href="#函数-2" class="headerlink" title="函数"></a>函数</h2><h3 id="内部服务函数-1"><a href="#内部服务函数-1" class="headerlink" title="内部服务函数"></a>内部服务函数</h3><h3 id="接口函数-1"><a href="#接口函数-1" class="headerlink" title="接口函数"></a>接口函数</h3><h4 id="参数配置"><a href="#参数配置" class="headerlink" title="参数配置"></a>参数配置</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Count_SetFraction</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> freq<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_Count设置细分值</p></li><li><p>参数：</p><ul><li>freq: 细分值</li></ul></li><li><p>返回：</p></li><li><p>实现：</p><ul><li><p>限制细分数为（2、4、8、16、32、64、128、256）</p></li><li><p>设置细分数</p></li><li><p>设置细分映射<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align:-2.059ex" xmlns="http://www.w3.org/2000/svg" width="19.85ex" height="5.095ex" role="img" focusable="false" viewBox="0 -1342 8773.6 2252"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">细</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">分</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">映</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">射</text></g><g data-mml-node="mo" transform="translate(4277.8,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(5333.6,0)"><g data-mml-node="mn" transform="translate(970,676)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(500,0)"></path><path data-c="36" d="M42 313Q42 476 123 571T303 666Q372 666 402 630T432 550Q432 525 418 510T379 495Q356 495 341 509T326 548Q326 592 373 601Q351 623 311 626Q240 626 194 566Q147 500 147 364L148 360Q153 366 156 373Q197 433 263 433H267Q313 433 348 414Q372 400 396 374T435 317Q456 268 456 210V192Q456 169 451 149Q440 90 387 34T253 -22Q225 -22 199 -14T143 16T92 75T56 172T42 313ZM257 397Q227 397 205 380T171 335T154 278T148 216Q148 133 160 97T198 39Q222 21 251 21Q302 21 329 59Q342 77 347 104T352 209Q352 289 347 316T329 361Q302 397 257 397Z" transform="translate(1000,0)"></path></g><g data-mml-node="mrow" transform="translate(220,-710)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">细</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">分</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">数</text></g></g><rect width="3200" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></p></li></ul></li><li><p>设置细分有效标识符</p></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Count_SetEnInve</span><span class="token punctuation">(</span>bool control<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：接口设置使能翻转</p></li><li><p>参数：</p><ul><li>control：(true:使能翻转) / (true:使能不翻转)</li></ul></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>使能电平反转结构体赋值</li><li>使能反转功能使能（标志位 置为true）</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Count_SetDirInve</span><span class="token punctuation">(</span>bool control<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：接口设置方向翻转</p></li><li><p>参数：</p></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>方向电平反转结构体赋值</li><li>Signal_Count计数器方向变更处理（<code>Signal_Count_Dir_Res()</code>）</li><li>方向反转功能使能（标志位 置为true）</li></ul></li></ul><h4 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Count_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_Count采集初始化</p></li><li><p>参数：</p></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>设置默认细分为16（头文件定义）</li><li>设置使能信号反转默认（不使用）</li><li>设置方向信号反转默认（不使用）</li></ul></li></ul><h4 id="功能接口"><a href="#功能接口" class="headerlink" title="功能接口"></a>功能接口</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Count_Config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_Count采集配置</p></li><li><p>参数：</p></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>GPIO初始化<ul><li>启用ENA端口时钟</li><li>输入模式</li><li>禁用上下拉</li><li>启用DIR端口时钟</li><li>双边沿中断</li><li>禁用上下拉</li><li>使能DIR中断</li></ul></li><li>TIM初始化<ul><li>启用SIGNAL_COUNT_PUL端口时钟</li><li>输入模式</li><li>禁用上下拉</li><li>启用TIM时钟</li><li>预分频:0</li><li>向上计数</li><li>16位周期</li><li>不分频</li><li>禁用自动重新加载</li><li>外部时钟模式</li><li>TI1FP1</li><li>上升沿触发</li><li>滤波参数(FDIV2_N6)</li><li>主机模式触发复位</li><li>禁用主机模式</li><li>启用时钟</li></ul></li><li>更新计数方向（<code>Signal_Count_Dir_Res()</code>）</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Count_DeConfig</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>功能：Signal_Count清理配置</li><li>参数：</li><li>返回：</li><li>实现：<ul><li>GPIO去使能（调用）<ul><li>失能DIR中断</li><li>重置DIR</li><li>重置ENA</li></ul></li><li>TIM去使能<ul><li>重置DIR</li><li>重置ENA</li></ul></li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Count_Capture_Goal</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_Count获取目标</p></li><li><p>参数：</p></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>读取En_Pin</li><li>采样(对比上次的计数值)</li><li>采样(缓冲输出)</li><li>输出</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_Count_Dir_Res</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_Count计数器方向变更处理,由(初始化/方向设置/外部中断)触发</p></li><li><p>参数：</p></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>修改定时器计数方向</li></ul></li></ul><h1 id="Signal-PWM接口"><a href="#Signal-PWM接口" class="headerlink" title="Signal_PWM接口"></a>Signal_PWM接口</h1><h2 id="宏定义-2"><a href="#宏定义-2" class="headerlink" title="宏定义"></a>宏定义</h2><h3 id="外部调用实例-3"><a href="#外部调用实例-3" class="headerlink" title="外部调用实例"></a>外部调用实例</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">extern</span> Signal_PWM_Typedef sg_pwm<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><h3 id="GPIO输入-1"><a href="#GPIO输入-1" class="headerlink" title="GPIO输入"></a>GPIO输入</h3><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SIGNAL_PWM_READ_DIR_IO</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token punctuation">(</span>SIGNAL_PWM_DIR_GPIO_Port <span class="token operator">-&gt;</span> IDR <span class="token operator">&amp;</span> SIGNAL_PWM_DIR_Pin<span class="token punctuation">)</span></span></span>
<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span> <span class="token macro-name function">SIGNAL_PWM_READ_ENA_IO</span><span class="token expression"><span class="token punctuation">(</span><span class="token punctuation">)</span>	<span class="token punctuation">(</span>SIGNAL_PWM_ENA_GPIO_Port <span class="token operator">-&gt;</span> IDR <span class="token operator">&amp;</span> SIGNAL_PWM_ENA_Pin<span class="token punctuation">)</span></span></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre><h2 id="类型定义-3"><a href="#类型定义-3" class="headerlink" title="类型定义"></a>类型定义</h2><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span><span class="token punctuation">{</span>
	<span class="token comment">//配置</span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_TOP_Width</span>				<span class="token expression"><span class="token punctuation">(</span><span class="token number">20</span> <span class="token operator">*</span> <span class="token number">1000</span><span class="token punctuation">)</span>							</span><span class="token comment">//默认(20ms)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_BOTTOM_Width</span>			<span class="token expression"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>											</span><span class="token comment">//默认(0ms)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_TOP_Location</span>			<span class="token expression"><span class="token punctuation">(</span>Move_Pulse_NUM <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>		</span><span class="token comment">//默认(半圈)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_BOTTOM_Location</span>	<span class="token expression"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>											</span><span class="token comment">//默认(0p)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_TOP_Speed</span>				<span class="token expression"><span class="token punctuation">(</span>Move_Rated_Speed<span class="token punctuation">)</span>			</span><span class="token comment">//默认(额定速度)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_BOTTOM_Speed</span>			<span class="token expression"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>											</span><span class="token comment">//默认(0p/s)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_TOP_Current</span>			<span class="token expression"><span class="token punctuation">(</span>Current_Rated_Current<span class="token punctuation">)</span>	</span><span class="token comment">//默认(额定电流)</span></span>
	<span class="token macro property"><span class="token directive-hash">#</span><span class="token directive keyword">define</span>		<span class="token macro-name">De_BOTTOM_Current</span>		<span class="token expression"><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>											</span><span class="token comment">//默认(0A)</span></span>
	bool			valid_top_width<span class="token punctuation">;</span>				<span class="token comment">//各种有效标志</span>
	bool			valid_bottom_width<span class="token punctuation">;</span>				<span class="token comment">//各种有效标志</span>
	bool			valid_top_location<span class="token punctuation">;</span>				<span class="token comment">//各种有效标志</span>
	bool			valid_bottom_location<span class="token punctuation">;</span>			<span class="token comment">//各种有效标志</span>
	bool			valid_top_speed<span class="token punctuation">;</span>				<span class="token comment">//各种有效标志</span>
	bool			valid_bottom_speed<span class="token punctuation">;</span>				<span class="token comment">//各种有效标志</span>
	bool			valid_top_current<span class="token punctuation">;</span>				<span class="token comment">//各种有效标志</span>
	bool			valid_bottom_current<span class="token punctuation">;</span>			<span class="token comment">//各种有效标志</span>
	<span class="token comment">//配置</span>
	<span class="token class-name">uint16_t</span>	top_width<span class="token punctuation">;</span>				<span class="token comment">//Top_PWM</span>
	<span class="token class-name">uint16_t</span>	bottom_width<span class="token punctuation">;</span>			<span class="token comment">//Bottom_PWM</span>
	<span class="token class-name">int32_t</span>		top_location<span class="token punctuation">;</span>			<span class="token comment">//Top_Location</span>
	<span class="token class-name">int32_t</span>		bottom_location<span class="token punctuation">;</span>		<span class="token comment">//Bottom_Location</span>
	<span class="token class-name">int32_t</span>		top_speed<span class="token punctuation">;</span>				<span class="token comment">//Top_Speed</span>
	<span class="token class-name">int32_t</span>		bottom_speed<span class="token punctuation">;</span>			<span class="token comment">//Bottom_Speed</span>
	<span class="token class-name">int16_t</span>		top_current<span class="token punctuation">;</span>			<span class="token comment">//Top_Current</span>
	<span class="token class-name">int16_t</span>		bottom_current<span class="token punctuation">;</span>			<span class="token comment">//Bottom_Current</span>
	<span class="token comment">//采集数据(PWM)</span>
	<span class="token class-name">uint16_t</span>	h_width<span class="token punctuation">;</span>				<span class="token comment">//PWM高宽度</span>
	<span class="token class-name">uint16_t</span>	period<span class="token punctuation">;</span>					<span class="token comment">//PWM周期</span>
	<span class="token class-name">uint8_t</span>		count_rising<span class="token punctuation">;</span>			<span class="token comment">//PWM上升沿计数器镜像</span>
	<span class="token class-name">uint8_t</span>		count_falling<span class="token punctuation">;</span>			<span class="token comment">//PWM下降沿计数器镜像</span>
	<span class="token class-name">uint8_t</span>		count_update<span class="token punctuation">;</span>			<span class="token comment">//PWM更新计数器</span>
	bool		whole_h_flag<span class="token punctuation">;</span>			<span class="token comment">//PWM全高标志</span>
	bool		whole_l_flag<span class="token punctuation">;</span>			<span class="token comment">//PWM全低标志</span>
	bool		ready_first<span class="token punctuation">;</span>	<span class="token comment">//PWM就绪标志(完成一次PWM采集后置位)</span>
	bool		ready_second<span class="token punctuation">;</span>	<span class="token comment">//PWM就绪标志(完成二次PWM采集后置位)</span>
	bool		ready_third<span class="token punctuation">;</span>	<span class="token comment">//PWM就绪标志(完成三次PWM采集后置位)</span>
	<span class="token class-name">uint16_t</span>	valid_width<span class="token punctuation">;</span>			<span class="token comment">//PWM有效宽度</span>
<span class="token punctuation">}</span>Signal_PWM_Typedef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="函数-3"><a href="#函数-3" class="headerlink" title="函数"></a>函数</h2><h3 id="内部服务函数-2"><a href="#内部服务函数-2" class="headerlink" title="内部服务函数"></a>内部服务函数</h3><h3 id="接口函数-2"><a href="#接口函数-2" class="headerlink" title="接口函数"></a>接口函数</h3><h4 id="参数配置-1"><a href="#参数配置-1" class="headerlink" title="参数配置"></a>参数配置</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_TopWidth</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> width<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_PWM设置最大脉宽</p></li><li><p>参数：</p><ul><li>width：脉宽长度</li></ul></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>设置结构体中最大脉宽</li><li>更新最大脉宽有效标志符</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_BottomWidth</span><span class="token punctuation">(</span><span class="token class-name">uint16_t</span> width<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_PWM设置最小脉宽</p></li><li><p>参数：</p><ul><li>width：脉宽长度</li></ul></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>设置结构体中最小脉宽</li><li>更新最小脉宽有效标志符</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_TopLocation</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> location<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_PWM设置最大脉宽表示位置</p></li><li><p>参数：</p><ul><li>location：位置</li></ul></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>设置结构体中最大脉宽表示位置</li><li>更新最大脉宽表示位置有效标志符</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_BottomLocation</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> location<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_PWM设置最小脉宽表示位置</p></li><li><p>参数：</p><ul><li>location：位置</li></ul></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>设置结构体中最小脉宽表示位置</li><li>更新最小脉宽表示位置有效标志符</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_TopSpeed</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> speed<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_PWM设置最大脉宽表示速度</p></li><li><p>参数：</p><ul><li>speed：速度</li></ul></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>设置结构体中最大脉宽表示速度</li><li>更新最大脉宽表示速度有效标志符</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_BottomSpeed</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> speed<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_PWM设置最小脉宽表示速度</p></li><li><p>参数：</p><ul><li>speed：速度</li></ul></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>设置结构体中最小脉宽表示速度</li><li>更新最小脉宽表示速度有效标志符</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_TopCurrent</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> current<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_PWM设置最大脉宽表示电流</p></li><li><p>参数：</p><ul><li>current：速度</li></ul></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>设置结构体中最大脉宽表示电流</li><li>更新最大脉宽表示电流有效标志符</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_BottomCurrent</span><span class="token punctuation">(</span><span class="token class-name">int32_t</span> current<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_PWM设置最小脉宽表示电流</p></li><li><p>参数：</p><ul><li>current：速度</li></ul></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>设置结构体中最小脉宽表示电流</li><li>更新最小脉宽表示电流有效标志符</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Set_Default</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_PWM参数恢复</p></li><li><p>参数：</p></li><li><p>返回：</p></li><li><p>实现：</p><ul><li><p>最大脉宽：20*1000</p></li><li><p>最小脉宽：0</p></li><li><p>最大脉宽位置：<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align:-1.552ex" xmlns="http://www.w3.org/2000/svg" width="12.308ex" height="4.778ex" role="img" focusable="false" viewBox="0 -1426 5440 2112"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">单</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">圈</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">脉</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">冲</text></g><g data-mml-node="mi" transform="translate(4000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">数</text></g></g><g data-mml-node="mn" transform="translate(2470,-686)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><rect width="5200" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></p></li></ul></li><li><p>最小脉宽位置：0</p></li><li><p>最大脉宽速度：<code>Move_Rated_Speed</code></p></li><li><p>最小脉宽速度：0</p></li><li><p>最大脉宽电流：<code>Current_Rated_Current</code></p></li><li><p>最小脉宽电流：0</p></li></ul><h4 id="初始化-1"><a href="#初始化-1" class="headerlink" title="初始化"></a>初始化</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Init</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_PWM采集初始化</p></li><li><p>参数：</p></li><li><p>返回：</p></li><li><p>实现：</p><ul><li><p>最大脉宽：20*1000</p></li><li><p>最小脉宽：0</p></li><li><p>最大脉宽位置：<br><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align:-1.552ex" xmlns="http://www.w3.org/2000/svg" width="12.308ex" height="4.778ex" role="img" focusable="false" viewBox="0 -1426 5440 2112"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="mfrac"><g data-mml-node="mrow" transform="translate(220,676)"><g data-mml-node="mi"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">单</text></g><g data-mml-node="mi" transform="translate(1000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">圈</text></g><g data-mml-node="mi" transform="translate(2000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">脉</text></g><g data-mml-node="mi" transform="translate(3000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">冲</text></g><g data-mml-node="mi" transform="translate(4000,0)"><text data-variant="normal" transform="scale(1,-1)" font-size="884px" font-family="serif">数</text></g></g><g data-mml-node="mn" transform="translate(2470,-686)"><path data-c="32" d="M109 429Q82 429 66 447T50 491Q50 562 103 614T235 666Q326 666 387 610T449 465Q449 422 429 383T381 315T301 241Q265 210 201 149L142 93L218 92Q375 92 385 97Q392 99 409 186V189H449V186Q448 183 436 95T421 3V0H50V19V31Q50 38 56 46T86 81Q115 113 136 137Q145 147 170 174T204 211T233 244T261 278T284 308T305 340T320 369T333 401T340 431T343 464Q343 527 309 573T212 619Q179 619 154 602T119 569T109 550Q109 549 114 549Q132 549 151 535T170 489Q170 464 154 447T109 429Z"></path></g><rect width="5200" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></p></li></ul></li><li><p>最小脉宽位置：0</p></li><li><p>最大脉宽速度：<code>Move_Rated_Speed</code></p></li><li><p>最小脉宽速度：0</p></li><li><p>最大脉宽电流：<code>Current_Rated_Current</code></p></li><li><p>最小脉宽电流：0</p></li></ul><h4 id="功能接口-1"><a href="#功能接口-1" class="headerlink" title="功能接口"></a>功能接口</h4><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Config</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>功能：Signal_PWM采集配置</li><li>参数：</li><li>返回：</li><li>实现：<ul><li>GPIO初始化<ul><li>启用ENA端口时钟</li><li>启用DIR端口时钟</li><li>输入模式</li><li>禁用上下拉</li><li>输入模式</li><li>禁用上下拉</li></ul></li><li>TIM初始化<ul><li>启用SIGNAL_PWM_PUL端口时钟</li><li>输入模式</li><li>禁用上下拉</li><li>启用TIM时钟</li><li>采样频率 72M/(71+1) = 1M 周期1us</li><li>向上计数模式</li><li>采样宽度 65536 * 1us = 65.536ms 频率15.23Hz (满足20Hz及以上频率PWM信号)</li><li>不分频</li><li>禁用自动重新加载</li><li>从模式:复位模式</li><li>从模式触发信号:TI1FP1</li><li>从模式触发极性:上升沿触发</li><li>禁用滤波器</li><li>主模式:复位</li><li>禁用主机模式</li><li>上升沿捕获</li><li>TI1FP1</li><li>不分频</li><li>下降沿捕获</li><li>TI1FP2</li><li>使能定时中断</li><li>停用TIM</li><li>启动CH1捕获比较中断</li><li>启动CH2捕获比较中断</li><li>启动TIM中断</li></ul></li><li>采集数据清零（高宽度、周期、上升沿数、下降沿数、更新数、全零标志、就绪标志）</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_DeConfig</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_PWM清理配置</p></li><li><p>参数：</p></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>GPIO去使能<ul><li>重置DIR</li><li>重置ENA</li></ul></li><li>TIM去使能<ul><li>停止TIM中断</li><li>停止CH2捕获比较中断</li><li>停止CH1捕获比较中断</li><li>重置GPIO</li></ul></li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_Capture_Goal</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li><p>功能：Signal_PWM获取目标</p></li><li><p>参数：</p></li><li><p>返回：</p></li><li><p>实现：</p><ul><li>没有实际代码，获取过程在回调函数中</li></ul></li></ul><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">void</span> <span class="token function">Signal_PWM_TIM_Callback</span><span class="token punctuation">(</span><span class="token keyword">void</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre><ul><li>功能：Signal_PWM采集中断回调</li><li>参数：</li><li>返回：</li><li>实现：<ul><li>定时器捕获中断通道1 (上升沿中断) (必须在更新中断前执行)<ul><li>是否生成中断标志位</li><li>定时器中断是否开启</li><li>清空中断标志位</li><li>采集上升沿数据</li></ul></li><li>定时器捕获中断通道2 (下降沿中断)<ul><li>是否生成中断标志位</li><li>定时器中断是否开启</li><li>清空中断标志位</li><li>采集下降沿数据</li></ul></li><li>定时器更新中断 (更新事件中断) (由更新事件触发 | 溢出事件触发)<ul><li>单次PWM全高全低检测<ul><li>(上升沿计数器镜像,更新计数器不相等)、(下降沿计数器镜像,更新计数器不相等)</li><li>读取PWM电平用于判定全高或全低</li></ul></li><li>提取本周期PWM</li><li>单次PWM有效性确认</li><li>可靠的PWM有效性确认</li><li>第三次采样成功时开始获取数据<ul><li>提取有效PWM</li><li>提取有效目标<ul><li>提取目标位置</li><li>提取目标速度（DIR引脚低电平—&gt;目标速度取负值）</li><li>提取目标电流（DIR引脚低电平—&gt;目标电流取负值）</li></ul></li><li>提取特殊目标</li></ul></li></ul></li></ul></li></ul></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul><li><strong>标题:</strong> XDrive例程-MoreIO接口</li><li><strong>作者:</strong> Chepey</li><li><strong>创建于 :</strong> 2024-02-23 18:59:00</li><li><strong>更新于 :</strong> 2024-02-26 21:38:36</li><li><strong>链接:</strong> https://chepey.github.io/2024/02/23/嵌入式/闭环步进电机/XDrive逐模块分析/XDrive例程-6MoreIO接口/</li><li><strong>版权声明: </strong>本文章采用 <a class="license" target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/deed.zh">CC BY-NC-SA 4.0</a> 进行许可。</li></ul></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/STM32F1/">#STM32F1</a>&nbsp;</li><li class="tag-item"><a href="/tags/3D%E6%89%93%E5%8D%B0%E6%9C%BA/">#3D打印机</a>&nbsp;</li><li class="tag-item"><a href="/tags/%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/">#步进电机</a>&nbsp;</li><li class="tag-item"><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/">#嵌入式开发</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2024/02/26/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/XDrive%E9%80%90%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90/XDrive%E4%BE%8B%E7%A8%8B-7%E7%BC%96%E7%A0%81%E5%99%A8%E6%A0%A1%E5%87%86/"><span class="left arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-left"></i> </span><span class="title flex justify-center items-center"><span class="post-nav-title-item">XDrive例程-编码器校准</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2024/02/22/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/XDrive%E9%80%90%E6%A8%A1%E5%9D%97%E5%88%86%E6%9E%90/XDrive%E4%BE%8B%E7%A8%8B-5%E7%A1%AC%E4%BB%B6%E7%94%B5%E6%B5%81%E6%8E%A7%E5%88%B6%E5%99%A8/"><span class="title flex justify-center items-center"><span class="post-nav-title-item">XDrive例程-硬件电流控制其</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">此页目录</div><div class="page-title">XDrive例程-MoreIO接口</div><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E9%80%BB%E8%BE%91"><span class="nav-number">1.</span> <span class="nav-text">调用逻辑</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%9F%BA%E4%BA%8E%E7%9A%84%E5%A4%B4%E6%96%87%E4%BB%B6"><span class="nav-number">1.1.</span> <span class="nav-text">基于的头文件</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%85%AC%E5%85%B1%E6%8E%A5%E5%8F%A3%E5%AE%8F%E5%AE%9A%E4%B9%89"><span class="nav-number">2.</span> <span class="nav-text">公共接口宏定义</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#MoreIO%E6%8E%A5%E5%8F%A3%E6%A8%A1%E5%BC%8F"><span class="nav-number">2.1.</span> <span class="nav-text">MoreIO接口模式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E8%B0%83%E7%94%A8%E5%AE%9E%E4%BE%8B"><span class="nav-number">2.2.</span> <span class="nav-text">外部调用实例</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89"><span class="nav-number">3.</span> <span class="nav-text">类型定义</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%87%BD%E6%95%B0"><span class="nav-number">4.</span> <span class="nav-text">函数</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Modbus%E6%8E%A5%E5%8F%A3"><span class="nav-number">5.</span> <span class="nav-text">Modbus接口</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8F%E5%AE%9A%E4%B9%89"><span class="nav-number">5.1.</span> <span class="nav-text">宏定义</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A1%AE%E5%AE%9A%E8%BF%90%E8%A1%8C%E6%A8%A1%E5%BC%8F"><span class="nav-number">5.1.1.</span> <span class="nav-text">确定运行模式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E8%B0%83%E7%94%A8%E5%AE%9E%E4%BE%8B-1"><span class="nav-number">5.1.2.</span> <span class="nav-text">外部调用实例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89-1"><span class="nav-number">5.2.</span> <span class="nav-text">类型定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-1"><span class="nav-number">5.3.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E9%83%A8%E6%9C%8D%E5%8A%A1%E5%87%BD%E6%95%B0"><span class="nav-number">5.3.1.</span> <span class="nav-text">内部服务函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E5%87%BD%E6%95%B0"><span class="nav-number">5.3.2.</span> <span class="nav-text">接口函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Signal-Count%E6%8E%A5%E5%8F%A3"><span class="nav-number">6.</span> <span class="nav-text">Signal_Count接口</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8F%E5%AE%9A%E4%B9%89-1"><span class="nav-number">6.1.</span> <span class="nav-text">宏定义</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E8%B0%83%E7%94%A8%E5%AE%9E%E4%BE%8B-2"><span class="nav-number">6.1.1.</span> <span class="nav-text">外部调用实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GPIO%E8%BE%93%E5%85%A5"><span class="nav-number">6.1.2.</span> <span class="nav-text">GPIO输入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TIM%E8%BE%93%E5%85%A5"><span class="nav-number">6.1.3.</span> <span class="nav-text">TIM输入</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#TIM%E8%BE%93%E5%87%BA"><span class="nav-number">6.1.4.</span> <span class="nav-text">TIM输出</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89-2"><span class="nav-number">6.2.</span> <span class="nav-text">类型定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-2"><span class="nav-number">6.3.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E9%83%A8%E6%9C%8D%E5%8A%A1%E5%87%BD%E6%95%B0-1"><span class="nav-number">6.3.1.</span> <span class="nav-text">内部服务函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E5%87%BD%E6%95%B0-1"><span class="nav-number">6.3.2.</span> <span class="nav-text">接口函数</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Signal-PWM%E6%8E%A5%E5%8F%A3"><span class="nav-number">7.</span> <span class="nav-text">Signal_PWM接口</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%AE%8F%E5%AE%9A%E4%B9%89-2"><span class="nav-number">7.1.</span> <span class="nav-text">宏定义</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E9%83%A8%E8%B0%83%E7%94%A8%E5%AE%9E%E4%BE%8B-3"><span class="nav-number">7.1.1.</span> <span class="nav-text">外部调用实例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#GPIO%E8%BE%93%E5%85%A5-1"><span class="nav-number">7.1.2.</span> <span class="nav-text">GPIO输入</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%B1%BB%E5%9E%8B%E5%AE%9A%E4%B9%89-3"><span class="nav-number">7.2.</span> <span class="nav-text">类型定义</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%87%BD%E6%95%B0-3"><span class="nav-number">7.3.</span> <span class="nav-text">函数</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%86%85%E9%83%A8%E6%9C%8D%E5%8A%A1%E5%87%BD%E6%95%B0-2"><span class="nav-number">7.3.1.</span> <span class="nav-text">内部服务函数</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8E%A5%E5%8F%A3%E5%87%BD%E6%95%B0-2"><span class="nav-number">7.3.2.</span> <span class="nav-text">接口函数</span></a></li></ol></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="text-center">&copy; <span>2023</span> - 2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">Chepey</a></div><script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">访问人数</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">总访问量</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span> <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.0</a></span></div><div>博客已运行 <span class="odometer" id="runtime_days"></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fa-solid fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa-solid fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="/js/libs/Swup.min.js"></script><script src="/js/libs/SwupSlideTheme.min.js"></script><script src="/js/libs/SwupScriptsPlugin.min.js"></script><script src="/js/libs/SwupProgressPlugin.min.js"></script><script src="/js/libs/SwupScrollPlugin.min.js"></script><script src="/js/libs/SwupPreloadPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"}),new SwupPreloadPlugin],containers:["#swup"]})</script><script src="/js/tools/imageViewer.js" type="module"></script><script src="/js/utils.js" type="module"></script><script src="/js/main.js" type="module"></script><script src="/js/layouts/navbarShrink.js" type="module"></script><script src="/js/tools/scrollTopBottom.js" type="module"></script><script src="/js/tools/lightDarkSwitch.js" type="module"></script><script src="/js/layouts/categoryList.js" type="module"></script><script src="/js/tools/localSearch.js" type="module"></script><script src="/js/tools/codeBlock.js" type="module"></script><script src="/js/tools/runtime.js"></script><script src="/js/libs/odometer.min.js"></script><link rel="stylesheet" href="/assets/odometer-theme-minimal.css"><script src="/js/libs/Typed.min.js"></script><script src="/js/plugins/typed.js" type="module"></script><div class="post-scripts" data-swup-reload-script><script src="/js/libs/anime.min.js"></script><script src="/js/tools/tocToggle.js" type="module"></script><script src="/js/layouts/toc.js" type="module"></script><script src="/js/plugins/tabs.js" type="module"></script></div></body></html>