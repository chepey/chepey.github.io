<!DOCTYPE html><html lang="zh-CN"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><meta name="keywords" content="Hexo Theme Redefine"><meta name="author" content="Chepey"><link rel="preconnect" href="https://fonts.googleapis.com"><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="canonical" href="http://chepey.github.io/2023/10/25/嵌入式/闭环步进电机/野火电机应用开发－1stm32定时器/"><meta name="robots" content="index,follow"><meta name="googlebot" content="index,follow"><meta name="revisit-after" content="1 days"><meta name="description" content="[TOC] 野火电机应用开发教程－定时器基础一、定时器的分类stm32f4上有2个高级定时器，10个通用定时器，2个基本定时器，2个看门狗定时器。  基本定时器   基本定时器的主要功能：  基本定时器功能  DAC    通用定时器   高级定时器和通用定时器 &#x3D; 基本定时器 +外部引脚  高级定时器   高级定时器 &#x3D; 通用定时器 + 可编程死区互补输出、重复计数器、带刹车（断路）功能   功"><meta property="og:type" content="article"><meta property="og:title" content="野火电机应用开发-1定时器"><meta property="og:url" content="http://chepey.github.io/2023/10/25/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%8D1stm32%E5%AE%9A%E6%97%B6%E5%99%A8/index.html"><meta property="og:site_name" content="Welcome to Chepey&#39;s Blog"><meta property="og:description" content="[TOC] 野火电机应用开发教程－定时器基础一、定时器的分类stm32f4上有2个高级定时器，10个通用定时器，2个基本定时器，2个看门狗定时器。  基本定时器   基本定时器的主要功能：  基本定时器功能  DAC    通用定时器   高级定时器和通用定时器 &#x3D; 基本定时器 +外部引脚  高级定时器   高级定时器 &#x3D; 通用定时器 + 可编程死区互补输出、重复计数器、带刹车（断路）功能   功"><meta property="og:locale" content="zh_CN"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%8D1stm32%E5%AE%9A%E6%97%B6%E5%99%A8\doc1002.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%8D1stm32%E5%AE%9A%E6%97%B6%E5%99%A8\doc1003.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%8D1stm32%E5%AE%9A%E6%97%B6%E5%99%A8\doc1004.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%8D1stm32%E5%AE%9A%E6%97%B6%E5%99%A8\doc1007.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%8D1stm32%E5%AE%9A%E6%97%B6%E5%99%A8\doc1014.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%8D1stm32%E5%AE%9A%E6%97%B6%E5%99%A8\doc1008.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%8D1stm32%E5%AE%9A%E6%97%B6%E5%99%A8\doc1010.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%8D1stm32%E5%AE%9A%E6%97%B6%E5%99%A8\doc1011.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%8D1stm32%E5%AE%9A%E6%97%B6%E5%99%A8\doc1015.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%8D1stm32%E5%AE%9A%E6%97%B6%E5%99%A8\doc1016.png"><meta property="og:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%8D1stm32%E5%AE%9A%E6%97%B6%E5%99%A8\doc1017.png"><meta property="article:published_time" content="2023-10-25T15:40:00.000Z"><meta property="article:modified_time" content="2024-01-25T08:14:51.212Z"><meta property="article:author" content="chepey"><meta property="article:tag" content="3D打印机"><meta property="article:tag" content="步进电机"><meta property="article:tag" content="嵌入式开发"><meta property="article:tag" content="STM32F4"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="e:\0_VS\6_Blog\chepeys_blog\source_posts\%E5%B5%8C%E5%85%A5%E5%BC%8F\%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA\%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%EF%BC%8D1stm32%E5%AE%9A%E6%97%B6%E5%99%A8\doc1002.png"><link rel="icon" type="image/png" href="/images/favicon.png" sizes="192x192"><link rel="apple-touch-icon" sizes="180x180" href="/images/favicon.png"><meta name="theme-color" content="#A31F34"><link rel="shortcut icon" href="/images/favicon.png"><title>野火电机应用开发-1定时器 - Chepey&#39;s Blog</title><link rel="stylesheet" href="/css/style.css"><link rel="stylesheet" href="/assets/build/styles.css"><link rel="stylesheet" href="/fonts/fonts.css"><link rel="stylesheet" href="/fonts/Satoshi/satoshi.css"><link rel="stylesheet" href="/fonts/Chillax/chillax.css"><script id="hexo-configurations">window.config={hostname:"chepey.github.io",root:"/",language:"zh-CN",path:"search.xml"},window.theme={articles:{style:{font_size:"16px",line_height:1.5,image_border_radius:"14px",image_alignment:"center",image_caption:!1,link_icon:!0},word_count:{enable:!0,count:!0,min2read:!0},author_label:{enable:!0,auto:!1,list:[]},code_block:{copy:!0,style:"mac",font:{enable:!1,family:null,url:null}},toc:{enable:!0,max_depth:3,number:!0,expand:!0,init_open:!0},copyright:!0,lazyload:!1,recommendation:{enable:!1,title:"推荐阅读",limit:3,mobile_limit:2,placeholder:"/images/wallhaven-wqery6-light.webp",skip_dirs:[]}},colors:{primary:"#A31F34",secondary:"#1b143e"},global:{fonts:{chinese:{enable:!1,family:null,url:null},english:{enable:!1,family:null,url:null}},content_max_width:"1000px",sidebar_width:"210px",hover:{shadow:!0,scale:!0},scroll_progress:{bar:!0,percentage:!0},website_counter:{url:"https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js",enable:!0,site_pv:!0,site_uv:!0,post_pv:!0},single_page:!0,open_graph:!0,google_analytics:{enable:!1,id:null}},home_banner:{enable:!0,style:"fixed",image:{light:"/images/bk2.jpg",dark:"/images/bk2.jpg"},title:"Welcome to Chepey's Blog",subtitle:{text:["3D打印","嵌入式开发","DIY","二次元","etc"],hitokoto:{enable:!1,api:"https://v1.hitokoto.cn"},typing_speed:100,backing_speed:80,starting_delay:500,backing_delay:1500,loop:!0,smart_backspace:!0},text_color:{light:"#1b143e",dark:"#1b143e"},text_style:{title_size:"3.7rem",subtitle_size:"2.5rem",line_height:1.2},custom_font:{enable:!1,family:null,url:null},social_links:{enable:!1,links:{github:null,instagram:null,zhihu:null,twitter:null,email:null},qrs:{weixin:null}}},plugins:{feed:{enable:!1},aplayer:{enable:!1,type:"fixed",audios:[{name:null,artist:null,url:null,cover:null}]},mermaid:{enable:!1,version:"9.3.0"}},version:"2.5.0",navbar:{auto_hide:!1,color:{left:"#332847",right:"#af6e79",transparency:35},links:{Home:{path:"/",icon:"fa-regular fa-house"},"档案":{path:"/archives",icon:"fa-regular fa-archive"},"目录":{path:"/categories",icon:"fa-regular fa-folder"},"标签":{path:"/tags",icon:"fa-regular fa-tags"}},search:{enable:!0,preload:!0}},page_templates:{friends_column:2,tags_style:"blur"},home:{sidebar:{enable:!0,position:"left",first_item:"menu",announcement:null,links:{"档案":{path:"/archives",icon:"fa-regular fa-archive"},"目录":{path:"/categories",icon:"fa-regular fa-folder"},"标签":{path:"/tags",icon:"fa-regular fa-tags"}}},article_date_format:"auto",categories:{enable:!0,limit:5},tags:{enable:!0,limit:5}},footerStart:"2023/10/25 13:02:00"},window.lang_ago={second:"%s 秒前",minute:"%s 分钟前",hour:"%s 小时前",day:"%s 天前",week:"%s 周前",month:"%s 个月前",year:"%s 年前"},window.data={masonry:!1}</script><link rel="stylesheet" href="/fontawesome/fontawesome.min.css"><link rel="stylesheet" href="/fontawesome/brands.min.css"><link rel="stylesheet" href="/fontawesome/solid.min.css"><link rel="stylesheet" href="/fontawesome/regular.min.css"><meta name="generator" content="Hexo 6.3.0"><style>mjx-container[jax="SVG"] {
  direction: ltr;
}

mjx-container[jax="SVG"] > svg {
  overflow: visible;
}

mjx-container[jax="SVG"][display="true"] {
  display: block;
  text-align: center;
  margin: 1em 0;
}

mjx-container[jax="SVG"][justify="left"] {
  text-align: left;
}

mjx-container[jax="SVG"][justify="right"] {
  text-align: right;
}

g[data-mml-node="merror"] > g {
  fill: red;
  stroke: red;
}

g[data-mml-node="merror"] > rect[data-background] {
  fill: yellow;
  stroke: none;
}

g[data-mml-node="mtable"] > line[data-line] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > rect[data-frame] {
  stroke-width: 70px;
  fill: none;
}

g[data-mml-node="mtable"] > .mjx-dashed {
  stroke-dasharray: 140;
}

g[data-mml-node="mtable"] > .mjx-dotted {
  stroke-linecap: round;
  stroke-dasharray: 0,140;
}

g[data-mml-node="mtable"] > svg {
  overflow: visible;
}

[jax="SVG"] mjx-tool {
  display: inline-block;
  position: relative;
  width: 0;
  height: 0;
}

[jax="SVG"] mjx-tool > mjx-tip {
  position: absolute;
  top: 0;
  left: 0;
}

mjx-tool > mjx-tip {
  display: inline-block;
  padding: .2em;
  border: 1px solid #888;
  font-size: 70%;
  background-color: #F8F8F8;
  color: black;
  box-shadow: 2px 2px 5px #AAAAAA;
}

g[data-mml-node="maction"][data-toggle] {
  cursor: pointer;
}

mjx-status {
  display: block;
  position: fixed;
  left: 1em;
  bottom: 1em;
  min-width: 25%;
  padding: .2em .4em;
  border: 1px solid #888;
  font-size: 90%;
  background-color: #F8F8F8;
  color: black;
}

foreignObject[data-mjx-xml] {
  font-family: initial;
  line-height: normal;
  overflow: visible;
}

.MathJax path {
  stroke-width: 3;
}

mjx-container[display="true"] {
  overflow: auto hidden;
}

mjx-container[display="true"] + br {
  display: none;
}
</style></head><body><div class="progress-bar-container"><span class="scroll-progress-bar"></span> <span class="pjax-progress-bar"></span> <span class="swup-progress-icon"><i class="fa-solid fa-circle-notch fa-spin"></i></span></div><main class="page-container" id="swup"><div class="main-content-container"><div class="main-content-header"><header class="navbar-container"><div class="navbar-content"><div class="left"><a class="logo-image" href="/"><img src="/images/favicon.png"> </a><a class="logo-title" href="/">Chepey&#39;s Blog</a></div><div class="right"><div class="desktop"><ul class="navbar-list"><li class="navbar-item"><a href="/"><i class="fa-regular fa-house"></i> 首页</a></li><li class="navbar-item"><a href="/archives"><i class="fa-regular fa-archive"></i> 档案</a></li><li class="navbar-item"><a href="/categories"><i class="fa-regular fa-folder"></i> 目录</a></li><li class="navbar-item"><a href="/tags"><i class="fa-regular fa-tags"></i> 标签</a></li><li class="navbar-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></li></ul></div><div class="mobile"><div class="icon-item search search-popup-trigger"><i class="fa-solid fa-magnifying-glass"></i></div><div class="icon-item navbar-bar"><div class="navbar-bar-middle"></div></div></div></div></div><div class="navbar-drawer w-full absolute top-0 left-0 bg-background-color"><ul class="drawer-navbar-list flex flex-col justify-start items-center"><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/"><i class="fa-regular fa-house"></i> 首页</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/archives"><i class="fa-regular fa-archive"></i> 档案</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/categories"><i class="fa-regular fa-folder"></i> 目录</a></li><li class="drawer-navbar-item text-base my-1.5 flex justify-center items-center"><a class="rounded-3xl py-1.5 px-5 hover:border hover:!text-primary active:!text-primary group" href="/tags"><i class="fa-regular fa-tags"></i> 标签</a></li></ul></div><div class="window-mask"></div></header></div><div class="main-content-body"><div class="main-content"><div class="post-page-container"><div class="article-content-container"><div class="article-title"><h1 class="article-title-regular">野火电机应用开发-1定时器</h1></div><div class="article-header flex flex-row gap-2 items-center"><div class="avatar w-[46px] h-[46px] flex-shrink-0 rounded-medium border border-border-color p-[1px]"><img src="/images/avatar.jpg"></div><div class="info flex flex-col justify-between"><div class="author flex items-center"><span class="name text-default-text-color text-lg font-semibold">Chepey</span> <span class="author-label ml-1.5 text-xs px-2 py-0.5 rounded-small text-third-text-color border border-shadow-color-1">Lv5</span></div><div class="meta-info"><div class="article-meta-info"><span class="article-date article-meta-item"><i class="fa-regular fa-pen-fancy"></i>&nbsp; <span class="desktop">2023-10-25 23:40</span> <span class="mobile">2023-10-25 23:40</span> <span class="hover-info">创建</span> </span><span class="article-date article-meta-item"><i class="fa-regular fa-wrench"></i>&nbsp; <span class="desktop">2024-01-25 16:14:51</span> <span class="mobile">2024-01-25 16:14:51</span> <span class="hover-info">更新</span> </span><span class="article-categories article-meta-item"><i class="fa-regular fa-folders"></i>&nbsp;<ul><li><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/">嵌入式</a>&nbsp;</li><li>></li><li><a href="/categories/%E5%B5%8C%E5%85%A5%E5%BC%8F/%E5%A4%9A%E8%B7%AF%E9%97%AD%E7%8E%AF%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/">多路闭环步进电机</a>&nbsp;</li></ul></span><span class="article-tags article-meta-item"><i class="fa-regular fa-tags"></i>&nbsp;<ul><li><a href="/tags/3D%E6%89%93%E5%8D%B0%E6%9C%BA/">3D打印机</a>&nbsp;</li><li>| <a href="/tags/%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/">步进电机</a>&nbsp;</li><li>| <a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/">嵌入式开发</a>&nbsp;</li><li>| <a href="/tags/STM32F4/">STM32F4</a>&nbsp;</li></ul></span><span class="article-wordcount article-meta-item"><i class="fa-regular fa-typewriter"></i>&nbsp;<span>7.7k 字</span> </span><span class="article-min2read article-meta-item"><i class="fa-regular fa-clock"></i>&nbsp;<span>28 分钟</span> </span><span class="article-pv article-meta-item"><i class="fa-regular fa-eye"></i>&nbsp;<span id="busuanzi_value_page_pv"></span></span></div></div></div></div><div class="article-content markdown-body"><p>[TOC]</p><h1 id="野火电机应用开发教程－定时器基础"><a href="#野火电机应用开发教程－定时器基础" class="headerlink" title="野火电机应用开发教程－定时器基础"></a>野火电机应用开发教程－定时器基础</h1><h2 id="一、定时器的分类"><a href="#一、定时器的分类" class="headerlink" title="一、定时器的分类"></a>一、定时器的分类</h2><p>stm32f4上有2个高级定时器，10个通用定时器，2个基本定时器，2个看门狗定时器。</p><ul><li><p>基本定时器</p><p>基本定时器的主要功能：</p><ol><li><p>基本定时器功能</p></li><li><p>DAC</p></li></ol></li><li><p>通用定时器</p><p>高级定时器和通用定时器 = 基本定时器 +外部引脚</p></li><li><p>高级定时器</p><p>高级定时器 = 通用定时器 + 可编程死区互补输出、重复计数器、带刹车（断路）功能</p></li></ul><p>功能包含：高级&gt;通用&gt;基本</p><h2 id="二、基本定时器"><a href="#二、基本定时器" class="headerlink" title="二、基本定时器"></a>二、基本定时器</h2><h3 id="2-1时钟源"><a href="#2-1时钟源" class="headerlink" title="2.1时钟源"></a>2.1时钟源</h3><p>基本定时器的时钟只能来自内部时钟。高级、通用定时器可以选择来自外部时钟或是其他定时器。</p><h3 id="2-2控制器"><a href="#2-2控制器" class="headerlink" title="2.2控制器"></a>2.2控制器</h3><p>定时器控制器可以控制定时器的复位、使能、基数，还可用于DAC的转换触发。</p><h3 id="2-3计数器"><a href="#2-3计数器" class="headerlink" title="2.3计数器"></a>2.3计数器</h3><p>这一部分主要涉及到三个16位寄存器：</p><ul><li>计数器寄存器（TIMx_CNT）</li><li>预分频器寄存器（TIMx_PSC）</li><li>自动重载寄存器（TIMx_ARR）</li></ul><p>自动重载寄存器（TIMx_ARR）有一个影子寄存器（由TIMx_CR1寄存器的ARPE位控制，功能：只有在更新时间来的时候才重置自动重载寄存器TIMx_ARR）。</p><h3 id="2-4基本定时器的使用"><a href="#2-4基本定时器的使用" class="headerlink" title="2.4基本定时器的使用"></a>2.4基本定时器的使用</h3><p>使用流程：NVIC配置－&gt;基本定时器模式配置-&gt;定时器中断服务函数配置-&gt;主函数调用</p><h4 id="1-定时器基本初始化结构体"><a href="#1-定时器基本初始化结构体" class="headerlink" title="1.定时器基本初始化结构体"></a>1.定时器基本初始化结构体</h4><pre class="line-numbers language-C" data-language="C"><code class="language-C">typedef struct {
     uint16_t Prescaler;         // 预分频器
     uint16_t CounterMode;       // 计数模式
     uint32_t Period;            // 定时器周期
     uint16_t ClockDivision;     // 时钟分频
     uint8_t RepetitionCounter;  // 重复计算器
 } TIM_Base_InitTypeDef;<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ul><li><p>Prescaler：定时器预分频器设置，时钟源经该预分频器才是定时器时钟，它设定TIMx_PSC 寄存器的值。 可设置范围为 0 至 65535，实现 1 至 65536 分频。</p></li><li><p>CounterMode：定时器计数方式，可是在为向上计数、向下计数以及三种中心对齐模式。 基本定时器只能是向上计数，即 TIMx_CNT 只能从 0 开始递增，并且无需初始化。</p></li><li><p>Period：定时器周期，实际就是设定自动重载寄存器的值，在事件生成时更新到影子寄存器。 可设置范围为 0 至 65535。</p></li><li><p>ClockDivision：时钟分频，设置定时器时钟 CK_INT 频率与数字滤波器采样时钟频率分频比， 基本定时器没有此功能，不用设置。</p></li><li><p>RepetitionCounter：重复计数器，属于高级控制寄存器专用寄存器位，利用它可以非常容易控制输出 PWM 的个数。 这里不用设置。</p></li></ul><h4 id="2-宏定义"><a href="#2-宏定义" class="headerlink" title="2.宏定义"></a>2.宏定义</h4><p>使用宏定义方便程序升级和移植。</p><pre class="line-numbers language-C" data-language="C"><code class="language-C">#define BASIC_TIM TIM6
#define BASIC_TIM_CLK_ENABLE() __TIM6_CLK_ENABLE()
#define BASIC_TIM_IRQn TIM6_DAC_IRQn
#define BASIC_TIM_IRQHandler TIM6_DAC_IRQHandler<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre><h4 id="3-NVIC配置"><a href="#3-NVIC配置" class="headerlink" title="3.NVIC配置"></a>3.NVIC配置</h4><p>中断抢断优先级，中断来源，此函数在main函数里调用。</p><pre class="line-numbers language-C" data-language="C"><code class="language-C">/**
 * @brief 基本定时器 TIMx,x[6,7]中断优先级配置
 * @param 无
 * @retval 无
 */
 static void TIMx_NVIC_Configuration(void)
 {
     //设置抢占优先级，子优先级
     HAL_NVIC_SetPriority(BASIC_TIM_IRQn, 0, 3);
     // 设置中断来源
     HAL_NVIC_EnableIRQ(BASIC_TIM_IRQn);
 }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="4-基本定时器模式配置"><a href="#4-基本定时器模式配置" class="headerlink" title="4.基本定时器模式配置"></a>4.基本定时器模式配置</h4><p>开启定时器时钟，设置参数（定时周期、预分频系数），初始化定时器，开启定时器更新中断。</p><pre class="line-numbers language-C" data-language="C"><code class="language-C">static void TIM_Mode_Config(void)
{
    // 开启 TIMx_CLK,x[6,7]
    BASIC_TIM_CLK_ENABLE();

    TIM_TimeBaseStructure.Instance = BASIC_TIM;
    /+ 累计 TIM_Period 个后产生一个更新或者中断+/
    //当定时器从 0 计数到 4999，即为 5000 次，为一个定时周期
    TIM_TimeBaseStructure.Init.Period = 5000-1;

    //定时器时钟源 TIMxCLK = 2 + PCLK1
    // PCLK1 = HCLK / 4
    // =&gt; TIMxCLK=HCLK/2=SystemCoreClock/2=84MHz
    // 设定定时器频率为=TIMxCLK/(TIM_Prescaler+1)=10000Hz
    TIM_TimeBaseStructure.Init.Prescaler = 8400-1;

    // 初始化定时器 TIMx, x[2,3,4,5]
    HAL_TIM_Base_Init(&amp;TIM_TimeBaseStructure);

    // 开启定时器更新中断
    HAL_TIM_Base_Start_IT(&amp;TIM_TimeBaseStructure);
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="5-定时器中断服务函数"><a href="#5-定时器中断服务函数" class="headerlink" title="5.定时器中断服务函数"></a>5.定时器中断服务函数</h4><p>这里主要定义中断的具体功能，上述部分全部为参数定义的过程，不涉及用户定义功能。</p><p>这里宏定义的部分给中断回调函数换了名字。其实可以直接卸载中断回调函数里，这个遵循了某种规范（猜测：把多个定时器中断同时调用同一个函数生成同一种中断。在新中断的回调函数HAL_TIM_PeriodElapsedCallback函数里判断是哪个定时器的中断。这样做的好处是可以把所有用户功能写在同一个地方，方便后期调试管理）。</p><pre class="line-numbers language-C" data-language="C"><code class="language-C">void BASIC_TIM_IRQHandler (void)
 {
     HAL_TIM_IRQHandler(&amp;TIM_TimeBaseStructure);
 }

 void HAL_TIM_PeriodElapsedCallback(TIM_HandleTypeDef +htim)
 {
     if (htim==(&amp;TIM_TimeBaseStructure)) {
     LED1_TOGGLE; //红灯周期闪烁
     }
 }<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h4 id="6-主函数调用"><a href="#6-主函数调用" class="headerlink" title="6.主函数调用"></a>6.主函数调用</h4><p>在中断里运行的用户功能在main函数里体现得并不多，在这里主函数主要起一个时钟初始化、引脚初始化、定时器初始化的功能。</p><pre class="line-numbers language-C" data-language="C"><code class="language-C">int main(void)
{
    /* 初始化系统时钟为 168MHz */
    SystemClock_Config();
    /* 初始化 LED */
    LED_GPIO_Config();
    /* 初始化基本定时器定时， 1s 产生一次中断 */
    TIMx_Configuration();

    while (1) {
    }
}<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><h2 id="三、高级定时器"><a href="#三、高级定时器" class="headerlink" title="三、高级定时器"></a>三、高级定时器</h2><h3 id="3-1-高级控制定时器"><a href="#3-1-高级控制定时器" class="headerlink" title="3.1 高级控制定时器"></a>3.1 高级控制定时器</h3><ul><li><p>高级定时器（与通用定时器）=基本定时器+外部引脚</p><p>从而可以完成输入捕获和输出比较功能</p></li><li><p>高级定时器=通用定时器+可编程死区互补输出、重复计数器、带刹车(断路)功能</p></li></ul><table><thead><tr><th>名称</th><th>功能</th></tr></thead><tbody><tr><td>ARR</td><td>16 位自动重载计数器</td></tr><tr><td>CNT</td><td>16 位的计数器</td></tr><tr><td>PSC</td><td>16位可编程预分频器</td></tr><tr><td>RCR</td><td>8位重复计数器</td></tr></tbody></table><h3 id="3-2-功能框图"><a href="#3-2-功能框图" class="headerlink" title="3.2 功能框图"></a>3.2 功能框图</h3><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\野火电机应用开发－1stm32定时器\doc1002.png" alt="../_images/doc1002.png"></p><h4 id="3-2-1-时钟源"><a href="#3-2-1-时钟源" class="headerlink" title="3.2.1 时钟源"></a>3.2.1 时钟源</h4><p>高级控制定时器有四个时钟源可选：</p><ul><li>内部时钟源CK_INT</li><li>外部时钟模式1：外部输入引脚TIx（x=1,2,3,4）</li><li>外部时钟模式2：外部触发输入ETR</li><li>内部触发输入</li></ul><h5 id="内部时钟源CK-INT"><a href="#内部时钟源CK-INT" class="headerlink" title="内部时钟源CK_INT"></a>内部时钟源CK_INT</h5><p>内部时钟CK_INT即来自于芯片内部，等于168M，一般情况下，我们都是使用内部时钟。 当从模式控制寄存器TIMx_SMCR的SMS位等于000时，则使用内部时钟。</p><h5 id="外部时钟模式1：外部输入引脚TIx（x-1-2-3-4）"><a href="#外部时钟模式1：外部输入引脚TIx（x-1-2-3-4）" class="headerlink" title="外部时钟模式1：外部输入引脚TIx（x=1,2,3,4）"></a>外部时钟模式1：外部输入引脚TIx（x=1,2,3,4）</h5><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\野火电机应用开发－1stm32定时器\doc1003.png" alt="../_images/doc1003.png"></p><ul><li><p><strong>1时钟信号输入引脚</strong></p><p>定时器的输入通道总共有4个，分别为TI1/2/3/4， 即TIMx_CH1/2/3/4。</p><ul><li>使用哪一路由TIM_CCMx的位CCxS[1:0]配置，其中CCM1控制TI1/2，CCM2控制TI3/4</li></ul></li><li><p><strong>2滤波器</strong></p><p>外部的时钟信号的频率过高或者混杂有高频干扰信号时使用</p><ul><li>由TIMx_CCMx的位ICxF[3:0]配置</li></ul></li><li><p><strong>3边沿检测</strong></p><p>决定是上升沿有效还是下降沿有效</p><ul><li>由TIMx_CCER的位CCxP和CCxNP配置</li></ul></li><li><p><strong>4触发选择</strong></p><p>当使用外部时钟模式1时，触发源有两个：</p><ul><li><p>滤波后的定时器输入1（TI1FP1）</p></li><li><p>滤波后的定时器输入2（TI2FP2）</p></li><li><p>由TIMxSMCR的位TS[2:0]配置</p></li></ul></li><li><p><strong>5从模式选择</strong></p><p>把信号连接到TRGI引脚，让触发信号成为外部时钟模式1的输入，最终等于CK_PSC， 然后驱动计数器CNT计数</p><ul><li>配置TIMx_SMCR的位SMS[2:0]为000即可选择外部时钟模式1</li></ul></li><li><p><strong>6使能计数器</strong></p><ul><li>使能计数器由TIMx_CR1的位CEN配置</li></ul></li></ul><h5 id="外部时钟模式2"><a href="#外部时钟模式2" class="headerlink" title="外部时钟模式2"></a>外部时钟模式2</h5><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\野火电机应用开发－1stm32定时器\doc1004.png" alt="../_images/doc1004.png"></p><ul><li><p><strong>1时钟信号输入引脚</strong></p><ul><li>时钟信号来自于定时器的特定输入通道TIMx_ETR，只有1个</li></ul></li><li><p><strong>2外部触发极性</strong></p><p>来自ETR引脚输入的信号可以选择为上升沿或者下降沿有效</p><ul><li>由TIMx_SMCR的位ETP配置</li></ul></li><li><p><strong>3外部触发预分频器</strong></p><p>由于ETRP的信号的频率不能超过TIMx_CLK（168M）的1/4</p><ul><li>由 TIMx_SMCR的位ETPS[1:0]配置</li></ul></li><li><p><strong>4滤波器</strong></p><p>ETRP的信号的频率过高或者混杂有高频干扰信号的话</p><ul><li>由TIMx_SMCR的位ETF[3:0]配置，其中的fDTS是由内部时钟CK_INT分频得到，具体的由TIMx_CR1的位CKD[1:0]配置</li></ul></li><li><p><strong>5从模式选择</strong></p><p>滤波的信号连接到ETRF引脚后，触发信号成为外部时钟模式2的输入，最终等于CK_PSC， 然后驱动计数器CNT计数</p><ul><li>配置TIMx_SMCR的位ECE为1即可选择外部时钟模式2</li></ul></li><li><p><strong>6使能计数器</strong></p><ul><li>使能计数器由TIMx_CR1的位CEN配置</li></ul></li></ul><h5 id="内部触发输入"><a href="#内部触发输入" class="headerlink" title="内部触发输入"></a>内部触发输入</h5><p>使用一个定时器作为另一个定时器的预分频器</p><ul><li>主模式的定时器可以对从模式定时器执行复位、启动、停止或提供时钟</li></ul><h4 id="3-2-2-控制器"><a href="#3-2-2-控制器" class="headerlink" title="3.2.2 控制器"></a>3.2.2 控制器</h4><p>高级控制定时器控制器部分包括三部分：</p><ul><li><p>触发控制器</p><p>用来针对片内外设输出触发信号， 比如为其它定时器提供时钟和触发DAC/ADC转换</p></li><li><p>从模式控制器</p><p>可以控制计数器复位、启动、递增/递减、计数</p></li><li><p>编码器接口</p><p>针对编码器计数而设计</p></li></ul><h4 id="3-2-3-时基单元"><a href="#3-2-3-时基单元" class="headerlink" title="3.2.3 时基单元"></a>3.2.3 时基单元</h4><p>高级控制定时器时基单元包括四个寄存器：</p><ul><li>16位计数器寄存器(CNT)</li><li>16位预分频器寄存器(PSC)</li><li>16位自动重载寄存器(ARR)</li><li>8位重复计数器寄存器(RCR)（高级定时器独有，通用和基本定时器没有）</li></ul><h5 id="预分频器PSC"><a href="#预分频器PSC" class="headerlink" title="预分频器PSC"></a>预分频器PSC</h5><p>预分频器PSC有一个输入时钟CK_PSC和一个输出时钟CK_CNT：</p><ul><li><p>输入时钟CK_PSC就是上面时钟源的输出</p></li><li><p>输出CK_CNT则用来驱动计数器CNT计数</p></li></ul><p><mjx-container class="MathJax" jax="SVG" display="true"><svg style="vertical-align:-2.172ex" xmlns="http://www.w3.org/2000/svg" width="26.735ex" height="5.387ex" role="img" focusable="false" viewBox="0 -1421.1 11816.7 2381.1"><g stroke="currentColor" fill="currentColor" stroke-width="0" transform="scale(1,-1)"><g data-mml-node="math"><g data-mml-node="msub"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="TeXAtom" transform="translate(523,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="msub" transform="translate(760,0)"><g data-mml-node="mi"><path data-c="1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(882,-150) scale(0.707)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g></g><g data-mml-node="mi" transform="translate(2229.4,0)"><path data-c="1D441" d="M234 637Q231 637 226 637Q201 637 196 638T191 649Q191 676 202 682Q204 683 299 683Q376 683 387 683T401 677Q612 181 616 168L670 381Q723 592 723 606Q723 633 659 637Q635 637 635 648Q635 650 637 660Q641 676 643 679T653 683Q656 683 684 682T767 680Q817 680 843 681T873 682Q888 682 888 672Q888 650 880 642Q878 637 858 637Q787 633 769 597L620 7Q618 0 599 0Q585 0 582 2Q579 5 453 305L326 604L261 344Q196 88 196 79Q201 46 268 46H278Q284 41 284 38T282 19Q278 6 272 0H259Q228 2 151 2Q123 2 100 2T63 2T46 1Q31 1 31 10Q31 14 34 26T39 40Q41 46 62 46Q130 49 150 85Q154 91 221 362L289 634Q287 635 234 637Z"></path></g><g data-mml-node="mi" transform="translate(3117.4,0)"><path data-c="1D447" d="M40 437Q21 437 21 445Q21 450 37 501T71 602L88 651Q93 669 101 677H569H659Q691 677 697 676T704 667Q704 661 687 553T668 444Q668 437 649 437Q640 437 637 437T631 442L629 445Q629 451 635 490T641 551Q641 586 628 604T573 629Q568 630 515 631Q469 631 457 630T439 622Q438 621 368 343T298 60Q298 48 386 46Q418 46 427 45T436 36Q436 31 433 22Q429 4 424 1L422 0Q419 0 415 0Q410 0 363 1T228 2Q99 2 64 0H49Q43 6 43 9T45 27Q49 40 55 46H83H94Q174 46 189 55Q190 56 191 56Q196 59 201 76T241 233Q258 301 269 344Q339 619 339 625Q339 630 310 630H279Q212 630 191 624Q146 614 121 583T67 467Q60 445 57 441T43 437H40Z"></path></g></g></g><g data-mml-node="mo" transform="translate(3552.9,0)"><path data-c="3D" d="M56 347Q56 360 70 367H707Q722 359 722 347Q722 336 708 328L390 327H72Q56 332 56 347ZM56 153Q56 168 72 173H708Q722 163 722 153Q722 140 707 133H70Q56 140 56 153Z"></path></g><g data-mml-node="mfrac" transform="translate(4608.7,0)"><g data-mml-node="msub" transform="translate(2034.8,716.1)"><g data-mml-node="mi"><path data-c="1D453" d="M118 -162Q120 -162 124 -164T135 -167T147 -168Q160 -168 171 -155T187 -126Q197 -99 221 27T267 267T289 382V385H242Q195 385 192 387Q188 390 188 397L195 425Q197 430 203 430T250 431Q298 431 298 432Q298 434 307 482T319 540Q356 705 465 705Q502 703 526 683T550 630Q550 594 529 578T487 561Q443 561 443 603Q443 622 454 636T478 657L487 662Q471 668 457 668Q445 668 434 658T419 630Q412 601 403 552T387 469T380 433Q380 431 435 431Q480 431 487 430T498 424Q499 420 496 407T491 391Q489 386 482 386T428 385H372L349 263Q301 15 282 -47Q255 -132 212 -173Q175 -205 139 -205Q107 -205 81 -186T55 -132Q55 -95 76 -78T118 -61Q162 -61 162 -103Q162 -122 151 -136T127 -157L118 -162Z"></path></g><g data-mml-node="TeXAtom" transform="translate(523,-150) scale(0.707)" data-mjx-texclass="ORD"><g data-mml-node="mi"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="msub" transform="translate(760,0)"><g data-mml-node="mi"><path data-c="1D43E" d="M285 628Q285 635 228 637Q205 637 198 638T191 647Q191 649 193 661Q199 681 203 682Q205 683 214 683H219Q260 681 355 681Q389 681 418 681T463 682T483 682Q500 682 500 674Q500 669 497 660Q496 658 496 654T495 648T493 644T490 641T486 639T479 638T470 637T456 637Q416 636 405 634T387 623L306 305Q307 305 490 449T678 597Q692 611 692 620Q692 635 667 637Q651 637 651 648Q651 650 654 662T659 677Q662 682 676 682Q680 682 711 681T791 680Q814 680 839 681T869 682Q889 682 889 672Q889 650 881 642Q878 637 862 637Q787 632 726 586Q710 576 656 534T556 455L509 418L518 396Q527 374 546 329T581 244Q656 67 661 61Q663 59 666 57Q680 47 717 46H738Q744 38 744 37T741 19Q737 6 731 0H720Q680 3 625 3Q503 3 488 0H478Q472 6 472 9T474 27Q478 40 480 43T491 46H494Q544 46 544 71Q544 75 517 141T485 216L427 354L359 301L291 248L268 155Q245 63 245 58Q245 51 253 49T303 46H334Q340 37 340 35Q340 19 333 5Q328 0 317 0Q314 0 280 1T180 2Q118 2 85 2T49 1Q31 1 31 11Q31 13 34 25Q38 41 42 43T65 46Q92 46 125 49Q139 52 144 61Q147 65 216 339T285 628Z"></path></g><g data-mml-node="mi" transform="translate(882,-150) scale(0.707)"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g></g><g data-mml-node="mi" transform="translate(2223,0)"><path data-c="1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="mi" transform="translate(2868,0)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g></g></g><g data-mml-node="mrow" transform="translate(220,-710)"><g data-mml-node="mi"><path data-c="1D443" d="M287 628Q287 635 230 637Q206 637 199 638T192 648Q192 649 194 659Q200 679 203 681T397 683Q587 682 600 680Q664 669 707 631T751 530Q751 453 685 389Q616 321 507 303Q500 302 402 301H307L277 182Q247 66 247 59Q247 55 248 54T255 50T272 48T305 46H336Q342 37 342 35Q342 19 335 5Q330 0 319 0Q316 0 282 1T182 2Q120 2 87 2T51 1Q33 1 33 11Q33 13 36 25Q40 41 44 43T67 46Q94 46 127 49Q141 52 146 61Q149 65 218 339T287 628ZM645 554Q645 567 643 575T634 597T609 619T560 635Q553 636 480 637Q463 637 445 637T416 636T404 636Q391 635 386 627Q384 621 367 550T332 412T314 344Q314 342 395 342H407H430Q542 342 590 392Q617 419 631 471T645 554Z"></path></g><g data-mml-node="mi" transform="translate(751,0)"><path data-c="1D446" d="M308 24Q367 24 416 76T466 197Q466 260 414 284Q308 311 278 321T236 341Q176 383 176 462Q176 523 208 573T273 648Q302 673 343 688T407 704H418H425Q521 704 564 640Q565 640 577 653T603 682T623 704Q624 704 627 704T632 705Q645 705 645 698T617 577T585 459T569 456Q549 456 549 465Q549 471 550 475Q550 478 551 494T553 520Q553 554 544 579T526 616T501 641Q465 662 419 662Q362 662 313 616T263 510Q263 480 278 458T319 427Q323 425 389 408T456 390Q490 379 522 342T554 242Q554 216 546 186Q541 164 528 137T492 78T426 18T332 -20Q320 -22 298 -22Q199 -22 144 33L134 44L106 13Q83 -14 78 -18T65 -22Q52 -22 52 -14Q52 -11 110 221Q112 227 130 227H143Q149 221 149 216Q149 214 148 207T144 186T142 153Q144 114 160 87T203 47T255 29T308 24Z"></path></g><g data-mml-node="mi" transform="translate(1396,0)"><path data-c="1D436" d="M50 252Q50 367 117 473T286 641T490 704Q580 704 633 653Q642 643 648 636T656 626L657 623Q660 623 684 649Q691 655 699 663T715 679T725 690L740 705H746Q760 705 760 698Q760 694 728 561Q692 422 692 421Q690 416 687 415T669 413H653Q647 419 647 422Q647 423 648 429T650 449T651 481Q651 552 619 605T510 659Q484 659 454 652T382 628T299 572T226 479Q194 422 175 346T156 222Q156 108 232 58Q280 24 350 24Q441 24 512 92T606 240Q610 253 612 255T628 257Q648 257 648 248Q648 243 647 239Q618 132 523 55T319 -22Q206 -22 128 53T50 252Z"></path></g><g data-mml-node="mo" transform="translate(2156,0)"><path data-c="5B" d="M118 -250V750H255V710H158V-210H255V-250H118Z"></path></g><g data-mml-node="mn" transform="translate(2434,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path><path data-c="35" d="M164 157Q164 133 148 117T109 101H102Q148 22 224 22Q294 22 326 82Q345 115 345 210Q345 313 318 349Q292 382 260 382H254Q176 382 136 314Q132 307 129 306T114 304Q97 304 95 310Q93 314 93 485V614Q93 664 98 664Q100 666 102 666Q103 666 123 658T178 642T253 634Q324 634 389 662Q397 666 402 666Q410 666 410 648V635Q328 538 205 538Q174 538 149 544L139 546V374Q158 388 169 396T205 412T256 420Q337 420 393 355T449 201Q449 109 385 44T229 -22Q148 -22 99 32T50 154Q50 178 61 192T84 210T107 214Q132 214 148 197T164 157Z" transform="translate(500,0)"></path></g><g data-mml-node="mo" transform="translate(3711.8,0)"><path data-c="3A" d="M78 370Q78 394 95 412T138 430Q162 430 180 414T199 371Q199 346 182 328T139 310T96 327T78 370ZM78 60Q78 84 95 102T138 120Q162 120 180 104T199 61Q199 36 182 18T139 0T96 17T78 60Z"></path></g><g data-mml-node="mn" transform="translate(4267.6,0)"><path data-c="30" d="M96 585Q152 666 249 666Q297 666 345 640T423 548Q460 465 460 320Q460 165 417 83Q397 41 362 16T301 -15T250 -22Q224 -22 198 -16T137 16T82 83Q39 165 39 320Q39 494 96 585ZM321 597Q291 629 250 629Q208 629 178 597Q153 571 145 525T137 333Q137 175 145 125T181 46Q209 16 250 16Q290 16 318 46Q347 76 354 130T362 333Q362 478 354 524T321 597Z"></path></g><g data-mml-node="mo" transform="translate(4767.6,0)"><path data-c="5D" d="M22 710V750H159V-250H22V-210H119V710H22Z"></path></g><g data-mml-node="mo" transform="translate(5267.8,0)"><path data-c="2B" d="M56 237T56 250T70 270H369V420L370 570Q380 583 389 583Q402 583 409 568V270H707Q722 262 722 250T707 230H409V-68Q401 -82 391 -82H389H387Q375 -82 369 -68V230H70Q56 237 56 250Z"></path></g><g data-mml-node="mn" transform="translate(6268,0)"><path data-c="31" d="M213 578L200 573Q186 568 160 563T102 556H83V602H102Q149 604 189 617T245 641T273 663Q275 666 285 666Q294 666 302 660V361L303 61Q310 54 315 52T339 48T401 46H427V0H416Q395 3 257 3Q121 3 100 0H88V46H114Q136 46 152 46T177 47T193 50T201 52T207 57T213 61V578Z"></path></g></g><rect width="6968" height="60" x="120" y="220"></rect></g></g></g></svg></mjx-container></p><ul><li>最高实现65536分频</li></ul><h5 id="计数器CNT"><a href="#计数器CNT" class="headerlink" title="计数器CNT"></a>计数器CNT</h5><p>高级控制定时器的计数器有三种计数模式：</p><ul><li>递增计数模式</li><li>递减计数模式</li><li>递增/递减(中心对齐)计数模式</li></ul><ol><li><p>递增计数模式</p><p>从0开始计数，每来一个CK_CNT脉冲计数器就增加1， 直到计数器的值与自动重载寄存器ARR值相等，然后计数器又从0开始计数并生成计数器上溢事件，计数器总是如此循环计数。 如果禁用重复计数器，在计数器生成上溢事件就马上生成更新事件(UEV)； 如果使能重复计数器，每生成一次上溢事件重复计数器内容就减1，直到重复计数器内容为0时才会生成更新事件。</p></li><li><p>递减计数模式</p><p>计数器从自动重载寄存器ARR值开始计数，每来一个CK_CNT脉冲计数器就减1，直到计数器值为0， 然后计数器又从自动重载寄存器ARR值开始递减计数并生成计数器下溢事件，计数器总是如此循环计数。 如果禁用重复计数器，在计数器生成下溢事件就马上生成更新事件； 如果使能重复计数器，每生成一次下溢事件重复计数器内容就减1，直到重复计数器内容为0时才会生成更新事件。</p></li><li><p>中心对齐模式</p><p>计数器从0开始递增计数，直到计数值等于(ARR-1)值生成计数器上溢事件， 然后从ARR值开始递减计数直到1生成计数器下溢事件。然后又从0开始计数，如此循环。 每次发生计数器上溢和下溢事件都会生成更新事件。</p></li></ol><h5 id="自动重载寄存器ARR"><a href="#自动重载寄存器ARR" class="headerlink" title="自动重载寄存器ARR"></a>自动重载寄存器ARR</h5><p>自动重载寄存器ARR用来存放与计数器CNT比较的值，如果两个值相等就递减重复计数器。 可以通过TIMx_CR1寄存器的ARPE位控制自动重载影子寄存器功能， 如果ARPE位置1，自动重载影子寄存器有效，只有在事件更新时才把TIMx_ARR值赋给影子寄存器。 如果ARPE位为0，则修改TIMx_ARR值马上有效。</p><h5 id="重复计数器RCR"><a href="#重复计数器RCR" class="headerlink" title="重复计数器RCR"></a>重复计数器RCR</h5><p>在基本/通用定时器发生上/下溢事件时直接就生成更新事件，但对于高级控制定时器却不是这样， 高级控制定时器在硬件结构上多出了重复计数器，在定时器发生上溢或下溢事件是递减重复计数器的值， 只有当重复计数器为0时才会生成更新事件。在发生N+1个上溢或下溢事件(N为RCR的值)时产生更新事件。</p><h4 id="3-2-4-输入捕获"><a href="#3-2-4-输入捕获" class="headerlink" title="3.2.4 输入捕获"></a>3.2.4 输入捕获</h4><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\野火电机应用开发－1stm32定时器\doc1007.png" alt="../_images/doc1007.png"></p><p>输入捕获可以对输入的信号的上升沿，下降沿或者双边沿进行捕获， 常用的有测量输入信号的脉宽和测量PWM输入信号的频率和占空比这两种。</p><ul><li><p>输入捕获的大概的原理</p><p>当捕获到信号的跳变沿的时候， 把计数器CNT的值锁存到捕获寄存器CCR中，把前后两次捕获到的CCR寄存器中的值相减，就可以算出脉宽或者频率。 如果捕获的脉宽的时间长度超过你的捕获定时器的周期，就会发生溢出，这个我们需要做额外的处理。</p></li></ul><ol><li><p>输入通道</p><p>需要被测量的信号从定时器的外部引脚TIMx_CH1/2/3/4进入，通常叫TI1/2/3/4， 在后面的捕获讲解中对于要被测量的信号我们都以TIx为标准叫法。</p></li><li><p>输入滤波器和边沿检测器</p><p>采样的频率必须大于等于两倍的输入信号。比如输入的信号为1M，又存在高频的信号干扰，那么此时就很有必要进行滤波， 我们可以设置采样频率为2M，这样可以在保证采样到有效信号的基础上把高于2M的高频干扰信号过滤掉。</p><ul><li>滤波器的配置由CR1寄存器的位CKD[1:0]和CCMR1/2的位ICxF[3:0]控制</li><li>从ICxF位的描述可知， 采样频率fSAMPLE可以由fCK_INT和fDTS分频后的时钟提供， 其中是fCK_INT内部时钟，fDTS是fCK_INT经过分频后得到的频率， 分频因子由CKD[1:0]决定，可以是不分频，2分频或者是4分频。</li><li>边沿检测器用来设置信号在捕获的时候是什么边沿有效，可以是上升沿，下降沿，或者是双边沿，具体的由CCER寄存器的位CCxP和CCxNP决定。</li></ul></li><li><p>捕获通道</p><p>捕获通道就是图中的IC1/2/3/4，每个捕获通道都有相对应的捕获寄存器CCR1/2/3/4， 当发生捕获的时候，计数器CNT的值就会被锁存到捕获寄存器中。</p><ul><li>输入通道是用来输入信号的， 捕获通道是用来捕获输入信号的通道，一个输入通道的信号可以同时输入给两个捕获通道（当只需要测量输入信号的脉宽时候，用一个捕获通道即可）</li><li>输入通道和捕获通道的映射关系具体由寄存器CCMRx的位CCxS[1:0]配置</li></ul></li><li><p>预分频器</p><p>ICx的输出信号会经过一个预分频器，用于决定发生多少个事件时进行一次捕获。 具体的由寄存器CCMRx的位ICxPSC配置，如果希望捕获信号的每一个边沿，则不分频。</p></li><li><p>捕获寄存器</p><p>经过预分频器的信号ICxPS是最终被捕获的信号，当发生捕获时（第一次）， 计数器CNT的值会被锁存到捕获寄存器CCR中，还会产生CCxI中断，相应的中断位CCxIF（在SR寄存器中）会被置位， 通过软件或者读取CCR中的值可以将CCxIF清0。如果发生第二次捕获（即重复捕获：CCR寄存器中已捕获到计数器值且 CCxIF 标志已置 1）， 则捕获溢出标志位CCxOF（在SR寄存器中）会被置位，CCxOF只能通过软件清零。</p></li></ol><h5 id="输入捕获应用"><a href="#输入捕获应用" class="headerlink" title="输入捕获应用"></a>输入捕获应用</h5><p>输入捕获一般应用在两个方面，一个方面是脉冲跳变沿时间测量，另一方面是PWM输入测量。</p><ol><li><p><strong>测量脉宽或者频率</strong></p></li><li><p>测量频率</p><p>当捕获通道TIx上出现上升沿时，发生第一次捕获，计数器CNT的值会被锁存到捕获寄存器CCR中，而且还会进入捕获中断， 在中断服务程序中记录一次捕获（可以用一个标志变量来记录），并把捕获寄存器中的值读取到value1中。 当出现第二次上升沿时，发生第二次捕获，计数器CNT的值会再次被锁存到捕获寄存器CCR中，并再次进入捕获中断， 在捕获中断中，把捕获寄存器的值读取到value3中，并清除捕获记录标志。利用value3和value1的差值我们就可以算出信号的周期（频率）。</p></li><li><p>测量脉宽</p><p>当捕获通道TIx上出现上升沿时，发生第一次捕获，把捕获边沿改变为下降沿捕获，当下降沿到来的时候，发生第二次捕获，并清除捕获记录标志。</p><p>测量脉宽过程中需要来回的切换捕获边沿的极性，如果测量的脉宽时间比较长，定时器就会发生溢出， 溢出的时候会产生更新中断，我们可以在中断里面对溢出进行记录处理</p></li><li><p><strong>PWM输入模式</strong>（周期、占空比）</p><p>当使用PWM输入模式的时候，因为一个输入通道(TIx)会占用两个捕获通道(ICx)， 所以一个定时器在使用PWM输入的时候最多只能使用两个输入通道(TIx)。</p><p>PWM信号由输入通道TI1进入，因为是PWM输入模式的缘故，信号会被分为两路，一路是TI1FP1，另外一路是TI1FP2。 其中一路是周期，另一路是占空比。程序上设置为出发输入的一路就是周期，另一路对应占空比。</p><ul><li>选定输入通道，确定触发信号，然后设置触发信号的极性即可，因为是PWM输入的缘故，另一路信号则由硬件配置，无需软件配置。</li></ul><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\野火电机应用开发－1stm32定时器\doc1014.png" alt="../_images/doc1014.png"></p><p>PWM信号由输入通道TI1进入，配置TI1FP1为触发信号，上升沿捕获。 当上升沿的时候IC1和IC2同时捕获，计数器CNT清零，到了下降沿的时候，IC2捕获，此时计数器CNT的值被锁存到捕获寄存器CCR2中， 到了下一个上升沿的时候，IC1捕获，计数器CNT的值被锁存到捕获寄存器CCR1中。其中CCR2测量的是脉宽，CCR1测量的是周期。</p></li></ol><h4 id="3-2-5-输出比较"><a href="#3-2-5-输出比较" class="headerlink" title="3.2.5 输出比较"></a>3.2.5 输出比较</h4><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\野火电机应用开发－1stm32定时器\doc1008.png" alt="../_images/doc1008.png"></p><p>输出比较就是通过定时器的外部引脚对外输出控制信号，由寄存器CCMRx的位OCxM[2:0]配置八种模式：</p><ul><li>冻结</li><li>将通道X（x=1,2,3,4）设置为匹配时输出有效电平</li><li>将通道X设置为匹配时输出无效电平</li><li>翻转</li><li>强制变为无效电平</li><li>强制变为有效电平</li><li>PWM1</li><li>PWM2</li></ul><ol><li><p>比较寄存器</p><p>当计数器CNT的值跟比较寄存器CCR的值相等的时候，输出参考信号OCxREF的信号的极性就会改变， 其中OCxREF=1（高电平）称之为有效电平，OCxREF=0（低电平）称之为无效电平，并且会产生比较中断CCxI， 相应的标志位CCxIF（SR寄存器中）会置位。然后OCxREF再经过一系列的控制之后就成为真正的输出信号OCx/OCxN。</p></li><li><p>死区发生器</p><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\野火电机应用开发－1stm32定时器\doc1010.png" alt="../_images/doc1010.png"></p><p>在生成的参考波形OCxREF的基础上，可以插入死区时间，用于生成两路互补的输出信号OCx和OCxN。死区时间的大小必须根据与输出信号相连接的器件及其特性来调整。</p><ul><li>死区时间的大小具体由BDTR寄存器的位DTG[7:0]配置</li></ul></li><li><p>输出控制</p><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\野火电机应用开发－1stm32定时器\doc1011.png" alt="../_images/doc1011.png"></p><p>在输出比较的输出控制中，参考信号OCxREF在经过死区发生器之后会产生两路带死区的互补信号OCx_DT和OCxN_DT（通道1<del>3才有互补信号， 通道4没有，其余跟通道1</del>3一样），这两路带死区的互补信号然后就进入输出控制电路，如果没有加入死区控制， 那么进入输出控制电路的信号就直接是OCxREF。</p><p>进入输出控制电路的信号会被分成两路，一路是原始信号，一路是被反向的信号，具体的由寄存器CCER的位CCxP和CCxNP控制。 经过极性选择的信号是否由OCx引脚输出到外部引脚CHx/CHxN则由寄存器CCER的位CxE/CxNE配置。</p><p>如果加入了断路（刹车）功能，则断路和死区寄存器BDTR的MOE、OSSI和OSSR这三个位会共同影响输出的信号。</p></li><li><p>输出引脚</p><p>输出比较的输出信号最终是通过定时器的外部IO来输出的，分别为CH1/2/3/4， 其中前面三个通道还有互补的输出通道CH1/2/3N。</p></li></ol><h5 id="输出比较应用"><a href="#输出比较应用" class="headerlink" title="输出比较应用"></a>输出比较应用</h5><h6 id="PWM输出模式"><a href="#PWM输出模式" class="headerlink" title="PWM输出模式"></a>PWM输出模式</h6><p>PWM输出就是对外输出脉宽（即占空比）可调的方波信号，信号频率由自动重装寄存器ARR的值决定，占空比由比较寄存器CCR的值决定。</p><table><thead><tr><th>模式</th><th>计数器CNT计算方式</th><th>说明</th></tr></thead><tbody><tr><td>PWM1</td><td>递增</td><td>CNT&lt;CCR，通道CH为有效，否则为无效</td></tr><tr><td></td><td>递减</td><td>CNT&gt;CCR，通道CH为无效，否则为有效</td></tr><tr><td>PWM2</td><td>递增</td><td>CNT&lt;CCR，通道CH为无效，否则为有效</td></tr><tr><td></td><td>递减</td><td>CNT&gt;CCR，通道CH为有效，否则为无效</td></tr></tbody></table><ol><li><p>PWM边沿对齐模式</p><p>在递增计数模式下，计数器从 0 计数到自动重载值（ TIMx_ARR寄存器的内容），然后重新从 0 开始计数并生成计数器上溢事件</p><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\野火电机应用开发－1stm32定时器\doc1015.png" alt="../_images/doc1015.png"></p><p>在边沿对齐模式下，计数器CNT只工作在一种模式，递增或者递减模式。</p></li><li><p>PWM中心对齐模式</p><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\野火电机应用开发－1stm32定时器\doc1016.png" alt="../_images/doc1016.png">在中心对齐模式下，计数器CNT是工作做递增/递减模式下。开始的时候，计数器CNT从 0 开始计数到自动重载值减1(ARR-1)， 生成计数器上溢事件；然后从自动重载值开始向下计数到 1 并生成计数器下溢事件。之后从0 开始重新计数。</p><p>中心对齐模式又分为中心对齐模式1/2/3 三种，具体由寄存器CR1位CMS[1:0]配置。具体的区别就是比较中断中断标志位CCxIF在何时置1： 中心模式1在CNT递减计数的时候置1，中心对齐模式2在CNT递增计数时置1，中心模式3在CNT递增和递减计数时都置1。</p></li></ol><h4 id="3-2-6-断路功能"><a href="#3-2-6-断路功能" class="headerlink" title="3.2.6 断路功能"></a>3.2.6 断路功能</h4><p>断路功能就是电机控制的刹车功能，使能断路功能时，根据相关控制位状态修改输出信号电平。 在任何情况下，OCx和OCxN输出都不能同时为有效电平，这关系到电机控制常用的H桥电路结构原因。</p><p>系统复位启动都默认关闭断路功能，将断路和死区寄存器(TIMx_BDTR)的BKE为置1，使能断路功能。 可通过TIMx_BDTR 寄存器的BKP位设置设置断路输入引脚的有效电平，设置为1时输入BRK为高电平有效，否则低电平有效。</p><p>发送断路时，将产生以下效果：</p><ul><li>TIMx_BDTR 寄存器中主输出模式使能(MOE)位被清零，输出处于无效、空闲或复位状态；</li><li>根据相关控制位状态控制输出通道引脚电平；当使能通道互补输出时，会根据情况自动控制输出通道电平；</li><li>将TIMx_SR 寄存器中的 BIF位置 1，并可产生中断和DMA传输请求。</li><li>如果 TIMx_BDTR 寄存器中的 自动输出使能(AOE)位置 1，则MOE位会在发生下一个UEV事件时自动再次置 1。</li></ul><h3 id="3-3-定时器初始化结构体详解"><a href="#3-3-定时器初始化结构体详解" class="headerlink" title="3.3 定时器初始化结构体详解"></a>3.3 定时器初始化结构体详解</h3><table><thead><tr><th>名称</th><th>结构体名</th></tr></thead><tbody><tr><td>时基初始化结构体</td><td>TIM_Base_InitTypeDef</td></tr><tr><td>输出比较初始化结构体</td><td>TIM_OC_InitTypeDef</td></tr><tr><td>输入捕获初始化结构体</td><td>TIM_IC_InitTypeDef</td></tr><tr><td>单脉冲初始化结构体</td><td>TIM_OnePulse_InitTypeDef</td></tr><tr><td>编码器模式配置初始化结构体</td><td>TIM_Encoder_InitTypeDef</td></tr><tr><td>断路和死区初始化结构体*</td><td>TIM_BreakDeadTimeConfigTypeDef</td></tr></tbody></table><p>*通用定时器不能用TIM_BreakDeadTimeConfigTypeDef</p><p>*基本定时器只能使用时基结构体</p><p>初始化结构体定义在stm32f4xx_hal_tim.h和stm32f4xx_hal_tim_ex.h文件中， 初始化库函数定义在stm32f4xx_hal_tim.c和stm32f4xx_hal_tim_ex.c文件中，编程时我们可以结合这四个文件内注释使用。</p><h4 id="3-3-1-时基初始化结构体-TIM-Base-InitTypeDef"><a href="#3-3-1-时基初始化结构体-TIM-Base-InitTypeDef" class="headerlink" title="3.3.1 时基初始化结构体 TIM_Base_InitTypeDef"></a>3.3.1 时基初始化结构体 TIM_Base_InitTypeDef</h4><p>时基结构体TIM_Base_InitTypeDef用于定时器基础参数设置，与TIM_TimeBaseInit函数配合使用完成配置。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token class-name">uint16_t</span> Prescaler<span class="token punctuation">;</span> <span class="token comment">// 预分频器</span>
<span class="token class-name">uint16_t</span> CounterMode<span class="token punctuation">;</span> <span class="token comment">// 计数模式</span>
<span class="token class-name">uint32_t</span> Period<span class="token punctuation">;</span> <span class="token comment">// 定时器周期</span>
<span class="token class-name">uint16_t</span> ClockDivision<span class="token punctuation">;</span> <span class="token comment">// 时钟分频</span>
<span class="token class-name">uint8_t</span> RepetitionCounter<span class="token punctuation">;</span> <span class="token comment">// 重复计算器</span>
<span class="token punctuation">}</span> Time_Base_InitTypeDef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>Prescaler：定时器预分频器设置，时钟源经该预分频器才是定时器计数时钟CK_CNT，它设定PSC寄存器的值。计算公式为： 计数器时钟频率 (f:sub:CK_CNT) 等于 fCK_PSC / (PSC[15:0] + 1)，可实现1至65536分频。</li><li>CounterMode：定时器计数方式，可设置为向上计数、向下计数以及中心对齐。高级控制定时器允许选择任意一种。</li><li>Period：定时器周期，实际就是设定自动重载寄存器ARR的值，ARR 为要装载到实际自动重载寄存器（即影子寄存器）的值，可设置范围为0至65535。</li><li>ClockDivision：时钟分频，设置定时器时钟CK_INT频率与死区发生器以及数字滤波器采样时钟频率分频比。可以选择1、2、4分频。</li><li>RepetitionCounter：重复计数器，只有8位，只存在于高级定时器。</li></ol><h4 id="3-3-2-输出比较初始化结构体-TIM-OC-InitTypeDef"><a href="#3-3-2-输出比较初始化结构体-TIM-OC-InitTypeDef" class="headerlink" title="3.3.2 输出比较初始化结构体 TIM_OC_InitTypeDef"></a>3.3.2 输出比较初始化结构体 TIM_OC_InitTypeDef</h4><p>输出比较结构体TIM_OCInitTypeDef用于输出比较模式，与TIM_OCx_SetConfig函数配合使用完成指定定时器输出通道初始化配置。 高级控制定时器有四个定时器通道，使用时都必须单独设置。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 <span class="token class-name">uint32_t</span> OCMode<span class="token punctuation">;</span> <span class="token comment">// 比较输出模式</span>
 <span class="token class-name">uint32_t</span> Pulse<span class="token punctuation">;</span> <span class="token comment">// 脉冲宽度</span>
 <span class="token class-name">uint32_t</span> OCPolarity<span class="token punctuation">;</span> <span class="token comment">// 输出极性</span>
 <span class="token class-name">uint32_t</span> OCNPolarity<span class="token punctuation">;</span> <span class="token comment">// 互补输出极性</span>
 <span class="token class-name">uint32_t</span> OCFastMode<span class="token punctuation">;</span> <span class="token comment">// 比较输出模式快速使能</span>
 <span class="token class-name">uint32_t</span> OCIdleState<span class="token punctuation">;</span> <span class="token comment">// 空闲状态下比较输出状态</span>
 <span class="token class-name">uint32_t</span> OCNIdleState<span class="token punctuation">;</span> <span class="token comment">// 空闲状态下比较互补输出状态</span>
 <span class="token punctuation">}</span>TIM_OCInitTypeDef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>OCMode：比较输出模式选择，总共有八种，常用的为PWM1/PWM2。它设定CCMRx寄存器OCxM[2:0]位的值。</li><li>Pulse：比较输出脉冲宽度，实际设定比较寄存器CCR的值，决定脉冲宽度。可设置范围为0至65535。</li><li>OCPolarity：比较输出极性，可选OCx为高电平有效或低电平有效。它决定着定时器通道有效电平。它设定CCER寄存器的CCxP位的值。</li><li>OCNPolarity：比较互补输出极性，可选OCxN为高电平有效或低电平有效。它设定TIMx_CCER寄存器的CCxNP位的值。</li><li>OCFastMode：比较输出模式快速使能。它设定TIMx_CCMR寄存器的，OCxFE位的值可以快速使能或者禁能输出。</li><li>OCIdleState：空闲状态时通道输出电平设置，可选输出1或输出0，即在空闲状态(BDTR_MOE位为0)时， 经过死区时间后定时器通道输出高电平或低电平。它设定CR2寄存器的OISx位的值。</li><li>OCNIdleState：空闲状态时互补通道输出电平设置，可选输出1或输出0，即在空闲状态(BDTR_MOE位为0)时， 经过死区时间后定时器互补通道输出高电平或低电平，设定值必须与OCIdleState相反。它设定是CR2寄存器的OISxN位的值。</li></ol><h4 id="3-3-3-输入捕获结构体-TIM-IC-InitTypeDef"><a href="#3-3-3-输入捕获结构体-TIM-IC-InitTypeDef" class="headerlink" title="3.3.3 输入捕获结构体 TIM_IC_InitTypeDef"></a>3.3.3 输入捕获结构体 TIM_IC_InitTypeDef</h4><p>输入捕获结构体TIM_IC_InitTypeDef用于输入捕获模式，与HAL_TIM_IC_ConfigChannel函数配合使用完成定时器输入通道初始化配置。 如果使用PWM输入模式需要与HAL_TIM_PWM_ConfigChannel函数配合使用完成定时器输入通道初始化配置。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
 <span class="token class-name">uint32_t</span> ICPolarity<span class="token punctuation">;</span> <span class="token comment">// 输入捕获触发选择</span>
 <span class="token class-name">uint32_t</span> ICSelection<span class="token punctuation">;</span> <span class="token comment">// 输入捕获选择</span>
 <span class="token class-name">uint32_t</span> ICPrescaler<span class="token punctuation">;</span> <span class="token comment">// 输入捕获预分频器</span>
 <span class="token class-name">uint32_t</span> ICFilter<span class="token punctuation">;</span> <span class="token comment">// 输入捕获滤波器</span>
 <span class="token punctuation">}</span> TIM_IC_InitTypeDef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>ICPolarity：输入捕获边沿触发选择，可选上升沿触发、下降沿触发或边沿跳变触发。它设定CCER寄存器CCxP位和CCxNP位的值。</li><li>ICSelection：输入通道选择，捕获通道ICx的信号可来自三个输入通道， 分别为TIM_ICSELECTION_DIRECTTI、TIM_ICSELECTION_INDIRECTTI或TIM_ICSELECTION_TRC，具体的区别见下图。 它设定CCRMx寄存器的CCxS[1:0]位的值。</li></ol><p><img src="E:\0_VS\6_Blog\chepeys_blog\source_posts\嵌入式\闭环步进电机\野火电机应用开发－1stm32定时器\doc1017.png" alt="../_images/doc1017.png"></p><p>输入通道与捕获通道IC的映射图</p><ol><li>ICPrescaler：输入捕获通道预分频器，可设置1、2、4、8分频，它设定CCMRx寄存器的ICxPSC[1:0]位的值。 如果需要捕获输入信号的每个有效边沿，则设置1分频即可。</li><li>ICFilter：输入捕获滤波器设置，可选设置0x0至0x0F。它设定CCMRx寄存器ICxF[3:0]位的值。一般我们不使用滤波器，即设置为0。</li></ol><h4 id="3-3-4-断路和死区结构体-TIM-BreakDeadTimeConfigTypeDef"><a href="#3-3-4-断路和死区结构体-TIM-BreakDeadTimeConfigTypeDef" class="headerlink" title="3.3.4 断路和死区结构体 TIM_BreakDeadTimeConfigTypeDef"></a>3.3.4 断路和死区结构体 TIM_BreakDeadTimeConfigTypeDef</h4><p>断路和死区结构体TIM_BreakDeadTimeConfigTypeDef用于断路和死区参数的设置，属于高级定时器专用，用于配置断路时通道输出状态，以及死区时间。 它与HAL_TIMEx_ConfigBreakDeadTime函数配置使用完成参数配置。这个结构体的成员只对应BDTR这个寄存器，有关成员的具体使用配置请参考手册BDTR寄存器的详细描述。</p><pre class="line-numbers language-c" data-language="c"><code class="language-c"><span class="token keyword">typedef</span> <span class="token keyword">struct</span> <span class="token punctuation">{</span>
<span class="token class-name">uint32_t</span> OffStateRunMode<span class="token punctuation">;</span> <span class="token comment">// 运行模式下的关闭状态选择</span>
<span class="token class-name">uint32_t</span> OffStateIDLEMode<span class="token punctuation">;</span> <span class="token comment">// 空闲模式下的关闭状态选择</span>
<span class="token class-name">uint32_t</span> LockLevel<span class="token punctuation">;</span> <span class="token comment">// 锁定配置</span>
<span class="token class-name">uint32_t</span> DeadTime<span class="token punctuation">;</span> <span class="token comment">// 死区时间</span>
<span class="token class-name">uint32_t</span> BreakState<span class="token punctuation">;</span> <span class="token comment">// 断路输入使能控制</span>
<span class="token class-name">uint32_t</span> BreakPolarity<span class="token punctuation">;</span> <span class="token comment">// 断路输入极性</span>
<span class="token class-name">uint32_t</span> BreakFilter<span class="token punctuation">;</span> <span class="token comment">// 断路输入滤波器</span>
<span class="token class-name">uint32_t</span> Break2State<span class="token punctuation">;</span> <span class="token comment">// 断路2输入使能控制</span>
<span class="token class-name">uint32_t</span> Break2Polarity<span class="token punctuation">;</span> <span class="token comment">// 断路2输入极性</span>
<span class="token class-name">uint32_t</span> Break2Filter<span class="token punctuation">;</span> <span class="token comment">// 断路2输入滤波器</span>
<span class="token class-name">uint32_t</span> AutomaticOutput<span class="token punctuation">;</span> <span class="token comment">// 自动输出使能</span>
<span class="token punctuation">}</span> TIM_BreakDeadTimeConfigTypeDef<span class="token punctuation">;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre><ol><li>OffStateRunMode：运行模式下的关闭状态选择，它设定BDTR寄存器OSSR位的值。</li><li>OffStateIDLEMode：空闲模式下的关闭状态选择，它设定BDTR寄存器OSSI位的值。</li><li>LockLevel：锁定级别配置， BDTR寄存器LOCK[1:0]位的值。</li><li>DeadTime：配置死区发生器，定义死区持续时间，可选设置范围为0x0至0xFF。它设定BDTR寄存器DTG[7:0]位的值。</li><li>BreakState：断路输入功能选择，可选使能或禁止。它设定BDTR寄存器BKE位的值。</li><li>BreakPolarity：断路输入通道BRK极性选择，可选高电平有效或低电平有效。它设定BDTR寄存器BKP位的值。</li><li>BreakFilter：断路输入滤波器，定义BRK 输入的采样频率和适用于 BRK的数字滤波器带宽。它设定BDTR寄存器BKF[3:0]位的值。</li><li>Break2State：断路2输入功能选择，可选使能或禁止。它设定BDTR寄存器BK2E位的值。</li><li>Break2Polarity：断路2输入通道BRK2极性选择，可选高电平有效或低电平有效。它设定BDTR寄存器BK2P位的值。</li><li>Break2Filter：断路2输入滤波器，定义BRK2 输入的采样频率和适用于 BRK2的数字滤波器带宽。 它设定BDTR寄存器BK2F[3:0]位的值。</li><li>AutomaticOutput：自动输出使能，可选使能或禁止，它设定BDTR寄存器AOE位的值。</li></ol><h3 id="3-4-PWM互补输出实验"><a href="#3-4-PWM互补输出实验" class="headerlink" title="3.4 PWM互补输出实验"></a>3.4 PWM互补输出实验</h3><h3 id="3-5-PWM输入捕获实验"><a href="#3-5-PWM输入捕获实验" class="headerlink" title="3.5 PWM输入捕获实验"></a>3.5 PWM输入捕获实验</h3><h3 id="3-6-多通道输出比较实验"><a href="#3-6-多通道输出比较实验" class="headerlink" title="3.6 多通道输出比较实验"></a>3.6 多通道输出比较实验</h3></div><div class="post-copyright-info"><div class="article-copyright-info-container"><ul><li><strong>标题:</strong> 野火电机应用开发-1定时器</li><li><strong>作者:</strong> Chepey</li><li><strong>创建于 :</strong> 2023-10-25 23:40:00</li><li><strong>更新于 :</strong> 2024-01-25 16:14:51</li><li><strong>链接:</strong> https://chepey.github.io/2023/10/25/嵌入式/闭环步进电机/野火电机应用开发－1stm32定时器/</li><li><strong>版权声明: </strong>版权所有 &#169 Chepey，禁止转载。</li></ul></div></div><ul class="post-tags-box"><li class="tag-item"><a href="/tags/3D%E6%89%93%E5%8D%B0%E6%9C%BA/">#3D打印机</a>&nbsp;</li><li class="tag-item"><a href="/tags/%E6%AD%A5%E8%BF%9B%E7%94%B5%E6%9C%BA/">#步进电机</a>&nbsp;</li><li class="tag-item"><a href="/tags/%E5%B5%8C%E5%85%A5%E5%BC%8F%E5%BC%80%E5%8F%91/">#嵌入式开发</a>&nbsp;</li><li class="tag-item"><a href="/tags/STM32F4/">#STM32F4</a>&nbsp;</li></ul><div class="article-nav"><div class="article-prev"><a class="prev" rel="prev" href="/2023/11/06/3D%E6%89%93%E5%8D%B0/SolidWorks/0-SolidWorks%E7%9A%84%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8/"><span class="left arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-left"></i> </span><span class="title flex justify-center items-center"><span class="post-nav-title-item">0.SolidWorks的基本使用</span> <span class="post-nav-item">上一篇</span></span></a></div><div class="article-next"><a class="next" rel="next" href="/2023/10/25/Matlab/%E7%AE%97%E6%B3%95/"><span class="title flex justify-center items-center"><span class="post-nav-title-item">Matlab基础-10.2算法</span> <span class="post-nav-item">下一篇</span> </span><span class="right arrow-icon flex justify-center items-center"><i class="fa-solid fa-chevron-right"></i></span></a></div></div></div><div class="toc-content-container"><div class="post-toc-wrap"><div class="post-toc"><div class="toc-title">此页目录</div><div class="page-title">野火电机应用开发-1定时器</div><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E9%87%8E%E7%81%AB%E7%94%B5%E6%9C%BA%E5%BA%94%E7%94%A8%E5%BC%80%E5%8F%91%E6%95%99%E7%A8%8B%EF%BC%8D%E5%AE%9A%E6%97%B6%E5%99%A8%E5%9F%BA%E7%A1%80"><span class="nav-number">1.</span> <span class="nav-text">野火电机应用开发教程－定时器基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%80%E3%80%81%E5%AE%9A%E6%97%B6%E5%99%A8%E7%9A%84%E5%88%86%E7%B1%BB"><span class="nav-number">1.1.</span> <span class="nav-text">一、定时器的分类</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%BA%8C%E3%80%81%E5%9F%BA%E6%9C%AC%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="nav-number">1.2.</span> <span class="nav-text">二、基本定时器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#2-1%E6%97%B6%E9%92%9F%E6%BA%90"><span class="nav-number">1.2.1.</span> <span class="nav-text">2.1时钟源</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-2%E6%8E%A7%E5%88%B6%E5%99%A8"><span class="nav-number">1.2.2.</span> <span class="nav-text">2.2控制器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-3%E8%AE%A1%E6%95%B0%E5%99%A8"><span class="nav-number">1.2.3.</span> <span class="nav-text">2.3计数器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#2-4%E5%9F%BA%E6%9C%AC%E5%AE%9A%E6%97%B6%E5%99%A8%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="nav-number">1.2.4.</span> <span class="nav-text">2.4基本定时器的使用</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%89%E3%80%81%E9%AB%98%E7%BA%A7%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="nav-number">1.3.</span> <span class="nav-text">三、高级定时器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#3-1-%E9%AB%98%E7%BA%A7%E6%8E%A7%E5%88%B6%E5%AE%9A%E6%97%B6%E5%99%A8"><span class="nav-number">1.3.1.</span> <span class="nav-text">3.1 高级控制定时器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-2-%E5%8A%9F%E8%83%BD%E6%A1%86%E5%9B%BE"><span class="nav-number">1.3.2.</span> <span class="nav-text">3.2 功能框图</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-3-%E5%AE%9A%E6%97%B6%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BB%93%E6%9E%84%E4%BD%93%E8%AF%A6%E8%A7%A3"><span class="nav-number">1.3.3.</span> <span class="nav-text">3.3 定时器初始化结构体详解</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-4-PWM%E4%BA%92%E8%A1%A5%E8%BE%93%E5%87%BA%E5%AE%9E%E9%AA%8C"><span class="nav-number">1.3.4.</span> <span class="nav-text">3.4 PWM互补输出实验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-5-PWM%E8%BE%93%E5%85%A5%E6%8D%95%E8%8E%B7%E5%AE%9E%E9%AA%8C"><span class="nav-number">1.3.5.</span> <span class="nav-text">3.5 PWM输入捕获实验</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#3-6-%E5%A4%9A%E9%80%9A%E9%81%93%E8%BE%93%E5%87%BA%E6%AF%94%E8%BE%83%E5%AE%9E%E9%AA%8C"><span class="nav-number">1.3.6.</span> <span class="nav-text">3.6 多通道输出比较实验</span></a></li></ol></li></ol></li></ol></div></div></div></div></div></div><div class="main-content-footer"><footer class="footer mt-5 py-5 h-auto text-base text-third-text-color relative border-t-2 border-t-border-color"><div class="info-container py-3 text-center"><div class="text-center">&copy; <span>2023</span> - 2024&nbsp;&nbsp;<i class="fa-solid fa-heart fa-beat" style="--fa-animation-duration:0.5s;color:#f54545"></i>&nbsp;&nbsp;<a href="/">Chepey</a></div><script data-swup-reload-script src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><div class="relative text-center lg:absolute lg:right-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-right"><span id="busuanzi_container_site_uv" class="lg:!block"><span class="text-sm">访问人数</span> <span id="busuanzi_value_site_uv"></span> </span><span id="busuanzi_container_site_pv" class="lg:!block"><span class="text-sm">总访问量</span> <span id="busuanzi_value_site_pv"></span></span></div><div class="relative text-center lg:absolute lg:left-[20px] lg:top-1/2 lg:-translate-y-1/2 lg:text-left"><span class="lg:block text-sm">由 <?xml version="1.0" encoding="utf-8"?><!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd"><svg class="relative top-[2px] inline-block align-baseline" version="1.1" id="圖層_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="1rem" height="1rem" viewBox="0 0 512 512" enable-background="new 0 0 512 512" xml:space="preserve"><path fill="#0E83CD" d="M256.4,25.8l-200,115.5L56,371.5l199.6,114.7l200-115.5l0.4-230.2L256.4,25.8z M349,354.6l-18.4,10.7l-18.6-11V275H200v79.6l-18.4,10.7l-18.6-11v-197l18.5-10.6l18.5,10.8V237h112v-79.6l18.5-10.6l18.5,10.8V354.6z"/></svg><a target="_blank" class="text-base" href="https://hexo.io">Hexo</a> 驱动</span> <span class="text-sm lg:block">主题&nbsp;<a class="text-base" target="_blank" href="https://github.com/EvanNotFound/hexo-theme-redefine">Redefine v2.5.0</a></span></div><div>博客已运行 <span class="odometer" id="runtime_days"></span> 天 <span class="odometer" id="runtime_hours"></span> 小时 <span class="odometer" id="runtime_minutes"></span> 分钟 <span class="odometer" id="runtime_seconds"></span> 秒</div><script data-swup-reload-script>try{function odometer_init(){document.querySelectorAll(".odometer").forEach(e=>{new Odometer({el:e,format:"( ddd).dd",duration:200})})}odometer_init()}catch(e){}</script></div></footer></div></div><div class="post-tools"><div class="post-tools-container"><ul class="article-tools-list"><li class="right-bottom-tools page-aside-toggle"><i class="fa-regular fa-outdent"></i></li></ul></div></div><div class="right-side-tools-container"><div class="side-tools-container"><ul class="hidden-tools-list"><li class="right-bottom-tools tool-font-adjust-plus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-plus"></i></li><li class="right-bottom-tools tool-font-adjust-minus flex justify-center items-center"><i class="fa-regular fa-magnifying-glass-minus"></i></li><li class="right-bottom-tools tool-dark-light-toggle flex justify-center items-center"><i class="fa-regular fa-moon"></i></li><li class="right-bottom-tools tool-scroll-to-bottom flex justify-center items-center"><i class="fa-regular fa-arrow-down"></i></li></ul><ul class="visible-tools-list"><li class="right-bottom-tools toggle-tools-list flex justify-center items-center"><i class="fa-regular fa-cog fa-spin"></i></li><li class="right-bottom-tools tool-scroll-to-top flex justify-center items-center"><i class="arrow-up fas fa-arrow-up"></i> <span class="percent"></span></li></ul></div></div><div class="image-viewer-container"><img src=""></div><div class="search-pop-overlay"><div class="popup search-popup"><div class="search-header"><span class="search-input-field-pre"><i class="fa-solid fa-keyboard"></i></span><div class="search-input-container"><input autocomplete="off" autocorrect="off" autocapitalize="off" placeholder="搜索..." spellcheck="false" type="search" class="search-input"></div><span class="popup-btn-close"><i class="fa-solid fa-times"></i></span></div><div id="search-result"><div id="no-result"><i class="fa-solid fa-spinner fa-spin-pulse fa-5x fa-fw"></i></div></div></div></div></main><script src="/js/libs/Swup.min.js"></script><script src="/js/libs/SwupSlideTheme.min.js"></script><script src="/js/libs/SwupScriptsPlugin.min.js"></script><script src="/js/libs/SwupProgressPlugin.min.js"></script><script src="/js/libs/SwupScrollPlugin.min.js"></script><script src="/js/libs/SwupPreloadPlugin.min.js"></script><script>const swup=new Swup({plugins:[new SwupScriptsPlugin({optin:!0}),new SwupProgressPlugin,new SwupScrollPlugin({offset:80}),new SwupSlideTheme({mainElement:".main-content-body"}),new SwupPreloadPlugin],containers:["#swup"]})</script><script src="/js/tools/imageViewer.js" type="module"></script><script src="/js/utils.js" type="module"></script><script src="/js/main.js" type="module"></script><script src="/js/layouts/navbarShrink.js" type="module"></script><script src="/js/tools/scrollTopBottom.js" type="module"></script><script src="/js/tools/lightDarkSwitch.js" type="module"></script><script src="/js/layouts/categoryList.js" type="module"></script><script src="/js/tools/localSearch.js" type="module"></script><script src="/js/tools/codeBlock.js" type="module"></script><script src="/js/tools/runtime.js"></script><script src="/js/libs/odometer.min.js"></script><link rel="stylesheet" href="/assets/odometer-theme-minimal.css"><script src="/js/libs/Typed.min.js"></script><script src="/js/plugins/typed.js" type="module"></script><div class="post-scripts" data-swup-reload-script><script src="/js/libs/anime.min.js"></script><script src="/js/tools/tocToggle.js" type="module"></script><script src="/js/layouts/toc.js" type="module"></script><script src="/js/plugins/tabs.js" type="module"></script></div></body></html>